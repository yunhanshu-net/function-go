# function-go - AIåŸç”Ÿå…¨æ ˆå¼€å‘æ¡†æ¶

> **ä¸“ä¸ºå¤§æ¨¡å‹è®¾è®¡çš„Goå…¨æ ˆå¼€å‘æ¡†æ¶**  
> ğŸ¤– AIåŸç”Ÿç»“æ„ä½“æ ‡ç­¾ç³»ç»Ÿ | ğŸš€ ä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªå®Œæ•´Webåº”ç”¨ | ğŸ¯ å¤§æ¨¡å‹ç”Ÿæˆä»£ç ç›´æ¥ç¼–è¯‘éƒ¨ç½² | âš¡ æ¡†æ¶å†…éƒ¨æœ‰è¿è¡Œå…¥å£ï¼Œä¸“æ³¨ä¸šåŠ¡å‡½æ•°

## ğŸ”„ æœ€æ–°å˜æ›´è¯´æ˜

> **EnglishNameå­—æ®µå·²ç§»é™¤**ï¼šæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè·¯ç”±è·¯å¾„ï¼Œå‡å°‘é…ç½®è´Ÿæ‹…


## ç›®å½•

- [1. æ¡†æ¶æ¦‚è¿°](#1-æ¡†æ¶æ¦‚è¿°)
- [2. å¿«é€Ÿå¼€å§‹](#2-å¿«é€Ÿå¼€å§‹) 
- [3. æ ¸å¿ƒæ¦‚å¿µ](#3-æ ¸å¿ƒæ¦‚å¿µ)
- [4. ç»„ä»¶ç³»ç»Ÿ](#4-ç»„ä»¶ç³»ç»Ÿ)
- [5. å›è°ƒæœºåˆ¶](#5-å›è°ƒæœºåˆ¶)
- [6. å®Œæ•´ç¤ºä¾‹](#6-å®Œæ•´ç¤ºä¾‹)
- [7. æœ€ä½³å®è·µ](#7-æœ€ä½³å®è·µ)
- [8. å¸¸è§é—®é¢˜](#8-å¸¸è§é—®é¢˜)

---

## 1. æ¡†æ¶æ¦‚è¿°

function-goæ˜¯ä¸€ä¸ª**Goè¯­è¨€AIåŸç”Ÿå…¨æ ˆå¼€å‘æ¡†æ¶**ï¼Œä¸“ä¸ºå¤§æ¨¡å‹ç”Ÿæˆå¯ç›´æ¥è¿è¡Œçš„Webåº”ç”¨è€Œè®¾è®¡ã€‚

### 1.1 æ ¸å¿ƒç‰¹æ€§

#### ğŸ“ ä¸€æ–‡ä»¶ä¸€åº”ç”¨
- ä¸€ä¸ªGoæ–‡ä»¶ = ä¸€ä¸ªå®Œæ•´çš„Webåº”ç”¨
- åŒ…å«æ•°æ®æ¨¡å‹ã€APIæ¥å£ã€ä¸šåŠ¡é€»è¾‘ã€è‡ªåŠ¨UIç”Ÿæˆ
- æ”¯æŒç‹¬ç«‹éƒ¨ç½²å’ŒForkå¤ç”¨

#### ğŸ¨ ç»“æ„ä½“å³ç»„ä»¶
- é€šè¿‡ç»“æ„ä½“æ ‡ç­¾è‡ªåŠ¨ç”Ÿæˆå‰ç«¯UI
- æ”¯æŒ20+ç§ç»„ä»¶ç±»å‹ï¼ˆinputã€selectã€datetimeç­‰ï¼‰
- è‡ªåŠ¨è¡¨å•éªŒè¯å’Œæ•°æ®ç»‘å®š

#### ğŸ—„ï¸ è‡ªåŠ¨å»ºè¡¨å’ŒORM
- CreateTablesé…ç½®è‡ªåŠ¨å»ºè¡¨
- å®Œæ•´çš„GORMæ•°æ®åº“æ“ä½œèƒ½åŠ›
- æ”¯æŒå¤šç§Ÿæˆ·ç‰©ç†éš”ç¦»

#### ğŸ”„ æ™ºèƒ½å›è°ƒç³»ç»Ÿ
- OnInputFuzzy: è¾“å…¥è”æƒ³å’Œèšåˆè®¡ç®—
- OnInputValidate: å®æ—¶å­—æ®µéªŒè¯
- OnTableAddRows/UpdateRows/DeleteRows: è¡¨æ ¼æ“ä½œå›è°ƒ

### 1.2 é€‚ç”¨åœºæ™¯

- **ç®¡ç†åå°ç³»ç»Ÿ**ï¼šCRMã€ERPã€OAç­‰ä¼ä¸šåº”ç”¨
- **æ•°æ®å¤„ç†å·¥å…·**ï¼šæ–‡ä»¶è½¬æ¢ã€å›¾ç‰‡å¤„ç†ã€æ•°æ®åˆ†æ
- **ä¸šåŠ¡è¡¨å•ç³»ç»Ÿ**ï¼šå·¥å•ã€è®¢å•ã€å®¡æ‰¹æµç¨‹
- **åŸå‹å¿«é€Ÿå¼€å‘**ï¼šMVPéªŒè¯ã€åŠŸèƒ½æ¼”ç¤º

### 1.3 æ¶æ„è®¾è®¡

```
å‰ç«¯Webç•Œé¢ â†â†’ function-goæ¡†æ¶ â†â†’ æ•°æ®åº“
     â†‘              â†‘              â†‘
  è‡ªåŠ¨ç”ŸæˆUI      Goç»“æ„ä½“æ ‡ç­¾    è‡ªåŠ¨å»ºè¡¨
```

---

## 2. å¿«é€Ÿå¼€å§‹

### 2.1 æœ€ç®€ç¤ºä¾‹ï¼šå­—ç¬¦ä¸²åè½¬

åˆ›å»ºä¸€ä¸ªåŸºç¡€çš„formå‡½æ•°ï¼š

```go
package demo

import (
    "github.com/yunhanshu-net/function-go/pkg/dto/response"
    "github.com/yunhanshu-net/function-go/runner"
)

// è¯·æ±‚ç»“æ„ä½“ - å®šä¹‰è¡¨å•å­—æ®µ
type ReverseReq struct {
    Text string `json:"text" runner:"name:å¾…åè½¬å†…å®¹" widget:"type:input" data:"example:hello" validate:"required"`
}

// å“åº”ç»“æ„ä½“ - å®šä¹‰ç»“æœå±•ç¤º
type ReverseResp struct {
    Result string `json:"result" runner:"name:åè½¬ç»“æœ" widget:"type:input;mode:text_area"`
}

// ä¸šåŠ¡å¤„ç†å‡½æ•°
func ReverseHandler(ctx *runner.Context, req *ReverseReq, resp response.Response) error {
    // å­—ç¬¦ä¸²åè½¬é€»è¾‘
    reversed := reverseString(req.Text)
    return resp.Form(&ReverseResp{
        Result: reversed,
    }).Build()
}

// å·¥å…·å‡½æ•°
func reverseString(s string) string {
    runes := []rune(s)
    for i, j := 0, len(runes)-1; i < j; i, j = i+1, j-1 {
        runes[i], runes[j] = runes[j], runes[i]
    }
    return string(runes)
}

// APIé…ç½®å’Œæ³¨å†Œ
var ReverseOption = &runner.FormFunctionOptions{
    BaseConfig: runner.BaseConfig{
        ChineseName: "å­—ç¬¦ä¸²åè½¬æ¼”ç¤º", 
        ApiDesc:     "è¾“å…¥å†…å®¹ï¼Œè¿”å›å…¶åè½¬ç»“æœ",
        Tags:        []string{"æ–‡æœ¬å¤„ç†", "å­—ç¬¦ä¸²å·¥å…·"},
        Request:     &ReverseReq{},
        Response:    &ReverseResp{},
    },
}

func init() {
	//RouterGroup æ˜¯è„šæ‰‹æ¶åœ¨æ„å»ºæ—¶å€™è‡ªåŠ¨åˆ›å»ºçš„å˜é‡ï¼Œæ¯ä¸ªå‡½æ•°æ–‡ä»¶éƒ½å¯ä»¥ç›´æ¥ç”¨RouterGroupï¼Œæ˜¯ä¸€å®šä¼šæœ‰è¿™ä¸ªå˜é‡çš„ï¼Œå¿…å®šä¼šæœ‰
	runner.Post(RouterGroup+"/reverse", ReverseHandler, ReverseOption)
}
```

### 2.2 æœ€ç®€Crud tableå‡½æ•°ï¼šå›¾ä¹¦ç®¡ç†

```go

package library

import (
	"fmt"
	"github.com/yunhanshu-net/function-go/pkg/dto/response"
	"github.com/yunhanshu-net/function-go/pkg/dto/usercall"
	"github.com/yunhanshu-net/function-go/runner"
	"github.com/yunhanshu-net/pkg/query"
	"gorm.io/gorm"
)

// æ•°æ®æ¨¡å‹ - è‡ªåŠ¨å»ºè¡¨
type LibraryBook struct {
	ID        int            `json:"id" gorm:"primaryKey;autoIncrement" runner:"name:ID" permission:"read"`
	CreatedAt int64          `json:"created_at" gorm:"autoCreateTime:milli" runner:"name:åˆ›å»ºæ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
	DeletedAt gorm.DeletedAt `json:"deleted_at" gorm:"index" runner:"-"`

	Title  string  `json:"title" runner:"name:ä¹¦å" widget:"type:input" search:"like" validate:"required,min=2,max=50"`
	Author string  `json:"author" runner:"name:ä½œè€…" widget:"type:input" search:"like" validate:"required,min=2,max=20"`
	Price  float64 `json:"price" runner:"name:ä»·æ ¼" widget:"type:number;min:0;precision:2;prefix:ï¿¥" search:"gte,lte" validate:"required,min=0"`
	Stock  int     `json:"stock" runner:"name:åº“å­˜" widget:"type:number;min:0;unit:æœ¬" search:"gte,lte" validate:"required,min=0"`
	Status string  `json:"status" runner:"name:çŠ¶æ€" widget:"type:select;options:çƒ­é”€,é¢„å”®,å·²å”®ç½„" data:"default_value:çƒ­é”€" search:"in" validate:"required"`
}

func (LibraryBook) TableName() string { return "library_book" }

// è¯·æ±‚ç»“æ„ä½“
type LibraryBookListReq struct {
	query.SearchFilterPageReq `runner:"-"`
}

// æŸ¥è¯¢å¤„ç†å‡½æ•°
func LibraryBookList(ctx *runner.Context, req *LibraryBookListReq, resp response.Response) error {
	db := ctx.MustGetOrInitDB()
	var rows []LibraryBook
	return resp.Table(&rows).AutoPaginated(db, &LibraryBook{}, &req.SearchFilterPageReq).Build()
}

// APIé…ç½® - ç»Ÿä¸€ä½¿ç”¨å›è°ƒï¼Œä½“ç°ä¸€ç­‰å…¬æ°‘åœ°ä½
var LibraryBookListOption = &runner.TableFunctionOptions{
	BaseConfig: runner.BaseConfig{
		ChineseName:  "å›¾ä¹¦åˆ—è¡¨",
		ApiDesc:      "å›¾ä¹¦ç®¡ç†ï¼Œæ”¯æŒå¢åˆ æ”¹æŸ¥ã€ä¸šåŠ¡éªŒè¯å’ŒçŠ¶æ€ç®¡ç†",
		Tags:         []string{"å›¾ä¹¦ç®¡ç†", "åº“å­˜ç®¡ç†"},
		Request:      &LibraryBookListReq{},
		Response:     query.PaginatedTable[[]LibraryBook]{},
		CreateTables: []interface{}{&LibraryBook{}},
	},

	// ã€æ¡†æ¶è§„èŒƒã€‘å‰ç«¯æ–°å¢è®°å½•æ—¶å€™ä¼šè§¦å‘è¿™ä¸ªå›è°ƒ
	OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) {
		var books []LibraryBook
		if err := req.DecodeBy(&books); err != nil {
			return nil, fmt.Errorf("å‚æ•°è§£æå¤±è´¥: %v", err)
		}

		db := ctx.MustGetOrInitDB()
		// âœ… æ­£ç¡®åšæ³•ï¼šæ‰¹é‡æŸ¥è¯¢ï¼Œé¿å…N+1é—®é¢˜
		// æ”¶é›†æ‰€æœ‰ä¹¦å
		titles := make([]string, 0, len(books))
		for _, book := range books {
			titles = append(titles, book.Title)
		}
		// ä¸€æ¬¡æ€§æŸ¥è¯¢æ‰€æœ‰é‡å¤çš„ä¹¦å
		var existingTitles []string
		if err := db.Model(&LibraryBook{}).
			Where("title IN ?", titles).
			Pluck("title", &existingTitles).Error; err != nil {
			return nil, fmt.Errorf("æ£€æŸ¥ä¹¦åé‡å¤å¤±è´¥: %v", err)
		}

		// æ£€æŸ¥æ˜¯å¦æœ‰é‡å¤
		if len(existingTitles) > 0 {
			return nil, fmt.Errorf("ä»¥ä¸‹ä¹¦åå·²å­˜åœ¨ï¼š%vï¼Œè¯·ä½¿ç”¨å…¶ä»–ä¹¦å", existingTitles)
		}

		// æ‰‹åŠ¨æ‰§è¡Œåˆ›å»º
		if err := db.Create(&books).Error; err != nil {
			return nil, fmt.Errorf("åˆ›å»ºå›¾ä¹¦å¤±è´¥: %v", err)
		}

		return &usercall.OnTableAddRowsResp{}, nil
	},

	//ã€æ¡†æ¶è§„èŒƒã€‘å‰ç«¯æ›´æ–°è®°å½•æ—¶å€™ä¼šè§¦å‘è¿™ä¸ªå›è°ƒ
	OnTableUpdateRows: func(ctx *runner.Context, req *usercall.OnTableUpdateRowsReq) (*usercall.OnTableUpdateRowsResp, error) {
		db := ctx.MustGetOrInitDB()

		var updatedBook LibraryBook
		err := req.DecodeBy(&updatedBook) //å‡å¦‚ç”¨æˆ·æ›´æ–°äº†authorå­—æ®µçš„è¯ï¼Œé‚£ä¹ˆåªæœ‰è¿™ä¸ªæœ‰å€¼ï¼Œå…¶ä»–éƒ½æ˜¯ç©ºå€¼
		if err != nil {
			return nil, fmt.Errorf("è§£æå­—æ®µå¤±è´¥: %v", err)
		}
		// 6. ç”¨ä¸‹é¢çš„æ–¹æ³•æ›´æ–°ä¹Ÿæ˜¯okçš„
		//updateFields := req.GetFieldsMap() ä¹Ÿå¯ä»¥è¿™æ ·æ¥è·å–æ›´æ–°å­—æ®µçš„key å’Œvalueï¼Œè¿™é‡Œè¿”å›map[string]interface

		// æ‰‹åŠ¨æ‰§è¡Œæ›´æ–°
		if err := db.Where("id IN ?", req.Ids).Updates(updatedBook).Error; err != nil {
			return nil, fmt.Errorf("æ›´æ–°å›¾ä¹¦å¤±è´¥: %v", err)
		}

		return &usercall.OnTableUpdateRowsResp{}, nil
	},

	//ã€æ¡†æ¶è§„èŒƒã€‘å‰ç«¯åˆ é™¤è®°å½•æ—¶å€™è§¦å‘è¿™ä¸ªå›è°ƒ
	OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) {
		db := ctx.MustGetOrInitDB()

		// æ‰‹åŠ¨æ‰§è¡Œåˆ é™¤
		if err := db.Where("id IN ?", req.Ids).Delete(&LibraryBook{}).Error; err != nil {
			return nil, fmt.Errorf("åˆ é™¤å›¾ä¹¦å¤±è´¥: %v", err)
		}

		return &usercall.OnTableDeleteRowsResp{}, nil
	},
}

func init() {
	//è¿™ä¸ªå‡½æ•°å‰ç«¯ä¼šè‡ªåŠ¨æ¸²æŸ“å‡ºå¢åˆ æ”¹æŸ¥çš„åŠŸèƒ½
	runner.Get(RouterGroup+"/library_book_list", LibraryBookList, LibraryBookListOption)
}


```

---

## 3. æ ¸å¿ƒæ¦‚å¿µ

### 3.1 å‡½æ•°ç±»å‹

#### Formå‡½æ•°
- **ç”¨é€”**ï¼šå¤„ç†è¡¨å•æäº¤ï¼Œç”¨äºæ•°æ®è¾“å…¥å’Œå¤„ç†
- **HTTPæ–¹æ³•**ï¼šPOST
- **å“åº”ç±»å‹**ï¼šresp.Form()
- **å…¸å‹åœºæ™¯**ï¼šæ•°æ®è½¬æ¢ã€è®¡ç®—ã€æ–‡ä»¶å¤„ç†

#### Tableå‡½æ•°
- **ç”¨é€”**ï¼šå±•ç¤ºåˆ—è¡¨æ•°æ®ï¼Œæ”¯æŒåˆ†é¡µã€æœç´¢ã€æ’åº
- **HTTPæ–¹æ³•**ï¼šGET  
- **å“åº”ç±»å‹**ï¼šresp.Table()
- **å…¸å‹åœºæ™¯**ï¼šæ•°æ®ç®¡ç†ã€CRUDæ“ä½œ

### 3.2 æ ‡ç­¾ç³»ç»Ÿ

#### runneræ ‡ç­¾
ç”¨äºå®šä¹‰å­—æ®µçš„åŸºç¡€å±æ€§ï¼š

```go
// åŸºç¡€æ ¼å¼
runner:"name:æ˜¾ç¤ºåç§°"

// ç¤ºä¾‹
Title string `runner:"name:æ ‡é¢˜"`
```

#### widgetæ ‡ç­¾
ç”¨äºå®šä¹‰UIç»„ä»¶ç±»å‹å’Œå‚æ•°ï¼š

```go
// åŸºç¡€æ ¼å¼
widget:"type:ç»„ä»¶ç±»å‹;å‚æ•°1:å€¼1;å‚æ•°2:å€¼2"

// ç¤ºä¾‹
Age int `widget:"type:number;min:1;max:120;unit:å²"`
```

#### dataæ ‡ç­¾
ç”¨äºå®šä¹‰ç¤ºä¾‹å€¼å’Œé»˜è®¤å€¼ï¼š

```go
// ç¤ºä¾‹å’Œé»˜è®¤å€¼
data:"example:ç¤ºä¾‹å€¼;default_value:é»˜è®¤å€¼"

// å˜é‡é»˜è®¤å€¼ï¼ˆä½¿ç”¨$å‰ç¼€ï¼‰
data:"default_value:$now"  // å½“å‰æ—¶é—´
```

#### validateæ ‡ç­¾
ç”¨äºå®šä¹‰éªŒè¯è§„åˆ™ï¼š

```go
validate:"required,min=2,max=50"
```

#### searchæ ‡ç­¾
ç”¨äºå®šä¹‰æœç´¢æ–¹å¼ï¼ˆä»…tableå‡½æ•°ï¼‰ï¼š

```go
search:"like"      // æ¨¡ç³Šæœç´¢
search:"gte,lte"   // åŒºé—´æœç´¢  
search:"in"        // å¤šé€‰æœç´¢
```

#### permissionæ ‡ç­¾
ç”¨äºæ§åˆ¶å­—æ®µæƒé™ï¼ˆä»…tableå‡½æ•°ï¼‰ï¼š

```go
permission:"read"           // ä»…åˆ—è¡¨æ˜¾ç¤º
permission:"create"         // ä»…æ–°å¢æ˜¾ç¤º
permission:"update"         // ä»…ç¼–è¾‘æ˜¾ç¤º
permission:"create,update"  // æ–°å¢å’Œç¼–è¾‘æ˜¾ç¤º
```

### 3.3 å‘½åè§„èŒƒ

#### æ–‡ä»¶å’Œç»“æ„ä½“å‘½å
```
æ–‡ä»¶åï¼šsnake_caseï¼ˆå¦‚ï¼šcrm_ticket.goï¼‰
ç»“æ„ä½“ï¼šPascalCase + å‰ç¼€ï¼ˆå¦‚ï¼šCrmTicketï¼‰
è¡¨åï¼šsnake_caseï¼ˆå¦‚ï¼šcrm_ticketï¼‰
å‡½æ•°ï¼šPascalCase + å‰ç¼€ï¼ˆå¦‚ï¼šCrmTicketListï¼‰
```

#### APIè·¯ç”±å‘½å
```
è·¯ç”±è·¯å¾„ï¼šRouterGroup+/å‡½æ•°åï¼ˆå¦‚ï¼šRouterGroup+"/crm_ticket_list"ï¼‰
æ³¨æ„ï¼šè·¯ç”±è·¯å¾„ä¼šè‡ªåŠ¨æ ¹æ®å‡½æ•°åç”Ÿæˆï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šEnglishNameå­—æ®µ
```

#### é‡è¦å˜æ›´è¯´æ˜
```
EnglishNameå­—æ®µå·²ç§»é™¤ï¼šæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè·¯ç”±è·¯å¾„ï¼Œå‡å°‘é…ç½®è´Ÿæ‹…
```

---

## 4. ç»„ä»¶ç³»ç»Ÿ

### 4.1 åŸºç¡€è¾“å…¥ç»„ä»¶

#### inputç»„ä»¶
æ–‡æœ¬è¾“å…¥æ¡†ï¼Œæ”¯æŒå¤šç§æ¨¡å¼ï¼š

```go
// å•è¡Œæ–‡æœ¬
Name string `widget:"type:input"`

// å¤šè¡Œæ–‡æœ¬
Description string `widget:"type:input;mode:text_area"`

// å¯†ç è¾“å…¥
Password string `widget:"type:input;mode:password"`
```

#### numberç»„ä»¶
æ•°å­—è¾“å…¥æ¡†ï¼Œæ”¯æŒç²¾åº¦å’ŒèŒƒå›´æ§åˆ¶ï¼š

```go
// æ•´æ•°è¾“å…¥
Age int `widget:"type:number;min:1;max:120;unit:å²"`

// å°æ•°è¾“å…¥
Price float64 `widget:"type:number;min:0;precision:2;prefix:ï¿¥"`

// ç™¾åˆ†æ¯”
Rate float64 `widget:"type:number;min:0;max:100;precision:1;suffix:%"`
```

#### selectç»„ä»¶
ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼š

```go
// å•é€‰
Status string `widget:"type:select;options:å¾…å¤„ç†,è¿›è¡Œä¸­,å·²å®Œæˆ"`

// å¤šé€‰
Categories []string `widget:"type:select;options:æŠ€æœ¯,äº§å“,è®¾è®¡;multiple:true"`
```

### 4.2 é«˜çº§ç»„ä»¶

#### datetimeç»„ä»¶
æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ï¼š

```go
// æ—¥æœŸé€‰æ‹©
StartDate int64 `widget:"type:datetime;kind:date;format:yyyy-MM-dd"`

// æ—¶é—´é€‰æ‹©
MeetingTime int64 `widget:"type:datetime;kind:time;format:HH:mm"`

// æ—¥æœŸæ—¶é—´
CreatedAt int64 `widget:"type:datetime;kind:datetime"`

// æ—¥æœŸèŒƒå›´
DateRange []int64 `widget:"type:datetime;kind:daterange;format:yyyy-MM-dd"`
```

#### multiselectç»„ä»¶
å¤šé€‰ç»„ä»¶ï¼Œæ”¯æŒåŠ¨æ€æ•°æ®å’Œè‡ªå®šä¹‰åˆ›å»ºï¼š

```go
// é™æ€å¤šé€‰
Tags []string `widget:"type:multiselect;options:ç´§æ€¥,é‡è¦,API,UI"`

// å¯åˆ›å»ºæ–°é€‰é¡¹
UserTags []string `widget:"type:multiselect;options:Java,Python,Go;allow_create:true"`
```

#### colorç»„ä»¶
é¢œè‰²é€‰æ‹©å™¨ï¼š

```go
// åŸºç¡€é¢œè‰²ï¼ˆ6ä½hexï¼‰
ThemeColor string `widget:"type:color;format:hex;show_alpha:false"`

// å¸¦é€æ˜åº¦ï¼ˆ8ä½hexï¼‰
OverlayColor string `widget:"type:color;format:hex;show_alpha:true"`

// RGBAæ ¼å¼
BackgroundColor string `widget:"type:color;format:rgba;show_alpha:true"`
```

#### file_uploadç»„ä»¶
æ–‡ä»¶ä¸Šä¼ ï¼š

```go
// å•æ–‡ä»¶ä¸Šä¼ 
Avatar *files.Files `widget:"type:file_upload;accept:.jpg,.png,.gif;max_size:5MB"`

// å¤šæ–‡ä»¶ä¸Šä¼ 
Documents *files.Files `widget:"type:file_upload;accept:.pdf,.doc,.docx;multiple:true"`
```

#### listç»„ä»¶
åˆ—è¡¨è¾“å…¥ï¼Œæ”¯æŒåŠ¨æ€æ·»åŠ åˆ é™¤ï¼š

```go
// ç®€å•åˆ—è¡¨
Steps []string `widget:"type:list"`

// å¤æ‚åˆ—è¡¨
OrderItems []OrderItem `widget:"type:list"`

// OrderItemç»“æ„ä½“
type OrderItem struct {
    ProductName string  `json:"product_name" runner:"name:å•†å“åç§°" widget:"type:input"`
    Quantity    int     `json:"quantity" runner:"name:æ•°é‡" widget:"type:number;min:1"`
    UnitPrice   float64 `json:"unit_price" runner:"name:å•ä»·" widget:"type:number;precision:2"`
}
```

#### formç»„ä»¶
åµŒå¥—è¡¨å•ï¼š

```go
// åµŒå¥—ç»“æ„
Address struct {
    Province string `json:"province" runner:"name:çœä»½" widget:"type:input"`
    City     string `json:"city" runner:"name:åŸå¸‚" widget:"type:input"`
    Detail   string `json:"detail" runner:"name:è¯¦ç»†åœ°å€" widget:"type:input"`
} `json:"address" runner:"name:åœ°å€" widget:"type:form"`
```

### 4.3 å…¶ä»–ç»„ä»¶

#### switchç»„ä»¶
å¼€å…³ç»„ä»¶ï¼š

```go
IsActive bool `widget:"type:switch;true_label:å¯ç”¨;false_label:ç¦ç”¨"`
```

#### radioç»„ä»¶
å•é€‰æ¡†ï¼š

```go
Gender string `widget:"type:radio;options:ç”·,å¥³;direction:horizontal"`
```

#### checkboxç»„ä»¶
å¤é€‰æ¡†ï¼š

```go
Hobbies []string `widget:"type:checkbox;options:é˜…è¯»,éŸ³ä¹,è¿åŠ¨,æ—…è¡Œ"`
```

#### sliderç»„ä»¶
æ»‘å—ï¼š

```go
// æ•°å€¼æ»‘å—
Volume int `widget:"type:slider;min:0;max:100;unit:%"`

// è¯„åˆ†æ»‘å—
Rating float64 `widget:"type:slider;min:1;max:5;step:0.5;unit:åˆ†"`
```

---

## 5. å›è°ƒæœºåˆ¶

### 5.1 OnInputFuzzyå›è°ƒ

ç”¨äºè¾“å…¥è”æƒ³å’Œå®æ—¶èšåˆè®¡ç®—ï¼š

#### åŸºç¡€ç”¨æ³•
```go
OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ã€å½“å‰åœºæ™¯ã€‘product_idæ˜¯å•é€‰å­—æ®µï¼Œåªè¿”å›é™æ€ä¿¡æ¯ï¼Œä¸åšèšåˆè®¡ç®—
        // ã€ç›®æ ‡å­—æ®µã€‘ä¸º ProductSelectReq.ProductID æä¾›å•†å“é€‰æ‹©æ•°æ®
        var products []Product
        db := ctx.MustGetOrInitDB()
        
        if req.IsByFiledValues() {
            // å¤šå€¼æŸ¥è¯¢ï¼šä½¿ç”¨ IN æŸ¥è¯¢ï¼Œè¿™é‡Œå¿…é¡»ç”¨ db = db.Where
            db = db.Where("id in ?", req.GetFiledValues())
        } else if req.IsByFiledValue() {
            // å•å€¼æŸ¥è¯¢ï¼šä½¿ç”¨ç­‰å€¼æŸ¥è¯¢ï¼Œæ€§èƒ½æœ€ä¼˜
            db = db.Where("id = ?", req.GetFiledValue()).Limit(1)
        } else {
            // æ¨¡ç³ŠæŸ¥è¯¢ï¼šå…³é”®å­—æœç´¢
            db = db.Where("name LIKE ?", "%"+req.Keyword()+"%").Limit(20)
        }
        db.Find(&products)
        
        // æ„å»ºé€‰é¡¹åˆ—è¡¨
        items := make([]*usercall.InputFuzzyItem, 0)
        for _, p := range products {
            items = append(items, &usercall.InputFuzzyItem{
                Value: p.ID,
                Label: fmt.Sprintf("%s - Â¥%.2f", p.Name, p.Price),
                DisplayInfo: map[string]interface{}{
                    "å•†å“åç§°": p.Name,
                    "ä»·æ ¼": p.Price,
                    "åº“å­˜": p.Stock,
                },
            })
        }
        
        return &usercall.OnInputFuzzyResp{
            Values: items,
            Statistics: map[string]interface{}{
                "æœç´¢å…³é”®è¯": keyword,
                "æ‰¾åˆ°å•†å“": len(products),
            },
        }, nil
    },
}
```

#### èšåˆè®¡ç®—è§„èŒƒ

**ğŸ¯ æ ¸å¿ƒåŸåˆ™**ï¼šèšåˆè®¡ç®—å¿…é¡»åŸºäºç”¨æˆ·å½“å‰é€‰æ‹©çš„æ•°æ®ï¼Œæä¾›æœ‰å®é™…ä»·å€¼çš„ç»Ÿè®¡ä¿¡æ¯

**ğŸ“Š èšåˆè®¡ç®—æ”¯æŒè§„åˆ™**ï¼š

| åœºæ™¯ | ç»„ä»¶ç±»å‹ | ç”¨æˆ·æ“ä½œ | èšåˆè®¡ç®— | è¯´æ˜ |
|---|---|---|---|---|
| æ™®é€šå•é€‰ | `select` | åªèƒ½é€‰ä¸€ä¸ª | [æ”¯æŒ] text()å‡½æ•° | ä½¿ç”¨text()åŠ¨æ€å±•ç¤ºé€‰ä¸­itemè¯¦ç»†ä¿¡æ¯ |
| æ™®é€šå¤šé€‰ | `multiselect` | å¯é€‰æ‹©å¤šä¸ª | [æ”¯æŒ] æœ‰æ„ä¹‰ | å¤šé€‰èšåˆè®¡ç®—æ°¸è¿œæœ‰ä»·å€¼ |
| Listå†…å•é€‰ | `list` + `select` | å¯æ·»åŠ å¤šè¡Œ | [æ”¯æŒ] æœ‰æ„ä¹‰ | æ¯è¡Œé€‰ä¸€ä¸ªï¼Œä½†æœ‰å¤šè¡Œæ•°æ® |
| Listå†…å¤šé€‰ | `list` + `multiselect` | å¯æ·»åŠ å¤šè¡Œ+æ¯è¡Œå¤šé€‰ | [æ”¯æŒ] æœ€æœ‰æ„ä¹‰ | åŒé‡èšåˆï¼Œæœ€å¼ºå¤§çš„åœºæ™¯ |

**ğŸ”§ æ”¯æŒçš„èšåˆå‡½æ•°**ï¼š
- `sum(å­—æ®µå)` - æ±‚å’Œ
- `avg(å­—æ®µå)` - å¹³å‡å€¼  
- `min(å­—æ®µå)` - æœ€å°å€¼
- `max(å­—æ®µå)` - æœ€å¤§å€¼
- `count(å­—æ®µå)` - è®¡æ•°
- `sum(å­—æ®µå,*å˜é‡å)` - å­—æ®µå€¼ä¹˜ä»¥å˜é‡åæ±‚å’Œ
- `text(å­—æ®µå)` - åŠ¨æ€å±•ç¤ºé€‰ä¸­itemçš„æ–‡æœ¬ä¿¡æ¯ï¼Œæ”¯æŒå‰ç«¯äº¤äº’

**ğŸ†• text() èšåˆå‡½æ•°è¯¦è§£**ï¼š

`text()` å‡½æ•°ä¸»è¦ç”¨äºå•é€‰åœºæ™¯ï¼Œè®©å‰ç«¯èƒ½å¤ŸåŠ¨æ€å±•ç¤ºé€‰ä¸­itemçš„è¯¦ç»†ä¿¡æ¯ï¼Œå®ç°çœŸæ­£çš„äº¤äº’å¼æ•°æ®å±•ç¤ºã€‚

**å·¥ä½œåŸç†**ï¼š
- **è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·é€‰æ‹©æŸä¸ªitemå
- **æ•°æ®æ¥æº**ï¼šåŸºäºç”¨æˆ·å½“å‰é€‰æ‹©çš„æ•°æ®
- **å±•ç¤ºæ–¹å¼**ï¼šå‰ç«¯åŠ¨æ€æ¸²æŸ“ï¼Œæ”¯æŒå®æ—¶æ›´æ–°
- **äº¤äº’ä½“éªŒ**ï¼šç”¨æˆ·é€‰æ‹©ä¸åŒitemï¼Œæ˜¾ç¤ºä¸åŒä¿¡æ¯

**ä½¿ç”¨åœºæ™¯**ï¼š
- **å•é€‰å­—æ®µ**ï¼šåŒ»ç”Ÿé€‰æ‹©ã€æ‚£è€…é€‰æ‹©ã€è¯å“é€‰æ‹©ç­‰
- **Listå†…å•é€‰**ï¼šæ¯è¡Œé€‰æ‹©ä¸€ä¸ªé¡¹ç›®ï¼Œæ”¯æŒèšåˆè®¡ç®—
- **åŠ¨æ€ä¿¡æ¯å±•ç¤º**ï¼šé€‰ä¸­åç«‹å³æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ï¼Œæ— éœ€é¢å¤–æŸ¥è¯¢

**æ³¨æ„äº‹é¡¹**ï¼š
- `text(å­—æ®µå)` ä¸­çš„å­—æ®µåå¿…é¡»ä¸DisplayInfoä¸­çš„keyå®Œå…¨ä¸€è‡´
- å‰ç«¯ä¼šæ ¹æ®è¿™ä¸ªå¯¹åº”å…³ç³»åŠ¨æ€å±•ç¤ºä¿¡æ¯
- é¿å…åœ¨DisplayInfoä¸­æ”¾ç½®è¿‡å¤šæ•°æ®ï¼Œä¼˜å…ˆå±•ç¤ºç”¨æˆ·æœ€éœ€è¦çš„ä¿¡æ¯

**[æ­£ç¡®ç¤ºä¾‹] text() å‡½æ•°æ­£ç¡®ä½¿ç”¨ç¤ºä¾‹ï¼ˆå•é€‰åœºæ™¯ï¼‰**ï¼š
```go
// åŒ»ç”Ÿé€‰æ‹© - å•é€‰å­—æ®µï¼Œä½¿ç”¨text()å±•ç¤ºè¯¦ç»†ä¿¡æ¯
type DoctorSelectReq struct {
    DoctorID int `json:"doctor_id" widget:"type:select"`  // åªèƒ½é€‰æ‹©ä¸€ä¸ªåŒ»ç”Ÿ
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "doctor_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // ğŸ†• text() èšåˆï¼šåŠ¨æ€å±•ç¤ºé€‰ä¸­åŒ»ç”Ÿè¯¦ç»†ä¿¡æ¯
                "åŒ»ç”Ÿå§“å": "text(åŒ»ç”Ÿå§“å)",
                "åŒ»ç”ŸèŒç§°": "text(èŒç§°)",
                "æ‰€å±ç§‘å®¤": "text(ç§‘å®¤)",
                "è”ç³»ç”µè¯": "text(è”ç³»ç”µè¯)",
                "ä¸“ä¸šç‰¹é•¿": "text(å¤‡æ³¨ä¿¡æ¯)",
            },
            Values: items,
        }, nil
    },
}
```

**[æ­£ç¡®ç¤ºä¾‹] å¤šé€‰åœºæ™¯**ï¼š
```go
// å¤šé€‰å­—æ®µæ°¸è¿œæ”¯æŒèšåˆ
type OrderFormReq struct {
    ProductIDs []int `json:"product_ids" widget:"type:multiselect"`  // å¤šé€‰ï¼ç”¨æˆ·å¯ä»¥é€‰æ‹©å¤šä¸ªå•†å“
    Quantity   int   `json:"quantity" widget:"type:number"`
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_ids": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [æ”¯æŒ] å¤šé€‰èšåˆè®¡ç®—æ°¸è¿œæœ‰æ„ä¹‰
                "é€‰ä¸­å•†å“æ•°": "count(å•†å“åç§°)",           // é€‰äº†å‡ ä¸ªå•†å“
                "é€‰ä¸­å•†å“æ€»ä»·": "sum(å•†å“ä»·æ ¼,*quantity)", // æ€»ä»·æ ¼
                "æœ€ä½å•ä»·": "min(å•†å“ä»·æ ¼)",              // é€‰ä¸­å•†å“ä¸­æœ€ä¾¿å®œçš„
                "æœ€é«˜å•ä»·": "max(å•†å“ä»·æ ¼)",              // é€‰ä¸­å•†å“ä¸­æœ€è´µçš„
                "å¹³å‡å•ä»·": "avg(å•†å“ä»·æ ¼)",              // é€‰ä¸­å•†å“å¹³å‡ä»·æ ¼
                
                // ğŸ†• text() èšåˆï¼šåŠ¨æ€å±•ç¤ºé€‰ä¸­å•†å“è¯¦æƒ…ï¼ˆå¤šé€‰åœºæ™¯ï¼‰
                "å•†å“åç§°": "text(å•†å“åç§°)",
                "è§„æ ¼ä¿¡æ¯": "text(è§„æ ¼)",
                "ç”Ÿäº§å‚å®¶": "text(ç”Ÿäº§å‚å®¶)",
                
                // [æ”¯æŒ] é™æ€ä¿¡æ¯
                "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
                "æ‰¹å‘ä¼˜æƒ ": "æ»¡10ä»¶8æŠ˜",
            },
            Values: items,
        }, nil
    },
}
```

**[æ­£ç¡®ç¤ºä¾‹] Listå†…å•é€‰åœºæ™¯**ï¼š
```go
// Listç»„ä»¶å†…çš„å•é€‰å­—æ®µèšåˆæœ‰æ„ä¹‰
type OrderFormReq struct {
    OrderItems []OrderItem `json:"order_items" widget:"type:list"`  // ç”¨æˆ·å¯ä»¥æ·»åŠ å¤šè¡Œ
}

type OrderItem struct {
    ProductID int `json:"product_id" widget:"type:select"`  // æ¯è¡Œé€‰æ‹©ä¸€ä¸ªå•†å“
    Quantity int `json:"quantity" widget:"type:number"`
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [æ”¯æŒ] ç”¨æˆ·æ·»åŠ å¤šè¡Œåï¼Œè¿™äº›èšåˆè®¡ç®—æœ‰å®é™…ä»·å€¼
                "å•†å“ç§ç±»": "count(å•†å“åç§°)",           // é€‰äº†å‡ ç§ä¸åŒçš„å•†å“
                "å•†å“æ€»æ•°": "sum(quantity)",            // æ‰€æœ‰å•†å“çš„æ€»æ•°é‡
                "å¹³å‡å•ä»·": "avg(å•†å“ä»·æ ¼)",            // é€‰ä¸­å•†å“çš„å¹³å‡ä»·æ ¼
                "ä»·æ ¼åŒºé—´": "min(å•†å“ä»·æ ¼) - max(å•†å“ä»·æ ¼)", // é€‰ä¸­å•†å“çš„ä»·æ ¼èŒƒå›´
                
                // ğŸ†• text() èšåˆï¼šåŠ¨æ€å±•ç¤ºé€‰ä¸­å•†å“è¯¦æƒ…ï¼ˆListå†…å•é€‰åœºæ™¯ï¼‰
                "å•†å“åç§°": "text(å•†å“åç§°)",
                "è§„æ ¼ä¿¡æ¯": "text(è§„æ ¼)",
                "ç”Ÿäº§å‚å®¶": "text(ç”Ÿäº§å‚å®¶)",
                
                // [æ”¯æŒ] é™æ€ä¿¡æ¯
                "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
                "é…é€è¯´æ˜": "æ»¡99å…ƒåŒ…é‚®",
            },
            Values: items,
        }, nil
    },
}
```

**[æ­£ç¡®ç¤ºä¾‹] Listå†…å¤šé€‰åœºæ™¯ - æœ€å¼ºå¤§**ï¼š
```go
// Listå†…å¤šé€‰å­—æ®µï¼ŒåŒé‡èšåˆè®¡ç®—
type OrderFormReq struct {
    OrderItems []OrderItem `json:"order_items" widget:"type:list"`  // ç”¨æˆ·å¯ä»¥æ·»åŠ å¤šè¡Œ
}

type OrderItem struct {
    ProductIDs []int `json:"product_ids" widget:"type:multiselect"`  // æ¯è¡Œå¯ä»¥é€‰æ‹©å¤šä¸ªå•†å“
    Quantity   int   `json:"quantity" widget:"type:number"`
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_ids": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [æ”¯æŒ] Listå†…å¤šé€‰èšåˆè®¡ç®—ï¼Œæœ€å¼ºå¤§çš„åœºæ™¯
                "é€‰ä¸­å•†å“æ•°": "count(å•†å“åç§°)",           // æ‰€æœ‰è¡Œæ‰€æœ‰å•†å“çš„æ€»æ•°
                "æ‰¹é‡æ€»ä»·": "sum(å•†å“ä»·æ ¼,*quantity)",    // æ‰€æœ‰è¡Œæ‰€æœ‰å•†å“çš„æ€»ä»·
                "æ‰¹é‡æ€»é‡": "sum(å•†å“é‡é‡,*quantity)",    // æ‰€æœ‰è¡Œæ‰€æœ‰å•†å“çš„æ€»é‡é‡
                "ä»·æ ¼åŒºé—´": "min(å•†å“ä»·æ ¼) - max(å•†å“ä»·æ ¼)", // æ‰€æœ‰å•†å“çš„ä»·æ ¼èŒƒå›´
                "å•†å“ç§ç±»": "count(å•†å“åç§°)",           // å»é‡åçš„å•†å“ç§ç±»æ•°
                
                // ğŸ†• text() èšåˆï¼šåŠ¨æ€å±•ç¤ºé€‰ä¸­å•†å“è¯¦æƒ…ï¼ˆListå†…å¤šé€‰åœºæ™¯ï¼‰
                "å•†å“åç§°": "text(å•†å“åç§°)",
                "è§„æ ¼ä¿¡æ¯": "text(è§„æ ¼)",
                "åº“å­˜çŠ¶æ€": "text(åº“å­˜çŠ¶æ€)",
                
                // [æ”¯æŒ] é™æ€ä¿¡æ¯
                "æ‰¹å‘ä¼˜æƒ ": "æ»¡50ä»¶äº«8æŠ˜",
                "é…é€è¯´æ˜": "æ‰¹é‡è®¢å•åŒ…é‚®",
            },
            Values: items,
        }, nil
    },
}
```

**âŒ é”™è¯¯ç¤ºä¾‹ï¼ˆæ™®é€šå•é€‰åœºæ™¯ï¼‰**ï¼š
```go
// æ™®é€šå•é€‰å­—æ®µä¸åº”è¯¥èšåˆ
type OrderFormReq struct {
    CustomerID int `json:"customer_id" widget:"type:select"`  // åªèƒ½é€‰ä¸€ä¸ªå®¢æˆ·
    ProductID  int `json:"product_id" widget:"type:select"`   // åªèƒ½é€‰ä¸€ä¸ªå•†å“
    Quantity   int `json:"quantity" widget:"type:number"`
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "customer_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // âŒ å•é€‰åœºæ™¯èšåˆæ— æ„ä¹‰ï¼Œæ°¸è¿œæ˜¾ç¤º1
                "å®¢æˆ·æ•°é‡": "count(å®¢æˆ·åç§°)",      // é”™è¯¯ï¼šæ°¸è¿œæ˜¯1
                "å¹³å‡å¹´é¾„": "avg(å®¢æˆ·å¹´é¾„)",       // é”™è¯¯ï¼šæ°¸è¿œæ˜¯é€‰ä¸­å®¢æˆ·çš„å¹´é¾„
                "æœ€é«˜ç­‰çº§": "max(å®¢æˆ·ç­‰çº§)",       // é”™è¯¯ï¼šæ°¸è¿œæ˜¯é€‰ä¸­å®¢æˆ·çš„ç­‰çº§
                
                // [æ­£ç¡®] è¿”å›æœ‰ç”¨çš„é™æ€ä¿¡æ¯
                "ç»“ç®—å‘¨æœŸ": "æœˆç»“30å¤©",
                "ä¿¡ç”¨ç­‰çº§": "AAAçº§ä¾›åº”å•†",  
                "è”ç³»æ–¹å¼": "400-123-4567",
            },
            Values: items,
        }, nil
    },
}
```

**ğŸ’¡ ç”¨æˆ·ä½“éªŒå¯¹æ¯”**ï¼š

**é”™è¯¯åšæ³•ï¼ˆå•é€‰èšåˆï¼‰**ï¼š
- ç”¨æˆ·é€‰æ‹©"å¼ ä¸‰" â†’ å‰ç«¯æ˜¾ç¤ºï¼šå®¢æˆ·æ•°é‡: 1, å¹³å‡å¹´é¾„: 25, æœ€é«˜ç­‰çº§: VIP
- ç”¨æˆ·å›°æƒ‘ï¼šç³»ç»Ÿå°±è¿™ä¸€ä¸ªå®¢æˆ·å—ï¼Ÿè¿™äº›ç»Ÿè®¡ä¿¡æ¯å®Œå…¨æ²¡æœ‰ä»·å€¼ï¼

**æ­£ç¡®åšæ³•ï¼ˆå¤šé€‰èšåˆï¼‰**ï¼š
- ç”¨æˆ·é€‰æ‹©"è‹¹æœã€é¦™è•‰ã€æ©™å­" â†’ å‰ç«¯æ˜¾ç¤ºï¼šé€‰ä¸­å•†å“æ•°: 3, æ€»ä»·: Â¥25.50, å¹³å‡ä»·: Â¥8.50
- ç”¨æˆ·æ»¡æ„ï¼šå®æ—¶çœ‹åˆ°é€‰æ‹©ç»“æœï¼Œå¸®åŠ©å†³ç­–

**ğŸ“‹ æœ€ä½³å®è·µæ€»ç»“**ï¼š

1. **å¤šé€‰å­—æ®µ**ï¼šæ°¸è¿œéƒ½æ”¯æŒèšåˆï¼Œæ— è®ºæ˜¯å¦åœ¨Listå†…
2. **å•é€‰å­—æ®µ**ï¼šåªæœ‰åœ¨Listç»„ä»¶å†…æ‰æœ‰èšåˆæ„ä¹‰
3. **Listç»„ä»¶**ï¼šæ— è®ºå•é€‰è¿˜æ˜¯å¤šé€‰ï¼Œéƒ½æ”¯æŒèšåˆ
4. **ä¿¡æ¯æ•°é‡**ï¼šèšåˆä¿¡æ¯3-5æ¡å³å¯ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
5. **ç”¨æˆ·ä»·å€¼**ï¼šæ¯ä¸ªç»Ÿè®¡ä¿¡æ¯éƒ½è¦å¯¹ç”¨æˆ·æœ‰å®é™…ä»·å€¼

### 5.2 OnInputValidateå›è°ƒ

ç”¨äºå®æ—¶å­—æ®µéªŒè¯ï¼š

```go
OnInputValidateMap: map[string]runner.OnInputValidate{
    "email": func(ctx *runner.Context, req *usercall.OnInputValidateReq) (*usercall.OnInputValidateResp, error) {
        email := fmt.Sprintf("%v", req.Value)
        
        // é‚®ç®±æ ¼å¼éªŒè¯ï¼ˆç®€å•ç‰ˆï¼‰
        if !strings.Contains(email, "@") {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "é‚®ç®±æ ¼å¼ä¸æ­£ç¡®",
            }, nil
        }
        
        // é‡å¤æ€§æ£€æŸ¥
        db := ctx.MustGetOrInitDB()
        var count int64
        err := db.Model(&User{}).Where("email = ?", email).Count(&count).Error
        if err != nil {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•",
            }, nil
        }
        
        if count > 0 {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "è¯¥é‚®ç®±å·²è¢«æ³¨å†Œ",
            }, nil
        }
        
        return &usercall.OnInputValidateResp{}, nil
    },
}
```

### 5.3 è¡¨æ ¼å›è°ƒ

#### OnTableAddRows
æ–°å¢æ•°æ®æ—¶çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼š

```go
OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) {
    db := ctx.MustGetOrInitDB()
    var rows []*Meeting
    err := req.DecodeBy(&rows)
    if err != nil {
        return nil, fmt.Errorf("å‚æ•°è§£æå¤±è´¥: %v", err)
    }
    
    // ä¸šåŠ¡é€»è¾‘ï¼šæ—¶é—´å†²çªæ£€æµ‹
    for _, meeting := range rows {
        var conflictCount int64
        err := db.Model(&Meeting{}).
            Where("room_id = ? AND start_time < ? AND end_time > ?", 
                meeting.RoomID, meeting.EndTime, meeting.StartTime).
            Count(&conflictCount).Error
            
        if err != nil {
            return nil, fmt.Errorf("å†²çªæ£€æµ‹å¤±è´¥: %v", err)
        }
        
        if conflictCount > 0 {
            return nil, fmt.Errorf("ä¼šè®®å®¤åœ¨è¯¥æ—¶é—´æ®µå·²è¢«å ç”¨")
        }
    }
    
    // ä¿å­˜æ•°æ®
    err = db.Create(&rows).Error
    if err != nil {
        return nil, fmt.Errorf("ä¿å­˜å¤±è´¥: %v", err)
    }
    
    return &usercall.OnTableAddRowsResp{}, nil
}
```

#### OnTableUpdateRows
æ›´æ–°æ•°æ®æ—¶çš„å¤„ç†ï¼š

```go
OnTableUpdateRows: func(ctx *runner.Context, req *usercall.OnTableUpdateRowsReq) (*usercall.OnTableUpdateRowsResp, error) {
    db := ctx.MustGetOrInitDB()
    var meeting Meeting
    err := req.DecodeBy(&meeting)
    if err != nil {
        return nil, fmt.Errorf("å‚æ•°è§£æå¤±è´¥: %v", err)
    }
    
    // æ›´æ–°é€»è¾‘
    err = db.Model(&Meeting{}).Where("id IN ?", req.Ids).Updates(meeting).Error
    if err != nil {
        return nil, fmt.Errorf("æ›´æ–°å¤±è´¥: %v", err)
    }
    
    return &usercall.OnTableUpdateRowsResp{}, nil
}
```

#### OnTableDeleteRows
åˆ é™¤æ•°æ®æ—¶çš„ä¿æŠ¤é€»è¾‘ï¼š

```go
OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) {
    db := ctx.MustGetOrInitDB()
    
    // ä¸šåŠ¡è§„åˆ™ï¼šè¿›è¡Œä¸­çš„ä¼šè®®ä¸èƒ½åˆ é™¤
    now := time.Now().UnixMilli()
    var processingCount int64
    err := db.Model(&Meeting{}).
        Where("id IN ? AND start_time <= ? AND end_time >= ?", 
            req.Ids, now, now).
        Count(&processingCount).Error
            
    if err != nil {
        return nil, fmt.Errorf("æ£€æŸ¥å¤±è´¥: %v", err)
    }
    
    if processingCount > 0 {
        return nil, fmt.Errorf("å­˜åœ¨è¿›è¡Œä¸­çš„ä¼šè®®ï¼Œä¸èƒ½åˆ é™¤")
    }
    
    // æ‰§è¡Œåˆ é™¤
    err = db.Delete(&Meeting{}, "id IN ?", req.Ids).Error
    if err != nil {
        return nil, fmt.Errorf("åˆ é™¤å¤±è´¥: %v", err)
    }
    
    return &usercall.OnTableDeleteRowsResp{}, nil
}
```

---

## 6. å®Œæ•´ç¤ºä¾‹

### 6.1 CRMä¼šè®®å®¤ç®¡ç†ç³»ç»Ÿ

è¿™æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªè¡¨æ ¼å’Œå¤æ‚ä¸šåŠ¡é€»è¾‘çš„S2çº§åˆ«ç³»ç»Ÿï¼š

```go
package crm

import (
    "fmt"
    "time"
    "github.com/yunhanshu-net/function-go/pkg/dto/response"
    "github.com/yunhanshu-net/function-go/pkg/dto/usercall" 
    "github.com/yunhanshu-net/function-go/runner"
    "github.com/yunhanshu-net/pkg/query"
    "gorm.io/gorm"
)

// å‡½æ•°ç»„é…ç½®
var CrmMeetingRoomGroup = &runner.FunctionGroup{
    CnName: "ä¼šè®®å®¤ç®¡ç†",
    EnName: "crm_meeting_room",
}

// ä¼šè®®å®¤åŸºç¡€ä¿¡æ¯
type CrmMeetingRoomInfo struct {
    ID        int            `json:"id" gorm:"primaryKey;autoIncrement" runner:"name:ä¼šè®®å®¤ID" permission:"read"`
    CreatedAt int64          `json:"created_at" gorm:"autoCreateTime:milli" runner:"name:åˆ›å»ºæ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    UpdatedAt int64          `json:"updated_at" gorm:"autoUpdateTime:milli" runner:"name:æ›´æ–°æ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    DeletedAt gorm.DeletedAt `json:"deleted_at" gorm:"index" runner:"-"`
    
    Name        string `json:"name" gorm:"column:name" runner:"name:ä¼šè®®å®¤åç§°" widget:"type:input" search:"like" validate:"required,min=2,max=50"`
    Type        string `json:"type" gorm:"column:type" runner:"name:ä¼šè®®å®¤ç±»å‹" widget:"type:select;options:å°å‹,ä¸­å‹,å¤§å‹,ä¼šè®®å®¤,åŸ¹è®­å®¤" data:"default_value:ä¼šè®®å®¤" search:"in" validate:"required"`
    Capacity    int    `json:"capacity" gorm:"column:capacity" runner:"name:å®¹çº³äººæ•°" widget:"type:number;min:1;max:200;unit:äºº" search:"gte,lte" validate:"required,min=1,max=200"`
    Equipment   string `json:"equipment" gorm:"column:equipment" runner:"name:è®¾å¤‡é…ç½®" widget:"type:input;mode:text_area" search:"like"`
    Location    string `json:"location" gorm:"column:location" runner:"name:ä½ç½®ä¿¡æ¯" widget:"type:input" search:"like"`
    Status      string `json:"status" gorm:"column:status" runner:"name:çŠ¶æ€" widget:"type:select;options:å¯ç”¨,ç»´æŠ¤ä¸­,åœç”¨" data:"default_value:å¯ç”¨" search:"in" validate:"required"`
}

func (CrmMeetingRoomInfo) TableName() string { return "crm_meeting_room_info" }

// ä¼šè®®å®¤é¢„çº¦è®°å½•  
type CrmMeetingRoomBooking struct {
    ID        int            `json:"id" gorm:"primaryKey;autoIncrement" runner:"name:é¢„çº¦ID" permission:"read"`
    CreatedAt int64          `json:"created_at" gorm:"autoCreateTime:milli" runner:"name:åˆ›å»ºæ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    UpdatedAt int64          `json:"updated_at" gorm:"autoUpdateTime:milli" runner:"name:æ›´æ–°æ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    DeletedAt gorm.DeletedAt `json:"deleted_at" gorm:"index" runner:"-"`
    
    RoomID       int    `json:"room_id" gorm:"column:room_id" runner:"name:ä¼šè®®å®¤" widget:"type:select" search:"in" validate:"required"`
    Booker       string `json:"booker" gorm:"column:booker" runner:"name:é¢„çº¦äºº" widget:"type:input" search:"like" validate:"required,min=2,max=50"`
    MeetingTitle string `json:"meeting_title" gorm:"column:meeting_title" runner:"name:ä¼šè®®ä¸»é¢˜" widget:"type:input" search:"like" validate:"required,min=2,max=200"`
    StartTime    int64  `json:"start_time" gorm:"column:start_time" runner:"name:å¼€å§‹æ—¶é—´" widget:"type:datetime;kind:datetime" search:"gte,lte" validate:"required"`
    EndTime      int64  `json:"end_time" gorm:"column:end_time" runner:"name:ç»“æŸæ—¶é—´" widget:"type:datetime;kind:datetime" search:"gte,lte" validate:"required"`
    AttendeeCount int   `json:"attendee_count" gorm:"column:attendee_count" runner:"name:å‚ä¼šäººæ•°" widget:"type:number;min:1;max:200;unit:äºº" search:"gte,lte" validate:"required,min=1,max=200"`
    
    // è®¡ç®—å­—æ®µ
    BookingStatus string `json:"booking_status" gorm:"-" runner:"name:é¢„çº¦çŠ¶æ€" widget:"type:input" permission:"read"`
    RoomName     string `json:"room_name" gorm:"-" runner:"name:ä¼šè®®å®¤åç§°" permission:"read"`
}

func (CrmMeetingRoomBooking) TableName() string { return "crm_meeting_room_booking" }

// ä¼šè®®å®¤ä¿¡æ¯ç®¡ç†
type CrmMeetingRoomInfoListReq struct { query.SearchFilterPageReq `runner:"-"` }

func CrmMeetingRoomInfoList(ctx *runner.Context, req *CrmMeetingRoomInfoListReq, resp response.Response) error {
    db := ctx.MustGetOrInitDB()
    var rows []CrmMeetingRoomInfo
    return resp.Table(&rows).AutoPaginated(db, &CrmMeetingRoomInfo{}, &req.SearchFilterPageReq).Build()
}

var CrmMeetingRoomInfoListOption = &runner.TableFunctionOptions{
	BaseConfig: runner.BaseConfig{
		ChineseName:  "ä¼šè®®å®¤åŸºç¡€ä¿¡æ¯ç®¡ç†",
		ApiDesc:      "ä¼šè®®å®¤åŸºç¡€ä¿¡æ¯ç®¡ç†ï¼Œæ”¯æŒä¼šè®®å®¤ä¿¡æ¯çš„å¢åˆ æ”¹æŸ¥",
		Tags:         []string{"ä¼šè®®å®¤ç®¡ç†", "åŸºç¡€ä¿¡æ¯"},
		Request:      &CrmMeetingRoomInfoListReq{},
		Response:     query.PaginatedTable[[]CrmMeetingRoomInfo]{},
		CreateTables: []interface{}{&CrmMeetingRoomInfo{}},
		Group:        CrmMeetingRoomGroup,
	},
	AutoCrudTable: &CrmMeetingRoomInfo{},
}

// ä¼šè®®å®¤é¢„çº¦ç®¡ç†
type CrmMeetingRoomBookingListReq struct { query.SearchFilterPageReq `runner:"-"` }

func CrmMeetingRoomBookingList(ctx *runner.Context, req *CrmMeetingRoomBookingListReq, resp response.Response) error {
    db := ctx.MustGetOrInitDB()
    var rows []CrmMeetingRoomBooking
    
    // è·å–åˆ†é¡µæ•°æ®
    td := resp.Table(&rows).AutoPaginated(db, &CrmMeetingRoomBooking{}, &req.SearchFilterPageReq)
    
    // å¡«å……è®¡ç®—å­—æ®µ
    if len(rows) > 0 {
        now := time.Now().UnixMilli()
        
        // æ‰¹é‡æŸ¥è¯¢ä¼šè®®å®¤ä¿¡æ¯
        roomIDs := make([]int, 0, len(rows))
        for _, row := range rows {
            roomIDs = append(roomIDs, row.RoomID)
        }
        
        var rooms []CrmMeetingRoomInfo
        if err := db.Where("id IN ?", roomIDs).Find(&rooms).Error; err == nil {
            roomMap := make(map[int]CrmMeetingRoomInfo)
            for _, room := range rooms {
                roomMap[room.ID] = room
            }
            
            for i := range rows {
                // è®¡ç®—é¢„çº¦çŠ¶æ€
                if now < rows[i].StartTime {
                    rows[i].BookingStatus = "å¾…å¼€å§‹"
                } else if now >= rows[i].StartTime && now <= rows[i].EndTime {
                    rows[i].BookingStatus = "è¿›è¡Œä¸­"
                } else {
                    rows[i].BookingStatus = "å·²ç»“æŸ"
                }
                
                // å¡«å……ä¼šè®®å®¤åç§°
                if room, exists := roomMap[rows[i].RoomID]; exists {
                    rows[i].RoomName = room.Name
                }
            }
        }
    }
    
    return td.Build()
}

var CrmMeetingRoomBookingListOption = &runner.TableFunctionOptions{
	BaseConfig: runner.BaseConfig{
		ChineseName:  "ä¼šè®®å®¤é¢„çº¦ç®¡ç†",
		ApiDesc:      "ä¼šè®®å®¤é¢„çº¦è®°å½•ç®¡ç†ï¼Œæ”¯æŒé¢„çº¦åˆ›å»ºã€å†²çªæ£€æµ‹å’ŒçŠ¶æ€ç®¡ç†",
		Tags:         []string{"ä¼šè®®å®¤ç®¡ç†", "é¢„çº¦ç³»ç»Ÿ"},
		Request:      &CrmMeetingRoomBookingListReq{},
		Response:     query.PaginatedTable[[]CrmMeetingRoomBooking]{},
		CreateTables: []interface{}{&CrmMeetingRoomBooking{}, &CrmMeetingRoomInfo{}},
		Group:        CrmMeetingRoomGroup,
	},
	AutoCrudTable: &CrmMeetingRoomBooking{},
    
    // æ¨¡ç³Šæœç´¢å›è°ƒ
    OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
        "room_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
            // ã€å½“å‰åœºæ™¯ã€‘room_idæ˜¯å•é€‰å­—æ®µï¼Œåªè¿”å›é™æ€ä¿¡æ¯ï¼Œä¸åšèšåˆè®¡ç®—
            // ã€ç›®æ ‡å­—æ®µã€‘ä¸º CrmMeetingRoomReserveReq.RoomID æä¾›ä¼šè®®å®¤é€‰æ‹©æ•°æ®
            var rooms []CrmMeetingRoomInfo
            db := ctx.MustGetOrInitDB()

            if req.IsByFiledValues() {
                // å¤šå€¼æŸ¥è¯¢ï¼šä½¿ç”¨ IN æŸ¥è¯¢ï¼Œè¿™é‡Œå¿…é¡»ç”¨ db = db.Where
                db = db.Where("id in ?", req.GetFiledValues())
            } else if req.IsByFiledValue() {
                // å•å€¼æŸ¥è¯¢ï¼šä½¿ç”¨ç­‰å€¼æŸ¥è¯¢ï¼Œæ€§èƒ½æœ€ä¼˜
                db = db.Where("id = ?", req.GetFiledValue()).Limit(1)
            } else {
                // æ¨¡ç³ŠæŸ¥è¯¢ï¼šå…³é”®å­—æœç´¢
                db = db.Where("name LIKE ? OR location LIKE ?", "%"+req.Keyword()+"%", "%"+req.Keyword()+"%").
                    Where("status = ?", "å¯ç”¨").
                    Limit(20)
            }
            db.Find(&rooms)
                
            items := make([]*usercall.InputFuzzyItem, 0)
            for _, room := range rooms {
                items = append(items, &usercall.InputFuzzyItem{
                    Value: room.ID,
                    Label: fmt.Sprintf("%s - %s - å®¹çº³%däºº - %s", room.Name, room.Type, room.Capacity, room.Location),
                    DisplayInfo: map[string]interface{}{
                        "ä¼šè®®å®¤åç§°": room.Name,
                        "ç±»å‹":    room.Type,
                        "å®¹çº³äººæ•°":  room.Capacity,
                        "ä½ç½®":    room.Location,
                        "è®¾å¤‡é…ç½®":  room.Equipment,
                    },
                })
            }
            
            return &usercall.OnInputFuzzyResp{
                Statistics: map[string]interface{}{
                    "æœç´¢å…³é”®è¯":  keyword,
                    "å¯ç”¨ä¼šè®®å®¤":  "ä»…æ˜¾ç¤ºçŠ¶æ€ä¸ºå¯ç”¨çš„ä¼šè®®å®¤", 
                    "æ‰¾åˆ°ä¼šè®®å®¤æ•°": len(rooms),
                },
                Values: items,
            }, nil
        },
    },
    
    // æ–°å¢é¢„çº¦æ—¶æ£€æµ‹å†²çª
    OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) {
        db := ctx.MustGetOrInitDB()
        var rows []*CrmMeetingRoomBooking
        err := req.DecodeBy(&rows)
        if err != nil {
            return nil, fmt.Errorf("å‚æ•°è§£æå¤±è´¥: %v", err)
        }
        
        // æ£€æµ‹æ—¶é—´å†²çª
        for _, booking := range rows {
            var conflictCount int64
            err := db.Model(&CrmMeetingRoomBooking{}).
                Where("room_id = ? AND start_time < ? AND end_time > ?", 
                    booking.RoomID, booking.EndTime, booking.StartTime).
                Count(&conflictCount).Error
                    
            if err != nil {
                return nil, fmt.Errorf("å†²çªæ£€æµ‹å¤±è´¥: %v", err)
            }
            
            if conflictCount > 0 {
                return nil, fmt.Errorf("ä¼šè®®å®¤å·²è¢«å ç”¨ï¼Œè¯·é€‰æ‹©å…¶ä»–æ—¶é—´æˆ–ä¼šè®®å®¤")
            }
            
            // æ£€æŸ¥ä¼šè®®å®¤æ˜¯å¦å¯ç”¨
            var room CrmMeetingRoomInfo
            if err := db.Where("id = ?", booking.RoomID).First(&room).Error; err != nil {
                return nil, fmt.Errorf("ä¼šè®®å®¤ä¸å­˜åœ¨")
            }
            
            if room.Status != "å¯ç”¨" {
                return nil, fmt.Errorf("ä¼šè®®å®¤ %s å½“å‰çŠ¶æ€ä¸º %sï¼Œä¸å¯é¢„çº¦", room.Name, room.Status)
            }
            
            // æ£€æŸ¥äººæ•°æ˜¯å¦è¶…é™
            if booking.AttendeeCount > room.Capacity {
                return nil, fmt.Errorf("å‚ä¼šäººæ•° %d è¶…è¿‡ä¼šè®®å®¤å®¹é‡é™åˆ¶ï¼ˆ%däººï¼‰", booking.AttendeeCount, room.Capacity)
            }
        }
        
        // ä¿å­˜æ•°æ®
        err = db.Create(&rows).Error
        if err != nil {
            return nil, fmt.Errorf("ä¿å­˜é¢„çº¦è®°å½•å¤±è´¥: %v", err)
        }
        
        return &usercall.OnTableAddRowsResp{}, nil
    },
    
    // åˆ é™¤æ—¶ä¿æŠ¤è¿›è¡Œä¸­çš„ä¼šè®®
    OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) {
        db := ctx.MustGetOrInitDB()
        
        // æ£€æŸ¥æ˜¯å¦æœ‰è¿›è¡Œä¸­çš„ä¼šè®®
        now := time.Now().UnixMilli()
        var processingCount int64
        err := db.Model(&CrmMeetingRoomBooking{}).
            Where("id IN ? AND start_time <= ? AND end_time >= ?", req.Ids, now, now).
            Count(&processingCount).Error
            
        if err != nil {
            return nil, fmt.Errorf("æ£€æŸ¥å¤±è´¥: %v", err)
        }
        
        if processingCount > 0 {
            return nil, fmt.Errorf("å­˜åœ¨è¿›è¡Œä¸­çš„ä¼šè®®ï¼Œä¸èƒ½åˆ é™¤")
        }
        
        // æ‰§è¡Œåˆ é™¤
        err = db.Delete(&CrmMeetingRoomBooking{}, "id IN ?", req.Ids).Error
        if err != nil {
            return nil, fmt.Errorf("åˆ é™¤å¤±è´¥: %v", err)
        }
        
        return &usercall.OnTableDeleteRowsResp{}, nil
    },
}

func init() {
    runner.Get(RouterGroup+"/crm_meeting_room_info_list", CrmMeetingRoomInfoList, CrmMeetingRoomInfoListOption)
    runner.Get(RouterGroup+"/crm_meeting_room_booking_list", CrmMeetingRoomBookingList, CrmMeetingRoomBookingListOption)
}
```

### 6.2 å›¾ç‰‡è½¬æ¢å·¥å…·

è¿™æ˜¯ä¸€ä¸ªformç±»å‹çš„å·¥å…·å‡½æ•°ç¤ºä¾‹ï¼š

```go
package image

import (
    "fmt"
    "image"
    "image/jpeg"
    "image/png" 
    "os"
    "path/filepath"
    "strings"
    "sync"
    
    "github.com/yunhanshu-net/function-go/pkg/dto/response"
    "github.com/yunhanshu-net/function-go/runner"
    "github.com/yunhanshu-net/pkg/typex/files"
    "golang.org/x/image/webp"
)

// è¯·æ±‚ç»“æ„ä½“
type ImageConvertReq struct {
    // å›¾ç‰‡ä¸Šä¼ 
    Images *files.Files `json:"images" runner:"name:å›¾ç‰‡æ–‡ä»¶" widget:"type:file_upload;accept:.png,.jpg,.jpeg,.webp;multiple:true;max_size:50MB" validate:"required"`
    
    // è½¬æ¢è®¾ç½®
    TargetFormat string `json:"target_format" runner:"name:ç›®æ ‡æ ¼å¼" widget:"type:select;options:png,jpg,webp" data:"default_value:jpg" validate:"required,oneof=png jpg webp"`
    Quality      int    `json:"quality" runner:"name:è´¨é‡" widget:"type:number;min:1;max:100;unit:%" data:"default_value:85" validate:"required,min=1,max=100"`
    
    // ç³»ç»Ÿé…ç½®  
    EnableConcurrency bool `json:"enable_concurrency" runner:"name:å¼€å¯å¹¶å‘" widget:"type:switch;true_label:å¼€å¯;false_label:å…³é—­" data:"default_value:true"`
    MaxConcurrency   int  `json:"max_concurrency" runner:"name:æœ€å¤§å¹¶å‘" widget:"type:number;min:1;max:32;unit:ä¸ª" data:"default_value:4" validate:"required,min=1,max=32"`
    MaxWidth         int  `json:"max_width" runner:"name:æœ€å¤§å®½åº¦" widget:"type:number;min:0;max:8192;unit:åƒç´ " data:"default_value:0"`
    MaxHeight        int  `json:"max_height" runner:"name:æœ€å¤§é«˜åº¦" widget:"type:number;min:0;max:8192;unit:åƒç´ " data:"default_value:0"`
    DetailedLog      bool `json:"detailed_log" runner:"name:è®°å½•è¯¦ç»†æ—¥å¿—" widget:"type:switch;true_label:å¼€å¯;false_label:å…³é—­" data:"default_value:false"`
}

// å“åº”ç»“æ„ä½“
type ImageConvertResp struct {
    ProcessedCount int          `json:"processed_count" runner:"name:å¤„ç†æˆåŠŸ" widget:"type:number;unit:å¼ "`
    FailedCount    int          `json:"failed_count" runner:"name:å¤„ç†å¤±è´¥" widget:"type:number;unit:å¼ "`
    ProcessingTime string       `json:"processing_time" runner:"name:å¤„ç†è€—æ—¶" widget:"type:input"`
    ConvertedFiles *files.Files `json:"converted_files" runner:"name:è½¬æ¢åçš„å›¾ç‰‡" widget:"type:file_display"`
    ProcessLog     string       `json:"process_log" runner:"name:å¤„ç†æ—¥å¿—" widget:"type:input;mode:text_area"`
}

// å¤„ç†å‡½æ•°
func ImageConvert(ctx *runner.Context, req *ImageConvertReq, resp response.Response) error {
    if req.Images == nil {
        return resp.Form(&ImageConvertResp{
            ProcessLog: "é”™è¯¯ï¼šè¯·ä¸Šä¼ è‡³å°‘ä¸€å¼ å›¾ç‰‡",
        }).Build()
    }
    
    startTime := time.Now()
    var processedCount, failedCount int
    var processLog strings.Builder
    var mu sync.Mutex
    
    // åˆ›å»ºä¸´æ—¶ç›®å½•
    tempDir, err := os.MkdirTemp("", "image_convert_*")
    if err != nil {
        return resp.Form(&ImageConvertResp{
            ProcessLog: fmt.Sprintf("åˆ›å»ºä¸´æ—¶ç›®å½•å¤±è´¥: %v", err),
        }).Build()
    }
    defer os.RemoveAll(tempDir)
    
    inputFiles := req.Images.GetFiles()
    if len(inputFiles) == 0 {
        return resp.Form(&ImageConvertResp{
            ProcessLog: "é”™è¯¯ï¼šæ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶",
        }).Build()
    }
    
    // å¹¶å‘å¤„ç†æ§åˆ¶
    maxWorkers := 1
    if req.EnableConcurrency {
        maxWorkers = req.MaxConcurrency
    }
    
    semaphore := make(chan struct{}, maxWorkers)
    var wg sync.WaitGroup
    
    if req.DetailedLog {
        processLog.WriteString(fmt.Sprintf("å¼€å§‹å¤„ç† %d å¼ å›¾ç‰‡ï¼Œå¹¶å‘æ•°: %d\n", len(inputFiles), maxWorkers))
    }
    
    // å¤„ç†æ¯å¼ å›¾ç‰‡
    for i, inputFile := range inputFiles {
        wg.Add(1)
        go func(index int, file *files.File) {
            defer wg.Done()
            semaphore <- struct{}{}        // è·å–ä¿¡å·é‡
            defer func() { <-semaphore }() // é‡Šæ”¾ä¿¡å·é‡
            
            // å¤„ç†å•å¼ å›¾ç‰‡
            success, logMsg := convertSingleImage(file, tempDir, req, index)
            
            mu.Lock()
            if success {
                processedCount++
            } else {
                failedCount++
            }
            if req.DetailedLog {
                processLog.WriteString(logMsg + "\n")
            }
            mu.Unlock()
        }(i, inputFile)
    }
    
    wg.Wait()
    
    // æ”¶é›†è¾“å‡ºæ–‡ä»¶
    outputFiles, err := collectOutputFiles(tempDir)
    if err != nil {
        return resp.Form(&ImageConvertResp{
            ProcessLog: fmt.Sprintf("æ”¶é›†è¾“å‡ºæ–‡ä»¶å¤±è´¥: %v", err),
        }).Build()
    }
    
    processingTime := time.Since(startTime)
    
    // æ„å»ºå“åº”
    result := &ImageConvertResp{
        ProcessedCount: processedCount,
        FailedCount:    failedCount,
        ProcessingTime: fmt.Sprintf("%.2fç§’", processingTime.Seconds()),
        ConvertedFiles: outputFiles,
    }
    
    if req.DetailedLog {
        processLog.WriteString(fmt.Sprintf("\nå¤„ç†å®Œæˆï¼šæˆåŠŸ %d å¼ ï¼Œå¤±è´¥ %d å¼ ï¼Œè€—æ—¶ %.2f ç§’", 
            processedCount, failedCount, processingTime.Seconds()))
        result.ProcessLog = processLog.String()
    } else {
        result.ProcessLog = fmt.Sprintf("å¤„ç†å®Œæˆï¼šæˆåŠŸ %d å¼ ï¼Œå¤±è´¥ %d å¼ ", processedCount, failedCount)
    }
    
    return resp.Form(result).Build()
}

// å¤„ç†å•å¼ å›¾ç‰‡
func convertSingleImage(inputFile *files.File, outputDir string, req *ImageConvertReq, index int) (bool, string) {
    // è§£ç å›¾ç‰‡
    img, format, err := image.Decode(strings.NewReader(string(inputFile.Content)))
    if err != nil {
        return false, fmt.Sprintf("å›¾ç‰‡ %d: è§£ç å¤±è´¥ - %v", index+1, err)
    }
    
    // å°ºå¯¸è°ƒæ•´ï¼ˆå¦‚æœéœ€è¦ï¼‰
    if req.MaxWidth > 0 || req.MaxHeight > 0 {
        img = resizeImage(img, req.MaxWidth, req.MaxHeight)
    }
    
    // ç”Ÿæˆè¾“å‡ºæ–‡ä»¶å
    baseName := strings.TrimSuffix(inputFile.Filename, filepath.Ext(inputFile.Filename))
    outputFileName := fmt.Sprintf("%s_converted.%s", baseName, req.TargetFormat)
    outputPath := filepath.Join(outputDir, outputFileName)
    
    // åˆ›å»ºè¾“å‡ºæ–‡ä»¶
    outputFile, err := os.Create(outputPath)
    if err != nil {
        return false, fmt.Sprintf("å›¾ç‰‡ %d: åˆ›å»ºè¾“å‡ºæ–‡ä»¶å¤±è´¥ - %v", index+1, err)
    }
    defer outputFile.Close()
    
    // æ ¹æ®ç›®æ ‡æ ¼å¼ç¼–ç 
    switch req.TargetFormat {
    case "jpg":
        err = jpeg.Encode(outputFile, img, &jpeg.Options{Quality: req.Quality})
    case "png":
        err = png.Encode(outputFile, img)
    case "webp":
        // æ³¨æ„ï¼šè¿™é‡Œç®€åŒ–å¤„ç†ï¼Œå®é™…ä½¿ç”¨éœ€è¦webpç¼–ç åº“
        return false, fmt.Sprintf("å›¾ç‰‡ %d: WebPæ ¼å¼æš‚æœªæ”¯æŒ", index+1)
    default:
        return false, fmt.Sprintf("å›¾ç‰‡ %d: ä¸æ”¯æŒçš„æ ¼å¼ %s", index+1, req.TargetFormat)
    }
    
    if err != nil {
        return false, fmt.Sprintf("å›¾ç‰‡ %d: ç¼–ç å¤±è´¥ - %v", index+1, err)
    }
    
    return true, fmt.Sprintf("å›¾ç‰‡ %d: %s -> %s (åŸæ ¼å¼: %s)", index+1, inputFile.Filename, outputFileName, format)
}

// å›¾ç‰‡å°ºå¯¸è°ƒæ•´ï¼ˆç®€åŒ–ç‰ˆï¼‰
func resizeImage(img image.Image, maxWidth, maxHeight int) image.Image {
    // è¿™é‡Œåº”è¯¥ä½¿ç”¨å›¾ç‰‡ç¼©æ”¾åº“ï¼Œæˆ‘ä»¬ä½œä¸ºæ–‡æ¡£ç®€åŒ–å¤„ç†äº†ï¼Œä½†æ˜¯ä½ ä»¬ä¸å…è®¸è¿™ä¹ˆå¹²
    return img
}

// æ”¶é›†è¾“å‡ºæ–‡ä»¶
func collectOutputFiles(dir string) (*files.Files, error) {
    entries, err := os.ReadDir(dir)
    if err != nil {
        return nil, err
    }
    
    var outputFiles []*files.File
    for _, entry := range entries {
        if entry.IsDir() {
            continue
        }
        
        filePath := filepath.Join(dir, entry.Name())
        content, err := os.ReadFile(filePath)
        if err != nil {
            continue
        }
        
        outputFiles = append(outputFiles, &files.File{
            Filename: entry.Name(),
            Content:  content,
            Size:     int64(len(content)),
        })
    }
    
    return &files.Files{Files: outputFiles}, nil
}

// APIé…ç½®
var ImageConvertOption = &runner.FormFunctionOptions{
	BaseConfig: runner.BaseConfig{
		ChineseName:  "å›¾ç‰‡æ ¼å¼è½¬æ¢",
		ApiDesc:      "æ”¯æŒPNGã€JPGã€WebPæ ¼å¼äº’è½¬ï¼Œå¯æ‰¹é‡å¤„ç†ï¼Œæ”¯æŒå°ºå¯¸è°ƒæ•´å’Œè´¨é‡æ§åˆ¶",
		Tags:         []string{"å›¾ç‰‡å¤„ç†", "æ ¼å¼è½¬æ¢", "æ‰¹é‡å¤„ç†"},
		Request:      &ImageConvertReq{},
		Response:     &ImageConvertResp{},
	},
}

func init() {
    runner.Post(RouterGroup+"/image_convert", ImageConvert, ImageConvertOption)
}
```

---

## 7. æœ€ä½³å®è·µ

### 7.1 é¡¹ç›®ç»„ç»‡è§„èŒƒ

#### æ–‡ä»¶å‘½å
```
å•æ–‡ä»¶ä¸€ç³»ç»Ÿï¼šcrm_ticket.go
ç»Ÿä¸€å‰ç¼€ï¼šCrmTicketï¼ˆç»“æ„ä½“ï¼‰ã€CrmTicketListï¼ˆå‡½æ•°ï¼‰
è¡¨åï¼šcrm_ticketï¼ˆsnake_caseï¼‰
è·¯ç”±ï¼šRouterGroup+/crm_ticket_list
```

#### å‡½æ•°ç»„ä½¿ç”¨
```go
// å•åŠŸèƒ½æ–‡ä»¶ - ä¸éœ€è¦å‡½æ•°ç»„
var CrmTicketListOption = &runner.TableFunctionOptions{
    BaseConfig: runner.BaseConfig{
        // ...
    },
}

// å¤šåŠŸèƒ½æ–‡ä»¶ - éœ€è¦å‡½æ•°ç»„
var CrmMeetingRoomGroup = &runner.FunctionGroup{
    CnName: "ä¼šè®®å®¤ç®¡ç†",
    EnName: "crm_meeting_room",
}

var CrmMeetingRoomInfoListOption = &runner.TableFunctionOptions{
    BaseConfig: runner.BaseConfig{
        Group: CrmMeetingRoomGroup,  // æŒ‡å®šå‡½æ•°ç»„
        // ...
    },
}
```

### 7.2 æ•°æ®æ¨¡å‹è®¾è®¡

#### åŸºç¡€å­—æ®µæ¨¡æ¿
```go
type ModelTemplate struct {
    // ä¸»é”®
    ID int `json:"id" gorm:"primaryKey;autoIncrement" runner:"name:ID" permission:"read"`
    
    // æ—¶é—´å­—æ®µï¼ˆç³»ç»Ÿè‡ªåŠ¨ï¼‰
    CreatedAt int64 `json:"created_at" gorm:"autoCreateTime:milli" runner:"name:åˆ›å»ºæ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    UpdatedAt int64 `json:"updated_at" gorm:"autoUpdateTime:milli" runner:"name:æ›´æ–°æ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`
    
    // è½¯åˆ é™¤
    DeletedAt gorm.DeletedAt `json:"deleted_at" gorm:"index" runner:"-"`
    
    // ä¸šåŠ¡å­—æ®µç¤ºä¾‹
    Name   string `json:"name" gorm:"column:name;comment:åç§°" runner:"name:åç§°" widget:"type:input" search:"like" validate:"required,min=2,max=50"`
    Status string `json:"status" gorm:"column:status;comment:çŠ¶æ€" runner:"name:çŠ¶æ€" widget:"type:select;options:å¯ç”¨,ç¦ç”¨" data:"default_value:å¯ç”¨" search:"in" validate:"required"`
}

func (ModelTemplate) TableName() string { return "model_template" }
```

#### æ—¶é—´å­—æ®µè§„èŒƒ
```go
// [æ­£ç¡®] ç³»ç»Ÿæ—¶é—´ - è‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€format
CreatedAt int64 `json:"created_at" gorm:"autoCreateTime:milli" runner:"name:åˆ›å»ºæ—¶é—´" widget:"type:datetime;kind:datetime" permission:"read"`

// [æ­£ç¡®] ä¸šåŠ¡æ—¥æœŸ - éœ€è¦formatæ§åˆ¶æ˜¾ç¤º
StartDate int64 `json:"start_date" gorm:"column:start_date" runner:"name:å¼€å§‹æ—¥æœŸ" widget:"type:datetime;kind:date;format:yyyy-MM-dd" validate:"required"`

// [æ­£ç¡®] æ—¶é—´èŒƒå›´
WorkPeriod []int64 `json:"work_period" runner:"name:å·¥ä½œæ—¶é—´æ®µ" widget:"type:datetime;kind:daterange;format:yyyy-MM-dd"`
```

#### æ–‡ä»¶å­—æ®µè§„èŒƒ
```go
// [æ­£ç¡®] æ­£ç¡®çš„æ–‡ä»¶å­—æ®µå®šä¹‰
Avatar *files.Files `json:"avatar" gorm:"type:json;comment:å¤´åƒ" runner:"name:å¤´åƒ" widget:"type:file_upload;accept:.jpg,.png;max_size:5MB"`

// [æ­£ç¡®] æ–‡ä»¶å±•ç¤ºï¼ˆå“åº”ï¼‰
Files *files.Files `json:"files" runner:"name:é™„ä»¶" widget:"type:file_display"`
```

### 7.3 ç»„ä»¶é€‰æ‹©æŒ‡å—

#### æ–‡æœ¬è¾“å…¥
```go
// å•è¡Œæ–‡æœ¬
Name string `widget:"type:input"`

// å¤šè¡Œæ–‡æœ¬  
Description string `widget:"type:input;mode:text_area"`

// å¯†ç 
Password string `widget:"type:input;mode:password"`
```

#### æ•°å­—è¾“å…¥
```go
// æ•´æ•°
Age int `widget:"type:number;min:1;max:120;unit:å²"`

// å°æ•°
Price float64 `widget:"type:number;min:0;precision:2;prefix:ï¿¥"`

// æ»‘å—
Volume int `widget:"type:slider;min:0;max:100;unit:%"`
```

#### é€‰æ‹©è¾“å…¥
```go
// å•é€‰ä¸‹æ‹‰
Status string `widget:"type:select;options:å¾…å¤„ç†,è¿›è¡Œä¸­,å·²å®Œæˆ"`

// å•é€‰æŒ‰é’®
Gender string `widget:"type:radio;options:ç”·,å¥³;direction:horizontal"`

// å¤šé€‰ä¸‹æ‹‰
Tags []string `widget:"type:multiselect;options:æ ‡ç­¾1,æ ‡ç­¾2,æ ‡ç­¾3;allow_create:true"`

// å¤é€‰æ¡†
Hobbies []string `widget:"type:checkbox;options:é˜…è¯»,éŸ³ä¹,è¿åŠ¨"`

// å¼€å…³
IsActive bool `widget:"type:switch;true_label:å¯ç”¨;false_label:ç¦ç”¨"`
```

#### æ—¥æœŸæ—¶é—´
```go
// æ—¥æœŸé€‰æ‹©
StartDate int64 `widget:"type:datetime;kind:date;format:yyyy-MM-dd"`

// æ—¶é—´é€‰æ‹©
MeetingTime int64 `widget:"type:datetime;kind:time;format:HH:mm"`

// æ—¥æœŸæ—¶é—´
CreatedAt int64 `widget:"type:datetime;kind:datetime"`

// æ—¥æœŸèŒƒå›´
WorkPeriod []int64 `widget:"type:datetime;kind:daterange;format:yyyy-MM-dd"`
```

#### å¤æ‚ç»“æ„
```go
// åµŒå¥—è¡¨å•
Address struct {
    Province string `json:"province" runner:"name:çœä»½" widget:"type:input"`
    City     string `json:"city" runner:"name:åŸå¸‚" widget:"type:input"`
} `json:"address" runner:"name:åœ°å€" widget:"type:form"`

// åŠ¨æ€åˆ—è¡¨
OrderItems []OrderItem `json:"order_items" runner:"name:è®¢å•é¡¹" widget:"type:list"`
```

### 7.4 å›è°ƒä½¿ç”¨æŒ‡å—

#### OnInputFuzzyèšåˆè§„åˆ™
```go
// [æ”¯æŒ] Liståœºæ™¯ - å¯ä»¥èšåˆ
OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                "å•†å“æ€»ä»·": "sum(ä»·æ ¼,*quantity)",  // [æ”¯æŒ] å¯ä»¥èšåˆ
                "å•†å“æ•°é‡": "count(ä»·æ ¼)",          // [æ”¯æŒ] å¯ä»¥èšåˆ
                "å¹³å‡ä»·æ ¼": "avg(ä»·æ ¼)",           // [æ”¯æŒ] å¯ä»¥èšåˆ
            },
            Values: items,
        }, nil
    },
}

// [è¯´æ˜] å•é€‰åœºæ™¯ - åªè¿”å›é™æ€ä¿¡æ¯
OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "supplier_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
        // ...æŸ¥è¯¢é€»è¾‘
        
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                "ç»“ç®—å‘¨æœŸ": "æœˆç»“30å¤©",     // [è¯´æ˜] é™æ€ä¿¡æ¯
                "ä¿¡ç”¨ç­‰çº§": "AAAçº§",       // [è¯´æ˜] é™æ€ä¿¡æ¯
                "è”ç³»æ–¹å¼": "400-123-4567", // [è¯´æ˜] é™æ€ä¿¡æ¯
            },
            Values: items,
        }, nil
    },
}
```

#### éªŒè¯å›è°ƒæœ€ä½³å®è·µ
```go
OnInputValidateMap: map[string]runner.OnInputValidate{
    "code": func(ctx *runner.Context, req *usercall.OnInputValidateReq) (*usercall.OnInputValidateResp, error) {
        code := fmt.Sprintf("%v", req.Value)
        
        // æ ¼å¼éªŒè¯ï¼ˆç®€å•æ£€æŸ¥ï¼‰
        if len(code) < 3 {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "ç¼–ç é•¿åº¦ä¸èƒ½å°‘äº3ä½",
            }, nil
        }
        
        // ä¸šåŠ¡é€»è¾‘éªŒè¯ï¼ˆå”¯ä¸€æ€§æ£€æŸ¥ï¼‰
        db := ctx.MustGetOrInitDB()
        var count int64
        err := db.Model(&Product{}).Where("code = ?", code).Count(&count).Error
        if err != nil {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "éªŒè¯å¤±è´¥ï¼Œè¯·é‡è¯•",
            }, nil
        }
        
        if count > 0 {
            return &usercall.OnInputValidateResp{
                ErrorMsg: "è¯¥ç¼–ç å·²è¢«ä½¿ç”¨ï¼Œè¯·æ¢ä¸€ä¸ª",
            }, nil
        }
        
        return &usercall.OnInputValidateResp{}, nil
    },
}
```

### 7.5 é”™è¯¯å¤„ç†è§„èŒƒ

#### Formå‡½æ•°é”™è¯¯å¤„ç†
```go
func MyFormHandler(ctx *runner.Context, req *MyReq, resp response.Response) error {
    // å‚æ•°éªŒè¯
    if req.Name == "" {
        return resp.Form(&MyResp{
            Message: "å§“åä¸èƒ½ä¸ºç©º",
        }).Build()
    }
    
    // ä¸šåŠ¡é€»è¾‘å¤„ç†
    db := ctx.MustGetOrInitDB()
    result, err := processBusinessLogic(db, req)
    if err != nil {
        ctx.Logger.Errorf("ä¸šåŠ¡å¤„ç†å¤±è´¥: %v", err)
        return resp.Form(&MyResp{
            Message: fmt.Sprintf("å¤„ç†å¤±è´¥: %v", err),
        }).Build()
    }
    
    // æˆåŠŸå“åº”
    return resp.Form(&MyResp{
        Message: "å¤„ç†æˆåŠŸ",
        Data:    result,
    }).Build()
}
```

#### Tableå›è°ƒé”™è¯¯å¤„ç†
```go
OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) {
    var rows []*MyModel
    err := req.DecodeBy(&rows)
    if err != nil {
        ctx.Logger.Errorf("å‚æ•°è§£æå¤±è´¥: %v", err)
        return nil, fmt.Errorf("å‚æ•°æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥è¾“å…¥æ•°æ®")
    }
    
    db := ctx.MustGetOrInitDB()
    
    // ä¸šåŠ¡è§„åˆ™éªŒè¯
    for _, row := range rows {
        if err := validateBusinessRules(row); err != nil {
            ctx.Logger.Errorf("ä¸šåŠ¡è§„åˆ™éªŒè¯å¤±è´¥: %v", err)
            return nil, fmt.Errorf("éªŒè¯å¤±è´¥: %v", err)
        }
    }
    
    // æ•°æ®ä¿å­˜
    err = db.Create(&rows).Error
    if err != nil {
        ctx.Logger.Errorf("æ•°æ®ä¿å­˜å¤±è´¥: %v", err)
        return nil, fmt.Errorf("ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•")
    }
    
    return &usercall.OnTableAddRowsResp{}, nil
}
```

---

## 8. å¸¸è§é—®é¢˜

### 8.1 å¼€å‘è°ƒè¯•

#### Q: å¦‚ä½•æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Ÿ
A: ä½¿ç”¨ctx.Loggerè®°å½•æ—¥å¿—ï¼š

```go
func MyHandler(ctx *runner.Context, req *MyReq, resp response.Response) error {
    ctx.Logger.Infof("å¼€å§‹å¤„ç†è¯·æ±‚: %+v", req)
    
    db := ctx.MustGetOrInitDB()
    if err != nil {
        ctx.Logger.Errorf("æ•°æ®åº“è¿æ¥å¤±è´¥: %v", err)
        return resp.Form(&MyResp{Message: "ç³»ç»Ÿé”™è¯¯"}).Build()
    }
    
    ctx.Logger.Infof("å¤„ç†å®Œæˆ")
    return resp.Form(&MyResp{Message: "æˆåŠŸ"}).Build()
}
```



### 8.2 æ€§èƒ½ä¼˜åŒ–

#### Q: å¦‚ä½•ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼Ÿ
A: ä½¿ç”¨GORMçš„é«˜çº§æŸ¥è¯¢ç‰¹æ€§ï¼š

```go
// é¢„åŠ è½½å…³è”æ•°æ®
var users []User
db.Preload("Profile").Find(&users)

// æ‰¹é‡æŸ¥è¯¢
var products []Product
db.Where("id IN ?", productIDs).Find(&products)

// ç´¢å¼•ä¼˜åŒ–
type User struct {
    Email string `gorm:"uniqueIndex"`
    Name  string `gorm:"index"`
}
```

#### Q: å¦‚ä½•å¤„ç†å¤§æ–‡ä»¶ä¸Šä¼ ï¼Ÿ
A: é™åˆ¶æ–‡ä»¶å¤§å°å’Œç±»å‹ï¼š

```go
Files *files.Files `widget:"type:file_upload;accept:.pdf,.doc;max_size:100MB"`
```

### 8.3 éƒ¨ç½²ç›¸å…³

#### Q: å¦‚ä½•é…ç½®æ•°æ®åº“è¿æ¥ï¼Ÿ
A: é€šè¿‡ctx.MustGetOrInitDB()ï¼š

```go
func MyHandler(ctx *runner.Context) error {
    db := ctx.MustGetOrInitDB()  // è‡ªåŠ¨æ ¹æ®é…ç½®è¿æ¥æ•°æ®åº“
    // ä½¿ç”¨dbè¿›è¡Œæ“ä½œ
}
```

#### Q: å¦‚ä½•å®ç°å¤šç§Ÿæˆ·ï¼Ÿ
A: æ¯ä¸ªç§Ÿæˆ·ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®åº“ï¼š

```go
var MyOption = &runner.TableFunctionOptions{
    BaseConfig: runner.BaseConfig{
        CreateTables: []interface{}{&MyModel{}},  // è‡ªåŠ¨æŒ‰ç§Ÿæˆ·å»ºè¡¨
    },
}
```

### 8.4 å¸¸è§é”™è¯¯

#### Q: æ ‡ç­¾æ ¼å¼é”™è¯¯
```go
// âŒ é”™è¯¯ï¼šæ ‡ç­¾æ¢è¡Œ
Name string `widget:"type:input;
             placeholder:è¯·è¾“å…¥"`

// [æ­£ç¡®] å•è¡Œæ ‡ç­¾  
Name string `widget:"type:input;placeholder:è¯·è¾“å…¥"`
```

#### Q: æ—¶é—´å­—æ®µå¤„ç†
```go
// âŒ é”™è¯¯ï¼šç³»ç»Ÿæ—¶é—´ä½¿ç”¨format
CreatedAt int64 `widget:"type:datetime;kind:datetime;format:yyyy-MM-dd"`

// [æ­£ç¡®] ç³»ç»Ÿæ—¶é—´ä¸éœ€è¦format
CreatedAt int64 `widget:"type:datetime;kind:datetime"`

// [æ­£ç¡®] ä¸šåŠ¡æ—¥æœŸå¯ä»¥ä½¿ç”¨format
StartDate int64 `widget:"type:datetime;kind:date;format:yyyy-MM-dd"`
```

#### Q: æ–‡ä»¶å­—æ®µå®šä¹‰
```go
// âŒ é”™è¯¯ï¼šç¼ºå°‘gormæ ‡ç­¾
Files *files.Files `json:"files"`

// [æ­£ç¡®] åŒ…å«JSONå­˜å‚¨æ ‡ç­¾
Files *files.Files `json:"files" gorm:"type:json"`
```

#### Q: èšåˆè®¡ç®—è¯¯ç”¨
```go
// âŒ é”™è¯¯ï¼šæ™®é€šå•é€‰å­—æ®µä½¿ç”¨èšåˆè®¡ç®—
type OrderFormReq struct {
    CustomerID int `json:"customer_id" widget:"type:select"`  // åªèƒ½é€‰ä¸€ä¸ªå®¢æˆ·
    ProductID  int `json:"product_id" widget:"type:select"`   // åªèƒ½é€‰ä¸€ä¸ªå•†å“
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "customer_id": func() (*usercall.OnInputFuzzyResp, error) {
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // âŒ å•é€‰æ°¸è¿œæ˜¯1ï¼Œæ— æ„ä¹‰
                "å®¢æˆ·æ•°é‡": "count(å®¢æˆ·åç§°)",      // é”™è¯¯ï¼šæ°¸è¿œæ˜¯1
                "å¹³å‡å¹´é¾„": "avg(å®¢æˆ·å¹´é¾„)",       // é”™è¯¯ï¼šæ°¸è¿œæ˜¯é€‰ä¸­å®¢æˆ·çš„å¹´é¾„
                "æœ€é«˜ç­‰çº§": "max(å®¢æˆ·ç­‰çº§)",       // é”™è¯¯ï¼šæ°¸è¿œæ˜¯é€‰ä¸­å®¢æˆ·çš„ç­‰çº§
            },
        }, nil
    },
}

// [æ­£ç¡®] æ™®é€šå•é€‰å­—æ®µè¿”å›é™æ€ä¿¡æ¯
OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "customer_id": func() (*usercall.OnInputFuzzyResp, error) {
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [è¯´æ˜] æœ‰ç”¨çš„é™æ€ä¿¡æ¯
                "ç»“ç®—å‘¨æœŸ": "æœˆç»“30å¤©",
                "ä¿¡ç”¨ç­‰çº§": "AAAçº§",
                "è”ç³»æ–¹å¼": "400-123-4567",
            },
        }, nil
    },
}

// [æ­£ç¡®] Listå†…å•é€‰å­—æ®µå¯ä»¥èšåˆï¼ˆå› ä¸ºæœ‰å¤šè¡Œæ•°æ®ï¼‰
type OrderFormReq struct {
    OrderItems []OrderItem `json:"order_items" widget:"type:list"`
}

type OrderItem struct {
    ProductID int `json:"product_id" widget:"type:select"`  // æ¯è¡Œé€‰æ‹©ä¸€ä¸ªå•†å“
    Quantity int `json:"quantity" widget:"type:number"`
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_id": func() (*usercall.OnInputFuzzyResp, error) {
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [æ”¯æŒ] Listå†…å•é€‰èšåˆæœ‰æ„ä¹‰
                "å•†å“ç§ç±»": "count(å•†å“åç§°)",           // é€‰äº†å‡ ç§ä¸åŒçš„å•†å“
                "å•†å“æ€»æ•°": "sum(quantity)",            // æ‰€æœ‰å•†å“çš„æ€»æ•°é‡
                "å¹³å‡å•ä»·": "avg(å•†å“ä»·æ ¼)",            // é€‰ä¸­å•†å“çš„å¹³å‡ä»·æ ¼
            },
        }, nil
    },
}

// [æ­£ç¡®] å¤šé€‰å­—æ®µæ°¸è¿œæ”¯æŒèšåˆ
type OrderFormReq struct {
    ProductIDs []int `json:"product_ids" widget:"type:multiselect"`  // å¤šé€‰ï¼ç”¨æˆ·å¯ä»¥é€‰æ‹©å¤šä¸ªå•†å“
}

OnInputFuzzyMap: map[string]runner.OnInputFuzzy{
    "product_ids": func() (*usercall.OnInputFuzzyResp, error) {
        return &usercall.OnInputFuzzyResp{
            Statistics: map[string]interface{}{
                // [æ”¯æŒ] å¤šé€‰èšåˆè®¡ç®—æ°¸è¿œæœ‰æ„ä¹‰
                "é€‰ä¸­å•†å“æ•°": "count(å•†å“åç§°)",           // é€‰äº†å‡ ä¸ªå•†å“
                "é€‰ä¸­å•†å“æ€»ä»·": "sum(å•†å“ä»·æ ¼)",          // æ€»ä»·æ ¼
                "æœ€ä½å•ä»·": "min(å•†å“ä»·æ ¼)",              // é€‰ä¸­å•†å“ä¸­æœ€ä¾¿å®œçš„
                "æœ€é«˜å•ä»·": "max(å•†å“ä»·æ ¼)",              // é€‰ä¸­å•†å“ä¸­æœ€è´µçš„
            },
        }, nil
    },
}
```

**ğŸ“‹ èšåˆè®¡ç®—ä½¿ç”¨è§„åˆ™æ€»ç»“**ï¼š

1. **æ™®é€šå•é€‰å­—æ®µ**ï¼ˆ`select`ï¼‰ï¼šâŒ ä¸èƒ½èšåˆï¼Œè¿”å›é™æ€ä¿¡æ¯
2. **æ™®é€šå¤šé€‰å­—æ®µ**ï¼ˆ`multiselect`ï¼‰ï¼š[æ”¯æŒ] æ°¸è¿œæ”¯æŒèšåˆ
3. **Listå†…å•é€‰å­—æ®µ**ï¼ˆ`list` + `select`ï¼‰ï¼š[æ”¯æŒ] å¯ä»¥èšåˆï¼ˆæœ‰å¤šè¡Œæ•°æ®ï¼‰
4. **Listå†…å¤šé€‰å­—æ®µ**ï¼ˆ`list` + `multiselect`ï¼‰ï¼š[æ”¯æŒ] æœ€æœ‰æ„ä¹‰ï¼ˆåŒé‡èšåˆï¼‰

**ğŸ’¡ åˆ¤æ–­æ ‡å‡†**ï¼šçœ‹ç”¨æˆ·èƒ½å¦é€‰æ‹©å¤šä¸ªé¡¹ç›®ï¼Œèƒ½é€‰æ‹©å¤šä¸ªå°±å¯ä»¥èšåˆï¼Œåªèƒ½é€‰æ‹©ä¸€ä¸ªå°±ä¸èƒ½èšåˆï¼ˆé™¤éåœ¨Listå†…ï¼‰ã€‚

---

## æ€»ç»“

function-goæ˜¯ä¸€ä¸ªå¼ºå¤§çš„AIåŸç”Ÿå…¨æ ˆå¼€å‘æ¡†æ¶ï¼Œé€šè¿‡ç»“æ„ä½“æ ‡ç­¾è‡ªåŠ¨ç”ŸæˆWebç•Œé¢ï¼Œæ”¯æŒå®Œæ•´çš„CRUDæ“ä½œã€æ™ºèƒ½å›è°ƒæœºåˆ¶å’Œè‡ªåŠ¨å»ºè¡¨åŠŸèƒ½ã€‚

### æ ¸å¿ƒä¼˜åŠ¿

1. **å¼€å‘æ•ˆç‡é«˜**ï¼šä¸€ä¸ªæ–‡ä»¶å³ä¸€ä¸ªåº”ç”¨ï¼Œå¿«é€ŸåŸå‹å¼€å‘
2. **å­¦ä¹ æˆæœ¬ä½**ï¼šæ ‡å‡†Goè¯­æ³•ï¼Œæ— éœ€å­¦ä¹ é¢å¤–DSL
3. **åŠŸèƒ½å®Œæ•´**ï¼šæ¶µç›–è¡¨å•ã€è¡¨æ ¼ã€æ–‡ä»¶ã€å›è°ƒç­‰å…¨éƒ¨åŠŸèƒ½
4. **å¯æ‰©å±•æ€§å¼º**ï¼šæ”¯æŒå¤æ‚ä¸šåŠ¡é€»è¾‘å’Œè‡ªå®šä¹‰å›è°ƒ
5. **éƒ¨ç½²ç®€å•**ï¼šå•æ–‡ä»¶éƒ¨ç½²ï¼Œæ”¯æŒå¤šç§Ÿæˆ·éš”ç¦»

### é€‚ç”¨åœºæ™¯

- ä¼ä¸šç®¡ç†ç³»ç»Ÿï¼ˆCRMã€ERPã€OAï¼‰
- æ•°æ®å¤„ç†å·¥å…·
- å¿«é€ŸåŸå‹å¼€å‘
- APIæœåŠ¡æ„å»º
- è¡¨å•å’Œå·¥ä½œæµç³»ç»Ÿ

é€šè¿‡æœ¬æŒ‡å—ï¼Œå¼€å‘è€…å¯ä»¥å¿«é€ŸæŒæ¡function-goæ¡†æ¶çš„ä½¿ç”¨æ–¹æ³•ï¼Œé«˜æ•ˆæ„å»ºå„ç±»Webåº”ç”¨ã€‚