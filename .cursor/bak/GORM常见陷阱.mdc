---
description: GORMä½¿ç”¨ä¸­çš„å¸¸è§é™·é˜±å’Œè§£å†³æ–¹æ¡ˆ
globs:
alwaysApply: true
---

# GORMå¸¸è§é™·é˜±

## âš ï¸ é™·é˜±1ï¼šé“¾å¼è°ƒç”¨å¿˜è®°é‡æ–°èµ‹å€¼

### é—®é¢˜æè¿°
GORMçš„æ–¹æ³•è°ƒç”¨ï¼ˆå¦‚ `Where`ã€`Limit` ç­‰ï¼‰éƒ½ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ `*gorm.DB` å®ä¾‹ï¼Œè€Œä¸æ˜¯ä¿®æ”¹åŸæœ‰çš„å®ä¾‹ã€‚

### é”™è¯¯ä»£ç 
```go
db := ctx.MustGetOrInitDB()

// âŒ é”™è¯¯ï¼šæ²¡æœ‰é‡æ–°èµ‹å€¼ï¼Œæ¡ä»¶ä¸ä¼šç”Ÿæ•ˆ
db.Where("id = ?", 1)
db.Where("status = ?", "æ­£å¸¸")
db.Limit(10)

db.Find(&items) // è¿™é‡Œä¼šæŸ¥è¯¢æ‰€æœ‰æ•°æ®ï¼Œå¿½ç•¥ä¸Šé¢çš„æ¡ä»¶ï¼
```

### æ­£ç¡®ä»£ç 
```go
db := ctx.MustGetOrInitDB()

// âœ… æ­£ç¡®ï¼šé‡æ–°èµ‹å€¼ï¼Œæ¡ä»¶ç”Ÿæ•ˆ
db = db.Where("id = ?", 1)
db = db.Where("status = ?", "æ­£å¸¸")
db = db.Limit(10)

db.Find(&items) // è¿™é‡Œä¼šåº”ç”¨æ‰€æœ‰æ¡ä»¶
```

### è®°å¿†å£è¯€
**`db = db.Where()` è€Œä¸æ˜¯ `db.Where()`**

## âš ï¸ é™·é˜±2ï¼šåœ¨æ¡ä»¶åˆ†æ”¯ä¸­å¿˜è®°é‡æ–°èµ‹å€¼

### é”™è¯¯ä»£ç 
```go
if req.IsByFiledValues() {
    db.Where("id in ?", req.GetFiledValues()) // âŒ æ²¡æœ‰é‡æ–°èµ‹å€¼
} else if req.IsByFiledValue() {
    db.Where("id = ?", req.GetFiledValue()).Limit(1) // âŒ æ²¡æœ‰é‡æ–°èµ‹å€¼
} else {
    db.Where("name LIKE ?", "%"+keyword+"%").Limit(20) // âŒ æ²¡æœ‰é‡æ–°èµ‹å€¼
}
db.Find(&items) // æ¡ä»¶ä¸ä¼šç”Ÿæ•ˆï¼
```

### æ­£ç¡®ä»£ç 
```go
if req.IsByFiledValues() {
    db = db.Where("id in ?", req.GetFiledValues()) // âœ… é‡æ–°èµ‹å€¼
} else if req.IsByFiledValue() {
    db = db.Where("id = ?", req.GetFiledValue()).Limit(1) // âœ… é‡æ–°èµ‹å€¼
} else {
    db = db.Where("name LIKE ?", "%"+keyword+"%").Limit(20) // âœ… é‡æ–°èµ‹å€¼
}
db.Find(&items) // æ¡ä»¶ç”Ÿæ•ˆï¼
```

## âš ï¸ é™·é˜±3ï¼šé“¾å¼è°ƒç”¨ä¸­æ–­

### é”™è¯¯ä»£ç 
```go
// âŒ é”™è¯¯ï¼šé“¾å¼è°ƒç”¨ä¸­æ–­ï¼Œåé¢çš„æ¡ä»¶ä¸ä¼šç”Ÿæ•ˆ
db.Where("id = ?", 1)
db.Where("status = ?", "æ­£å¸¸") // è¿™é‡Œä¼šè¦†ç›–å‰é¢çš„æ¡ä»¶
db.Limit(10)
```

### æ­£ç¡®ä»£ç 
```go
// âœ… æ­£ç¡®ï¼šä¿æŒé“¾å¼è°ƒç”¨
db = db.Where("id = ?", 1).
    Where("status = ?", "æ­£å¸¸").
    Limit(10)
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **å§‹ç»ˆé‡æ–°èµ‹å€¼**ï¼š`db = db.Where()`
2. **ä¿æŒé“¾å¼è°ƒç”¨**ï¼šé¿å…ä¸­æ–­é“¾å¼è°ƒç”¨
3. **æ¡ä»¶åˆ†æ”¯ç»Ÿä¸€**ï¼šåœ¨æ¡ä»¶åˆ†æ”¯ä¸­éƒ½è¦é‡æ–°èµ‹å€¼
4. **æµ‹è¯•éªŒè¯**ï¼šç¡®ä¿æ¡ä»¶æ­£ç¡®åº”ç”¨

## ğŸ” è°ƒè¯•æŠ€å·§

å¦‚æœæ€€ç–‘æ¡ä»¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œå¯ä»¥ï¼š

1. **æ‰“å°SQL**ï¼š
```go
db = db.Debug().Where("id = ?", 1)
db.Find(&items) // ä¼šæ‰“å°æ‰§è¡Œçš„SQL
```

2. **æ£€æŸ¥æ¡ä»¶**ï¼š
```go
ctx.Logger.Infof("æŸ¥è¯¢æ¡ä»¶: %+v", db.Statement.Clauses)
```

3. **éªŒè¯ç»“æœ**ï¼š
```go
var count int64
db.Count(&count)
ctx.Logger.Infof("æŸ¥è¯¢ç»“æœæ•°é‡: %d", count)
```