# 场景分析与文档规划

## 📋 项目背景

基于function-go框架的SFT训练数据优化项目，针对5种不同开发场景创建专门的文档，避免大模型在生成代码时被无关信息干扰，提升训练效果和代码生成质量。

## 🎯 核心目标

1. **场景分离**：为不同复杂度场景提供精准的框架知识
2. **减少干扰**：避免大模型学习到不相关的功能特性
3. **提升质量**：确保生成的代码符合场景特点和最佳实践
4. **降低门槛**：让开发者快速找到适合自己场景的文档

## 📊 场景分析（按难度排序）

### 1. 简单CRUD（Table函数） - L1级别 ⭐

**核心特点**：基础数据管理，无复杂业务逻辑
**适用场景**：用户管理、分类管理、基础配置等
**技术栈**：GORM + 基础widget + 简单回调
**难度**：最简单

**重点介绍内容**：
- ✅ 基础数据模型设计（ID、时间字段、软删除）
- ✅ OnTableAddRows/UpdateRows/DeleteRows回调
- ✅ permission标签（read/create/update）
- ✅ search标签（like/in/gte/lte）
- ✅ *files.Files字段（gorm:type:json）
- ✅ AutoCrudTable自动CRUD
- ✅ 基础验证规则（required、min、max等）

**不需要介绍**：
- ❌ OnInputFuzzy（无复杂搜索需求）
- ❌ AutoUpdateConfig（无配置管理）
- ❌ DryRun（无外部API调用）
- ❌ 复杂业务逻辑处理

**文档结构**：
```
简单CRUD开发指南.md
├── 1. 数据模型设计
├── 2. 基础字段配置
├── 3. 权限控制
├── 4. 搜索功能
├── 5. 文件上传
├── 6. 自动CRUD
└── 7. 最佳实践
```

### 2. 无依赖Form函数 - L1级别 ⭐

**核心特点**：纯工具函数，但可能包含配置和数据库操作
**适用场景**：文件转换、数据计算、格式处理、数据导入导出等
**技术栈**：基础widget + 文件处理 + 数据验证 + 配置管理 + 数据库操作
**难度**：简单

**重点介绍内容**：
- ✅ 基础widget组件（input、select、datetime等）
- ✅ 文件上传处理（*files.Files）
- ✅ 文件输出展示（*files.Files）
- ✅ 数据验证（validate标签）
- ✅ 响应结构设计
- ✅ 错误处理机制
- ✅ 配置管理（AutoUpdateConfig）
- ✅ 数据库操作（ctx.MustGetOrInitDB()）
- ✅ 文件操作最佳实践

**不需要介绍**：
- ❌ search/permission标签（非table函数）
- ❌ OnTableAddRows等回调（非table函数）
- ❌ 多表关联查询（无依赖场景）
- ❌ 复杂业务逻辑（专注工具功能）

**文档结构**：
```
无依赖Form函数开发指南.md
├── 1. 基础组件使用
├── 2. 文件上传处理
├── 3. 文件输出展示
├── 4. 数据验证
├── 5. 响应设计
├── 6. 错误处理
├── 7. 配置管理
├── 8. 数据库操作
└── 9. 工具函数最佳实践
```

### 3. 有依赖工具 - L2级别 ⭐⭐

**核心特点**：依赖外部可执行程序，工具函数
**适用场景**：视频处理、图片处理、文件转换等（如FFmpeg、ImageMagick）
**技术栈**：依赖管理 + 命令行调用 + 工具函数 + 文件处理
**难度**：中等

**重点介绍内容**：
- ✅ 依赖安装和环境管理
- ✅ 命令行调用（exec.Command）
- ✅ 工具函数暴露（<rag-api>标签）
- ✅ 文件处理（*files.Files）
- ✅ 错误处理和日志记录
- ✅ 跨文件依赖管理
- ✅ 临时文件管理
- ✅ 可执行文件检测
- ✅ 数据验证（validate标签）
- ✅ 配置管理（AutoUpdateConfig）
- ✅ 基础widget组件
- ✅ 响应结构设计

**不需要介绍**：
- ❌ 多表关联查询（工具函数场景）
- ❌ 复杂业务逻辑（专注工具功能）
- ❌ 外部API集成（已有专门文档）

**文档结构**：
```
有依赖工具开发指南.md
├── 1. 依赖管理概述
├── 2. 工具安装和环境检测
├── 3. 命令行调用基础
├── 4. 工具函数暴露（rag-api）
├── 5. 文件处理
├── 6. 错误处理
├── 7. 跨文件依赖管理
├── 8. 临时文件管理
├── 9. 可执行文件检测
└── 10. 最佳实践
```

### 4. 外部API集成 - L2级别 ⭐⭐

**核心特点**：调用外部服务，数据转换
**适用场景**：支付接口、短信服务、第三方API等
**技术栈**：HTTP客户端 + 数据转换 + 错误处理
**难度**：中等

**重点介绍内容**：
- ✅ HTTP请求处理
- ✅ 数据格式转换
- ✅ 错误处理和重试
- ✅ 认证机制（API Key、OAuth、JWT等）
- ✅ 限流和熔断
- ✅ 日志记录
- ✅ DryRun模式
- ✅ 请求参数验证
- ✅ 响应数据解析
- ✅ 超时控制
- ✅ 请求头管理
- ✅ 请求体构建
- ✅ 响应状态码处理
- ✅ 错误码映射
- ✅ 接口文档生成

**不需要介绍**：
- ❌ 数据库操作（无持久化）
- ❌ 复杂业务逻辑（专注API调用）
- ❌ 文件处理（非核心功能）
- ❌ 多表关联查询（无数据库操作）

**文档结构**：
```
外部API集成开发指南.md
├── 1. HTTP客户端配置
├── 2. 认证机制
├── 3. 数据转换
├── 4. 错误处理
├── 5. 重试机制
├── 6. 限流熔断
├── 7. 日志记录
├── 8. DryRun模式
├── 9. 请求参数验证
├── 10. 响应数据解析
├── 11. 超时控制
├── 12. 请求头管理
├── 13. 请求体构建
├── 14. 响应状态码处理
├── 15. 错误码映射
├── 16. 接口文档生成
└── 17. 测试用例编写
```

### 5. 复杂业务系统（Form+Table混合） - L3级别 ⭐⭐⭐

**核心特点**：多表关联，复杂业务逻辑
**适用场景**：订单系统、库存管理、工作流等
**技术栈**：GORM + 复杂widget + 多回调 + 业务逻辑
**难度**：最复杂

**重点介绍内容**：
- ✅ 多表关联查询（Preload、JOIN）
- ✅ OnInputFuzzy聚合计算
- ✅ 复杂业务规则验证
- ✅ 事务处理
- ✅ 权限控制
- ✅ 复杂业务逻辑处理
- ✅ 文件上传处理（*files.Files）
- ✅ 文件输出展示（*files.Files）
- ✅ 配置管理（AutoUpdateConfig）
- ✅ 数据库操作（ctx.MustGetOrInitDB()）
- ✅ 基础widget组件
- ✅ 数据验证（validate标签）
- ✅ 错误处理机制
- ✅ 回调机制（OnTableAddRows等）
- ✅ 搜索功能（search标签）
- ✅ 权限控制（permission标签）

**不需要介绍**：
- ❌ 外部API集成（已有专门文档）
- ❌ 命令行工具（非Web应用场景）

**文档结构**：
```
复杂业务系统开发指南.md
├── 1. 多表关联设计
├── 2. 复杂查询优化
├── 3. 业务规则验证
├── 4. 聚合计算
├── 5. 事务处理
├── 6. 权限控制
├── 7. 文件处理
├── 8. 配置管理
├── 9. 数据库操作
├── 10. 基础组件使用
├── 11. 数据验证
├── 12. 错误处理
├── 13. 回调机制
├── 14. 搜索功能
├── 15. 复杂业务逻辑
└── 16. 性能优化
```

## 📚 文档规划

### 文档命名规范
- 格式：`{场景名称}开发指南.md`
- 位置：`function-go/docs/scenarios/`
- 示例：`简单CRUD开发指南.md`

### 文档结构标准
每个场景文档都包含：
1. **场景概述**：适用场景、技术特点、复杂度级别
2. **核心功能**：该场景需要掌握的关键功能
3. **代码示例**：完整的、可运行的代码示例
4. **最佳实践**：该场景下的开发建议
5. **常见问题**：该场景下的常见错误和解决方案

### 内容组织原则
1. **场景隔离**：每个文档只介绍该场景需要的功能
2. **循序渐进**：从简单到复杂，逐步深入
3. **实用导向**：重点介绍实际开发中常用的功能
4. **代码完整**：所有示例都是完整可运行的代码

## 🚀 实施计划

### 第一阶段：基础场景（1-2周）
- [ ] 简单CRUD开发指南
- [ ] 无依赖Form函数开发指南

### 第二阶段：进阶场景（2-3周）
- [ ] 外部API集成开发指南
- [ ] 配置管理开发指南

### 第三阶段：复杂场景（3-4周）
- [ ] 复杂业务系统开发指南
- [ ] 场景间最佳实践总结

### 第四阶段：优化完善（1-2周）
- [ ] 文档内容优化
- [ ] 示例代码完善
- [ ] 用户反馈收集

## 📈 预期效果

1. **提升训练质量**：大模型学习到更精准的框架知识
2. **降低学习成本**：开发者快速找到适合自己场景的文档
3. **减少错误率**：避免大模型生成不相关的代码
4. **提升开发效率**：标准化的开发流程和最佳实践

## 🔄 持续优化

1. **用户反馈**：收集开发者使用反馈，持续优化文档内容
2. **场景扩展**：根据实际需求，增加新的场景类型
3. **技术更新**：跟随框架版本更新，及时更新文档内容
4. **质量监控**：通过代码生成质量评估，持续改进文档效果

---

**文档维护者**：function-go团队  
**最后更新**：2024年12月  
**版本**：v1.0
