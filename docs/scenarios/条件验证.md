# Go Validator æ¡ä»¶éªŒè¯æ ‡ç­¾è¯¦ç»†æ–‡æ¡£

## ğŸ¯ ä»€ä¹ˆæ˜¯æ¡ä»¶éªŒè¯ï¼Ÿ

æ¡ä»¶éªŒè¯æ˜¯æŒ‡**æ ¹æ®å…¶ä»–å­—æ®µçš„å€¼æ¥å†³å®šå½“å‰å­—æ®µæ˜¯å¦å¿…å¡«æˆ–å¿…ä¸å¡«**çš„éªŒè¯æ–¹å¼ã€‚å®ƒè®©è¡¨å•éªŒè¯æ›´åŠ æ™ºèƒ½å’Œçµæ´»ã€‚

## ğŸ” æ¡ä»¶éªŒè¯æ ‡ç­¾è¯¦è§£

### 1. required_if - æ¡ä»¶å¿…å¡«

**è¯­æ³•**ï¼š`required_if=å­—æ®µå å€¼`

**å«ä¹‰**ï¼šå½“æŒ‡å®šå­—æ®µç­‰äºæŒ‡å®šå€¼æ—¶ï¼Œå½“å‰å­—æ®µå¿…å¡«

```go
type OrderForm struct {
    OrderType string `json:"order_type" validate:"required,oneof=åœ¨çº¿ çº¿ä¸‹"`
    
    // å½“ order_type ç­‰äº "åœ¨çº¿" æ—¶ï¼Œaddress å¿…å¡«
    // required_if=order_type åœ¨çº¿: å½“order_typeå­—æ®µç­‰äº"åœ¨çº¿"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    Address string `json:"address" validate:"required_if=order_type åœ¨çº¿"`
    
    // å½“ order_type ç­‰äº "çº¿ä¸‹" æ—¶ï¼Œstore_id å¿…å¡«
    // required_if=order_type çº¿ä¸‹: å½“order_typeå­—æ®µç­‰äº"çº¿ä¸‹"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    StoreId int `json:"store_id" validate:"required_if=order_type çº¿ä¸‹"`
}
```

**éªŒè¯é€»è¾‘è¡¨**ï¼š
| order_type å€¼ | address éªŒè¯ | store_id éªŒè¯ |
|-------------|-------------|--------------|
| "åœ¨çº¿" | âœ… å¿…å¡« | âŒ ä¸å¿…å¡« |
| "çº¿ä¸‹" | âŒ ä¸å¿…å¡« | âœ… å¿…å¡« |
| å…¶ä»–å€¼ | âŒ ä¸å¿…å¡« | âŒ ä¸å¿…å¡« |

---

### 2. required_unless - åå‘æ¡ä»¶å¿…å¡«

**è¯­æ³•**ï¼š`required_unless=å­—æ®µå å€¼`

**å«ä¹‰**ï¼šå½“æŒ‡å®šå­—æ®µä¸ç­‰äºæŒ‡å®šå€¼æ—¶ï¼Œå½“å‰å­—æ®µå¿…å¡«

```go
type UserForm struct {
    UserType string `json:"user_type" validate:"required,oneof=ç®¡ç†å‘˜ æ™®é€šç”¨æˆ· æ¸¸å®¢"`
    
    // å½“ user_type ä¸ç­‰äº "ç®¡ç†å‘˜" æ—¶ï¼Œdepartment å¿…å¡«
    // required_unless=user_type ç®¡ç†å‘˜: å½“user_typeå­—æ®µä¸ç­‰äº"ç®¡ç†å‘˜"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    Department string `json:"department" validate:"required_unless=user_type ç®¡ç†å‘˜"`
    
    // å½“ user_type ä¸ç­‰äº "æ¸¸å®¢" æ—¶ï¼Œemail å¿…å¡«
    // required_unless=user_type æ¸¸å®¢: å½“user_typeå­—æ®µä¸ç­‰äº"æ¸¸å®¢"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    Email string `json:"email" validate:"required_unless=user_type æ¸¸å®¢,email"`
}
```

**éªŒè¯é€»è¾‘è¡¨**ï¼š
| user_type å€¼ | department éªŒè¯ | email éªŒè¯ |
|-------------|---------------|-----------|
| "ç®¡ç†å‘˜" | âŒ ä¸å¿…å¡« | âœ… å¿…å¡« |
| "æ™®é€šç”¨æˆ·" | âœ… å¿…å¡« | âœ… å¿…å¡« |
| "æ¸¸å®¢" | âœ… å¿…å¡« | âŒ ä¸å¿…å¡« |

---

### 3. excluded_if - æ¡ä»¶å¿…ä¸å¡«

**è¯­æ³•**ï¼š`excluded_if=å­—æ®µå å€¼`

**å«ä¹‰**ï¼šå½“æŒ‡å®šå­—æ®µç­‰äºæŒ‡å®šå€¼æ—¶ï¼Œå½“å‰å­—æ®µå¿…é¡»ä¸ºç©º

```go
type FileShareForm struct {
    DownloadLimit string `json:"download_limit" validate:"required,oneof=é™åˆ¶æ¬¡æ•° ä¸é™æ¬¡æ•°"`
    
    // å½“ download_limit ç­‰äº "ä¸é™æ¬¡æ•°" æ—¶ï¼Œmax_downloads å¿…ä¸å¡«
    // excluded_if=download_limit ä¸é™æ¬¡æ•°: å½“download_limitå­—æ®µç­‰äº"ä¸é™æ¬¡æ•°"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    MaxDownloads int `json:"max_downloads" validate:"excluded_if=download_limit ä¸é™æ¬¡æ•°,min=1,max=10000"`
    
    // å½“ download_limit ç­‰äº "é™åˆ¶æ¬¡æ•°" æ—¶ï¼Œunlimited_flag å¿…ä¸å¡«
    // excluded_if=download_limit é™åˆ¶æ¬¡æ•°: å½“download_limitå­—æ®µç­‰äº"é™åˆ¶æ¬¡æ•°"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    UnlimitedFlag bool `json:"unlimited_flag" validate:"excluded_if=download_limit é™åˆ¶æ¬¡æ•°"`
}
```

**éªŒè¯é€»è¾‘è¡¨**ï¼š
| download_limit å€¼ | max_downloads éªŒè¯ | unlimited_flag éªŒè¯ |
|-----------------|------------------|-------------------|
| "é™åˆ¶æ¬¡æ•°" | âœ… å¯ä»¥å¡«å†™ | âŒ å¿…ä¸å¡« |
| "ä¸é™æ¬¡æ•°" | âŒ å¿…ä¸å¡« | âœ… å¯ä»¥å¡«å†™ |
| å…¶ä»–å€¼ | âœ… å¯ä»¥å¡«å†™ | âœ… å¯ä»¥å¡«å†™ |

---

### 4. excluded_unless - åå‘æ¡ä»¶å¿…ä¸å¡«

**è¯­æ³•**ï¼š`excluded_unless=å­—æ®µå å€¼`

**å«ä¹‰**ï¼šå½“æŒ‡å®šå­—æ®µä¸ç­‰äºæŒ‡å®šå€¼æ—¶ï¼Œå½“å‰å­—æ®µå¿…é¡»ä¸ºç©º

```go
type AdminForm struct {
    UserType string `json:"user_type" validate:"required,oneof=ç®¡ç†å‘˜ æ™®é€šç”¨æˆ· æ¸¸å®¢"`
    
    // å½“ user_type ä¸ç­‰äº "ç®¡ç†å‘˜" æ—¶ï¼Œadmin_level å¿…ä¸å¡«
    // excluded_unless=user_type ç®¡ç†å‘˜: å½“user_typeå­—æ®µä¸ç­‰äº"ç®¡ç†å‘˜"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    AdminLevel int `json:"admin_level" validate:"excluded_unless=user_type ç®¡ç†å‘˜,min=1,max=5"`
    
    // å½“ user_type ä¸ç­‰äº "æ¸¸å®¢" æ—¶ï¼Œguest_info å¿…ä¸å¡«
    // excluded_unless=user_type æ¸¸å®¢: å½“user_typeå­—æ®µä¸ç­‰äº"æ¸¸å®¢"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    GuestInfo string `json:"guest_info" validate:"excluded_unless=user_type æ¸¸å®¢"`
}
```

**éªŒè¯é€»è¾‘è¡¨**ï¼š
| user_type å€¼ | admin_level éªŒè¯ | guest_info éªŒè¯ |
|-------------|----------------|---------------|
| "ç®¡ç†å‘˜" | âœ… å¯ä»¥å¡«å†™ | âŒ å¿…ä¸å¡« |
| "æ™®é€šç”¨æˆ·" | âŒ å¿…ä¸å¡« | âŒ å¿…ä¸å¡« |
| "æ¸¸å®¢" | âŒ å¿…ä¸å¡« | âœ… å¯ä»¥å¡«å†™ |

---

## ğŸ”§ ç»„åˆä½¿ç”¨ç¤ºä¾‹

```go
type ComplexForm struct {
    // åŸºç¡€å­—æ®µ
    FormType string `json:"form_type" validate:"required,oneof=ä¸ªäºº ä¼ä¸š æ”¿åºœ"`
    UserType string `json:"user_type" validate:"required,oneof=ç®¡ç†å‘˜ æ™®é€šç”¨æˆ· æ¸¸å®¢"`
    
    // æ¡ä»¶å¿…å¡«å­—æ®µ
    // å½“ form_type ç­‰äº "ä¼ä¸š" æ—¶ï¼Œcompany_name å¿…å¡«
    // required_if=form_type ä¼ä¸š: å½“form_typeå­—æ®µç­‰äº"ä¼ä¸š"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    CompanyName string `json:"company_name" validate:"required_if=form_type ä¼ä¸š"`
    
    // å½“ user_type ä¸ç­‰äº "æ¸¸å®¢" æ—¶ï¼Œemail å¿…å¡«
    // required_unless=user_type æ¸¸å®¢: å½“user_typeå­—æ®µä¸ç­‰äº"æ¸¸å®¢"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    Email string `json:"email" validate:"required_unless=user_type æ¸¸å®¢,email"`
    
    // æ¡ä»¶å¿…ä¸å¡«å­—æ®µ
    // å½“ form_type ç­‰äº "ä¸ªäºº" æ—¶ï¼Œcompany_info å¿…ä¸å¡«
    // excluded_if=form_type ä¸ªäºº: å½“form_typeå­—æ®µç­‰äº"ä¸ªäºº"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    CompanyInfo string `json:"company_info" validate:"excluded_if=form_type ä¸ªäºº"`
    
    // å½“ user_type ä¸ç­‰äº "ç®¡ç†å‘˜" æ—¶ï¼Œadmin_level å¿…ä¸å¡«
    // excluded_unless=user_type ç®¡ç†å‘˜: å½“user_typeå­—æ®µä¸ç­‰äº"ç®¡ç†å‘˜"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    AdminLevel int `json:"admin_level" validate:"excluded_unless=user_type ç®¡ç†å‘˜,min=1,max=5"`
    
    // å¤šé‡æ¡ä»¶éªŒè¯
    // å½“ form_type ç­‰äº "ä¼ä¸š" ä¸” user_type ç­‰äº "ç®¡ç†å‘˜" æ—¶ï¼Œlicense_number å¿…å¡«
    // required_if=form_type ä¼ä¸š: å½“form_typeå­—æ®µç­‰äº"ä¼ä¸š"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    // required_if=user_type ç®¡ç†å‘˜: å½“user_typeå­—æ®µç­‰äº"ç®¡ç†å‘˜"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    LicenseNumber string `json:"license_number" validate:"required_if=form_type ä¼ä¸š,required_if=user_type ç®¡ç†å‘˜"`
}
```

## âš ï¸ é‡è¦æ³¨æ„äº‹é¡¹

### 1. å­—æ®µåä½¿ç”¨ JSON æ ‡ç­¾
```go
type User struct {
    UserType string `json:"user_type"`  // ä½¿ç”¨ user_typeï¼Œä¸æ˜¯ UserType
}

// æ­£ç¡®
AdminLevel int `validate:"required_if=user_type ç®¡ç†å‘˜"`

// é”™è¯¯
AdminLevel int `validate:"required_if=UserType ç®¡ç†å‘˜"`
```

### 2. å€¼åŒ¹é…å®Œå…¨ä¸€è‡´
```go
// æ­£ç¡®ï¼šå€¼å®Œå…¨åŒ¹é…
Status string `validate:"required_if=user_type ç®¡ç†å‘˜"`

// é”™è¯¯ï¼šå€¼ä¸åŒ¹é…
Status string `validate:"required_if=user_type ç®¡ç†å‘˜ç”¨æˆ·"`  // å¤šäº†"ç”¨æˆ·"
```

### 3. ç©ºæ ¼æ•æ„Ÿ
```go
// æ­£ç¡®ï¼šå­—æ®µåå’Œå€¼ä¹‹é—´ç”¨ç©ºæ ¼åˆ†éš”
validate:"required_if=user_type ç®¡ç†å‘˜"

// é”™è¯¯ï¼šå¤šä½™ç©ºæ ¼
validate:"required_if=user_type  ç®¡ç†å‘˜"  // ä¸¤ä¸ªç©ºæ ¼
```

### 4. å¤šä¸ªæ¡ä»¶éªŒè¯
```go
// å¤šä¸ªæ¡ä»¶ç”¨é€—å·åˆ†éš”
AdminLevel int `validate:"required_if=user_type ç®¡ç†å‘˜,min=1,max=5,excluded_if=user_type æ¸¸å®¢"`
```

## ğŸ¯ å®é™…åº”ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ–‡ä»¶åˆ†äº«ç³»ç»Ÿ
```go
type FileShareForm struct {
    FileType string `json:"file_type" validate:"required,oneof=ä¸´æ—¶æ–‡ä»¶ æ°¸ä¹…æ–‡ä»¶"`
    DownloadLimit string `json:"download_limit" validate:"required,oneof=é™åˆ¶æ¬¡æ•° ä¸é™æ¬¡æ•°"`
    
    // æ°¸ä¹…æ–‡ä»¶ä¸èƒ½è®¾ç½®è¿‡æœŸæ—¶é—´
    // excluded_if=file_type æ°¸ä¹…æ–‡ä»¶: å½“file_typeå­—æ®µç­‰äº"æ°¸ä¹…æ–‡ä»¶"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    ExpiresInDays int `json:"expires_in_days" validate:"excluded_if=file_type æ°¸ä¹…æ–‡ä»¶,min=1,max=365"`
    
    // é€‰æ‹©"é™åˆ¶æ¬¡æ•°"æ—¶å¿…é¡»è®¾ç½®æœ€å¤§ä¸‹è½½æ¬¡æ•°
    // required_if=download_limit é™åˆ¶æ¬¡æ•°: å½“download_limitå­—æ®µç­‰äº"é™åˆ¶æ¬¡æ•°"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    MaxDownloads int `json:"max_downloads" validate:"required_if=download_limit é™åˆ¶æ¬¡æ•°,min=1,max=10000"`
    
    // é€‰æ‹©"ä¸é™æ¬¡æ•°"æ—¶ä¸èƒ½è®¾ç½®æœ€å¤§ä¸‹è½½æ¬¡æ•°
    // excluded_if=download_limit ä¸é™æ¬¡æ•°: å½“download_limitå­—æ®µç­‰äº"ä¸é™æ¬¡æ•°"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    MaxDownloads2 int `json:"max_downloads2" validate:"excluded_if=download_limit ä¸é™æ¬¡æ•°"`
}
```

### åœºæ™¯2ï¼šç”¨æˆ·æ³¨å†Œç³»ç»Ÿ
```go
type UserRegisterForm struct {
    UserType string `json:"user_type" validate:"required,oneof=ä¸ªäºº ä¼ä¸š æ”¿åºœ"`
    
    // ä¼ä¸šç”¨æˆ·å¿…é¡»å¡«å†™å…¬å¸åç§°
    // required_if=user_type ä¼ä¸š: å½“user_typeå­—æ®µç­‰äº"ä¼ä¸š"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    CompanyName string `json:"company_name" validate:"required_if=user_type ä¼ä¸š"`
    
    // éä¸ªäººç”¨æˆ·å¿…é¡»å¡«å†™è”ç³»äºº
    // required_unless=user_type ä¸ªäºº: å½“user_typeå­—æ®µä¸ç­‰äº"ä¸ªäºº"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    ContactPerson string `json:"contact_person" validate:"required_unless=user_type ä¸ªäºº"`
    
    // ä¸ªäººç”¨æˆ·ä¸èƒ½å¡«å†™å…¬å¸ä¿¡æ¯
    // excluded_if=user_type ä¸ªäºº: å½“user_typeå­—æ®µç­‰äº"ä¸ªäºº"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    CompanyInfo string `json:"company_info" validate:"excluded_if=user_type ä¸ªäºº"`
    
    // åªæœ‰ä¼ä¸šç”¨æˆ·æ‰èƒ½å¡«å†™è¥ä¸šæ‰§ç…§å·
    // excluded_unless=user_type ä¼ä¸š: å½“user_typeå­—æ®µä¸ç­‰äº"ä¼ä¸š"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    LicenseNumber string `json:"license_number" validate:"excluded_unless=user_type ä¼ä¸š"`
}
```

### åœºæ™¯3ï¼šè®¢å•ç³»ç»Ÿ
```go
type OrderForm struct {
    OrderType string `json:"order_type" validate:"required,oneof=åœ¨çº¿ çº¿ä¸‹ è‡ªæ"`
    PaymentMethod string `json:"payment_method" validate:"required,oneof=åœ¨çº¿æ”¯ä»˜ è´§åˆ°ä»˜æ¬¾ è‡ªæä»˜æ¬¾"`
    
    // åœ¨çº¿è®¢å•å¿…é¡»å¡«å†™æ”¶è´§åœ°å€
    // required_if=order_type åœ¨çº¿: å½“order_typeå­—æ®µç­‰äº"åœ¨çº¿"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    Address string `json:"address" validate:"required_if=order_type åœ¨çº¿"`
    
    // çº¿ä¸‹è®¢å•å¿…é¡»é€‰æ‹©é—¨åº—
    // required_if=order_type çº¿ä¸‹: å½“order_typeå­—æ®µç­‰äº"çº¿ä¸‹"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    StoreId int `json:"store_id" validate:"required_if=order_type çº¿ä¸‹"`
    
    // è‡ªæè®¢å•å¿…é¡»å¡«å†™è‡ªæç‚¹
    // required_if=order_type è‡ªæ: å½“order_typeå­—æ®µç­‰äº"è‡ªæ"æ—¶ï¼Œæ­¤å­—æ®µå¿…å¡«
    PickupPoint string `json:"pickup_point" validate:"required_if=order_type è‡ªæ"`
    
    // è´§åˆ°ä»˜æ¬¾æ—¶ä¸èƒ½é€‰æ‹©åœ¨çº¿æ”¯ä»˜
    // excluded_if=payment_method è´§åˆ°ä»˜æ¬¾: å½“payment_methodå­—æ®µç­‰äº"è´§åˆ°ä»˜æ¬¾"æ—¶ï¼Œæ­¤å­—æ®µå¿…é¡»ä¸ºç©º
    OnlinePayment bool `json:"online_payment" validate:"excluded_if=payment_method è´§åˆ°ä»˜æ¬¾"`
}
```

## ğŸš€ æœ€ä½³å®è·µ

1. **åˆç†ä½¿ç”¨**ï¼šä¸è¦è¿‡åº¦ä½¿ç”¨æ¡ä»¶éªŒè¯ï¼Œä¿æŒé€»è¾‘æ¸…æ™°
2. **æµ‹è¯•è¦†ç›–**ï¼šä¸ºå„ç§æ¡ä»¶ç»„åˆç¼–å†™æµ‹è¯•ç”¨ä¾‹
3. **é”™è¯¯æç¤º**ï¼šéªŒè¯å¤±è´¥æ—¶æä¾›æ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
4. **æ–‡æ¡£è¯´æ˜**ï¼šåœ¨ä»£ç ä¸­æ·»åŠ æ³¨é‡Šè¯´æ˜éªŒè¯é€»è¾‘
5. **ç”¨æˆ·å‹å¥½**ï¼šå‰ç«¯æ ¹æ®æ¡ä»¶åŠ¨æ€æ˜¾ç¤º/éšè—å­—æ®µ

## ğŸ“ æ€»ç»“

æ¡ä»¶éªŒè¯æ ‡ç­¾è®©è¡¨å•éªŒè¯å˜å¾—éå¸¸å¼ºå¤§å’Œçµæ´»ï¼š

- **required_if**ï¼šç­‰äºæ—¶å¿…å¡«
- **required_unless**ï¼šä¸ç­‰äºæ—¶å¿…å¡«  
- **excluded_if**ï¼šç­‰äºæ—¶å¿…ä¸å¡«
- **excluded_unless**ï¼šä¸ç­‰äºæ—¶å¿…ä¸å¡«

é€šè¿‡åˆç†ä½¿ç”¨è¿™äº›æ ‡ç­¾ï¼Œå¯ä»¥åˆ›å»ºæ™ºèƒ½çš„è¡¨å•éªŒè¯é€»è¾‘ï¼Œæå‡ç”¨æˆ·ä½“éªŒå’Œæ•°æ®çš„å‡†ç¡®æ€§ã€‚
