# èšåˆè®¡ç®—åŠŸèƒ½ä½¿ç”¨æŒ‡å—

## ğŸ“‹ ç›®å½•

- [æ¦‚è¿°](#æ¦‚è¿°)
- [åŸºç¡€è¯­æ³•](#åŸºç¡€è¯­æ³•)
- [èšåˆå‡½æ•°](#èšåˆå‡½æ•°)
- [ä½¿ç”¨åœºæ™¯](#ä½¿ç”¨åœºæ™¯)
- [å®Œæ•´ç¤ºä¾‹](#å®Œæ•´ç¤ºä¾‹)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## æ¦‚è¿°

èšåˆè®¡ç®—åŠŸèƒ½å…è®¸åœ¨ç”¨æˆ·é€‰æ‹©æ•°æ®æ—¶å®æ—¶æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œé€šè¿‡ `OnInputFuzzyResp.Statistics` å­—æ®µæä¾›åŠ¨æ€è®¡ç®—å’Œé™æ€å±•ç¤ºä¿¡æ¯ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å®æ—¶è®¡ç®—**ï¼šç”¨æˆ·é€‰æ‹©æ—¶å³æ—¶æ˜¾ç¤ºç»Ÿè®¡ç»“æœ
- **å¤šç§èšåˆ**ï¼šæ”¯æŒæ±‚å’Œã€å¹³å‡å€¼ã€æœ€å¤§å€¼ã€æœ€å°å€¼ã€è®¡æ•°ç­‰
- **ä¹˜æ³•è¿ç®—**ï¼šæ”¯æŒå­—æ®µé—´çš„ä¹˜æ³•è®¡ç®—ï¼ˆå¦‚ä»·æ ¼Ã—æ•°é‡ï¼‰
- **é™æ€ä¿¡æ¯**ï¼šæ”¯æŒæ˜¾ç¤ºå›ºå®šçš„ä¸šåŠ¡ä¿¡æ¯
- **äººæ€§åŒ–å±•ç¤º**ï¼šè‡ªåŠ¨æ ¼å¼åŒ–æ•°å­—ï¼Œæ”¯æŒå•ä½å’Œå‰ç¼€

---

## åŸºç¡€è¯­æ³•

### Statistics å­—æ®µç»“æ„

```go
Statistics: map[string]interface{}{
    "æ˜¾ç¤ºåç§°": "èšåˆå…¬å¼æˆ–é™æ€å€¼",
}
```

### èšåˆå…¬å¼è¯­æ³•

```go
// åŸºç¡€èšåˆ
"sum(å­—æ®µå)"          // æ±‚å’Œ
"avg(å­—æ®µå)"          // å¹³å‡å€¼  
"min(å­—æ®µå)"          // æœ€å°å€¼
"max(å­—æ®µå)"          // æœ€å¤§å€¼
"count(å­—æ®µå)"        // è®¡æ•°

// ä¹˜æ³•è¿ç®—
"sum(å­—æ®µå,*æ•°é‡å­—æ®µ)"     // æ±‚å’Œåä¹˜ä»¥æ•°é‡
"sum(å­—æ®µå,*æ•°é‡å­—æ®µ,*0.9)" // æ±‚å’Œåä¹˜ä»¥æ•°é‡å†ä¹˜ä»¥0.9(ä¹æŠ˜)

// é™æ€ä¿¡æ¯
"é…é€è¯´æ˜": "å…¨å›½åŒ…é‚®"      // ç›´æ¥æ˜¾ç¤ºé™æ€æ–‡æœ¬
```

---

## èšåˆå‡½æ•°

### 1. åŸºç¡€èšåˆå‡½æ•°

| å‡½æ•° | è¯­æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|
| **sum** | `sum(å­—æ®µå)` | æ±‚å’Œ | `sum(ä»·æ ¼)` â†’ æ‰€æœ‰ä»·æ ¼çš„æ€»å’Œ |
| **avg** | `avg(å­—æ®µå)` | å¹³å‡å€¼ | `avg(ä»·æ ¼)` â†’ ä»·æ ¼çš„å¹³å‡å€¼ |
| **min** | `min(å­—æ®µå)` | æœ€å°å€¼ | `min(ä»·æ ¼)` â†’ æœ€ä½ä»·æ ¼ |
| **max** | `max(å­—æ®µå)` | æœ€å¤§å€¼ | `max(ä»·æ ¼)` â†’ æœ€é«˜ä»·æ ¼ |
| **count** | `count(å­—æ®µå)` | è®¡æ•° | `count(ä»·æ ¼)` â†’ å•†å“ç§ç±»æ•° |

### 2. ä¹˜æ³•è¿ç®—

#### ä¹˜æ³•å˜é‡æ¥æºè¯´æ˜

**å…³é”®æ¦‚å¿µ**ï¼šä¹˜æ³•è¿ç®—ä¸­çš„å˜é‡ï¼ˆå¦‚`*quantity`ã€`*count`ç­‰ï¼‰æ¥è‡ªäº**å½“å‰è¯·æ±‚ç»“æ„ä½“çš„åŒçº§å­—æ®µ**ï¼Œä¸æ˜¯DisplayInfoä¸­çš„å­—æ®µã€‚

```go
// ç¤ºä¾‹1ï¼šquantityå˜é‡
type ProductSelectReq struct {
    ProductIDs []int `json:"product_ids"`     // é€‰æ‹©çš„å•†å“IDåˆ—è¡¨
    Quantity   int   `json:"quantity"`        // è¿™ä¸ªå­—æ®µåå°±æ˜¯èšåˆå…¬å¼ä¸­çš„å˜é‡å
}
// èšåˆå…¬å¼ï¼šsum(ä»·æ ¼,*quantity)  â† quantityå˜é‡æ¥è‡ªåŒçº§çš„Quantityå­—æ®µ

// ç¤ºä¾‹2ï¼šcountå˜é‡
type OrderReq struct {
    ProductIDs []int `json:"product_ids"`
    Count      int   `json:"count"`           // å­—æ®µåæ˜¯count
}
// èšåˆå…¬å¼ï¼šsum(ä»·æ ¼,*count)     â† countå˜é‡æ¥è‡ªåŒçº§çš„Countå­—æ®µ

// ç¤ºä¾‹3ï¼šListç»„ä»¶ä¸­çš„å˜é‡
type ProductQuantity struct {
    ProductID int `json:"product_id"`
    Quantity  int `json:"quantity"`          // Listé¡¹ä¸­çš„å­—æ®µ
    Weight    int `json:"weight"`            // å¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªå˜é‡
}
// èšåˆå…¬å¼ï¼šsum(ä»·æ ¼,*quantity) æˆ– sum(ä»·æ ¼,*weight)
```

#### ä¹˜æ³•è¿ç®—è¯­æ³•

```go
// åŸºç¡€ä¹˜æ³•ï¼šDisplayInfoå­—æ®µ Ã— åŒçº§ç»“æ„ä½“å­—æ®µ
"sum(ä»·æ ¼,*quantity)"           // ä»·æ ¼æ¥è‡ªDisplayInfoï¼Œquantityæ¥è‡ªåŒçº§å­—æ®µ

// ä½¿ç”¨ä¸åŒçš„å˜é‡å
"sum(ä»·æ ¼,*count)"              // countæ¥è‡ªåŒçº§çš„Countå­—æ®µ
"sum(ä»·æ ¼,*num)"                // numæ¥è‡ªåŒçº§çš„Numå­—æ®µ

// å¤šé‡ä¹˜æ³•ï¼šå­—æ®µå€¼ Ã— å˜é‡ Ã— å¸¸æ•°ç³»æ•°  
"sum(ä»·æ ¼,*quantity,*0.9)"      // ä¹æŠ˜ä»·æ ¼
"sum(é‡é‡,*count,*2.5)"         // è¿è´¹è®¡ç®—

// ä½¿ç”¨å¤šä¸ªä¸åŒå˜é‡
"sum(ä»·æ ¼,*quantity,*discount)" // discountä¹Ÿæ¥è‡ªåŒçº§å­—æ®µ
```

#### å˜é‡çš„ä¸åŒä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šéListç»„ä»¶ - åŒçº§å­—æ®µä½œä¸ºå˜é‡**
```go
// è¯·æ±‚ç»“æ„ä½“
type OrderReq struct {
    ProductIDs []int   `json:"product_ids"`  // å¤šé€‰å•†å“
    Quantity   int     `json:"quantity"`     // å˜é‡quantity
    Discount   float64 `json:"discount"`     // å˜é‡discount
}

// èšåˆè®¡ç®—ï¼šå˜é‡æ¥è‡ªåŒçº§å­—æ®µ
"sum(ä»·æ ¼,*quantity)"           // quantityå˜é‡ â† OrderReq.Quantityå­—æ®µ
"sum(ä»·æ ¼,*quantity,*discount)" // discountå˜é‡ â† OrderReq.Discountå­—æ®µ
```

**åœºæ™¯2ï¼šListç»„ä»¶ - Listé¡¹å­—æ®µä½œä¸ºå˜é‡**
```go
// è¯·æ±‚ç»“æ„ä½“
type ListReq struct {
    Items []ProductItem `json:"items"`
}

type ProductItem struct {
    ProductID int     `json:"product_id"`
    Quantity  int     `json:"quantity"`     // å˜é‡quantity
    Weight    float64 `json:"weight"`       // å˜é‡weight  
}

// èšåˆè®¡ç®—ï¼šå˜é‡æ¥è‡ªListé¡¹çš„å­—æ®µ
"sum(ä»·æ ¼,*quantity)"  // quantityå˜é‡ â† ProductItem.Quantityå­—æ®µ
"sum(ä»·æ ¼,*weight)"    // weightå˜é‡ â† ProductItem.Weightå­—æ®µ
```

### 3. é™æ€ä¿¡æ¯

```go
// ä¸šåŠ¡è§„åˆ™å±•ç¤º
"ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
"é…é€è¯´æ˜": "å…¨å›½åŒ…é‚®",
"æœåŠ¡æ‰¿è¯º": "30å¤©åŒ…æ¢",

// åŠ¨æ€æç¤º
"æ”¯ä»˜æ–¹å¼": "ä½™é¢æ‰£æ¬¾",
"åˆ°è´¦æ—¶é—´": "å®æ—¶åˆ°è´¦",
```

---

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šç”µå•†è´­ç‰©è½¦

```go
Statistics: map[string]interface{}{
    // æ ¸å¿ƒä»·æ ¼ä¿¡æ¯
    "å•†å“åŸä»·": "sum(ä»·æ ¼,*quantity)",
    "ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)", 
    "èŠ‚çœé‡‘é¢": "sum(ä»·æ ¼,*quantity,*0.1)",
    
    // é‡è¦æç¤º
    "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
}
```

**ç”¨æˆ·çœ‹åˆ°çš„æ•ˆæœ**ï¼š
```
å•†å“åŸä»·: Â¥168.50
ä¼šå‘˜ä»·æ ¼: Â¥151.65
èŠ‚çœé‡‘é¢: Â¥16.85
ä¼šå‘˜æŠ˜æ‰£: 9æŠ˜ä¼˜æƒ 
```

### åœºæ™¯2ï¼šä¼šå‘˜å¡ç®¡ç†

```go
Statistics: map[string]interface{}{
    // æ ¸å¿ƒä¿¡æ¯
    "ä¼šå‘˜æ€»æ•°": "count(ä½™é¢)",
    "æ€»ä½™é¢": "sum(ä½™é¢)",
    
    // é‡è¦æç¤º  
    "æ”¯ä»˜æ–¹å¼": "ä½™é¢æ‰£æ¬¾",
    "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
}
```

### åœºæ™¯3ï¼šç‰©æµé…é€

```go
Statistics: map[string]interface{}{
    // é‡é‡è®¡ç®—
    "æ€»é‡é‡(kg)": "sum(é‡é‡,*quantity)",
    "é…é€è´¹(å…ƒ)": "sum(é‡é‡,*quantity,*2.5)",
    
    // é…é€ä¿¡æ¯
    "é…é€èŒƒå›´": "å…¨å›½é…é€", 
    "é…é€æ—¶æ•ˆ": "1-3ä¸ªå·¥ä½œæ—¥",
}
```

---

## ä¹˜æ³•å˜é‡è¯¦è§£

### æ ¸å¿ƒæ¦‚å¿µ

**å…³é”®ç†è§£**ï¼šèšåˆè®¡ç®—ä¸­çš„ä¹˜æ³•å˜é‡ï¼ˆå¦‚`*quantity`ã€`*count`ç­‰ï¼‰æ¥è‡ª**å½“å‰è¯·æ±‚ç»“æ„ä½“çš„åŒçº§å­—æ®µ**ï¼Œä¸æ˜¯å›è°ƒå‡½æ•°ä¸­çš„DisplayInfoã€‚

**å˜é‡å‘½åè§„åˆ™**ï¼š
- å˜é‡åå¿…é¡»ä¸ç»“æ„ä½“å­—æ®µåå®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
- å˜é‡åå‰åŠ `*`ç¬¦å·è¡¨ç¤ºä¹˜æ³•è¿ç®—
- å­—æ®µå`Quantity` â†’ å˜é‡å`*quantity`ï¼ˆJSON tagå†³å®šå˜é‡åï¼‰
- å­—æ®µå`Count` â†’ å˜é‡å`*count`
- å­—æ®µå`Weight` â†’ å˜é‡å`*weight`

### å®Œæ•´çš„å˜é‡ä½¿ç”¨ç¤ºä¾‹

```go
// 1. ç”¨æˆ·è¯·æ±‚ç»“æ„ä½“å®šä¹‰ï¼ˆå˜é‡æ¥æºï¼‰
type ProductSelectReq struct {
    ProductIDs []int   `json:"product_ids" widget:"type:multiselect"`  // å¤šé€‰å•†å“
    Quantity   int     `json:"quantity" widget:"type:number"`          // å˜é‡quantity â† å­—æ®µåå†³å®šå˜é‡å
    Discount   float64 `json:"discount" widget:"type:number"`          // å˜é‡discount â† å­—æ®µåå†³å®šå˜é‡å
}

// 2. å›è°ƒå‡½æ•°ä¸­çš„DisplayInfoï¼ˆèšåˆç›®æ ‡å­—æ®µï¼‰
"product_ids": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
    items := []*usercall.InputFuzzyItem{
        {
            Value: 1,
            Label: "è‹¹æœ - Â¥8.5",
            DisplayInfo: map[string]interface{}{
                "å•†å“åç§°": "è‹¹æœ",
                "ä»·æ ¼":   8.5,        // â† èšåˆç›®æ ‡å­—æ®µ
                "é‡é‡":   0.2,        // â† èšåˆç›®æ ‡å­—æ®µ
                // æ³¨æ„ï¼šå˜é‡ä¸åœ¨DisplayInfoä¸­ï¼
            },
        },
    }
    
    return &usercall.OnInputFuzzyResp{
        Statistics: map[string]interface{}{
            // 3. èšåˆè®¡ç®—ï¼šDisplayInfoå­—æ®µ Ã— åŒçº§ç»“æ„ä½“å­—æ®µ
            "æ€»ä»·": "sum(ä»·æ ¼,*quantity)",              // quantityå˜é‡ â† ProductSelectReq.Quantityå­—æ®µ
            "æ€»é‡é‡": "sum(é‡é‡,*quantity)",            // quantityå˜é‡ â† ProductSelectReq.Quantityå­—æ®µ
            "æŠ˜æ‰£ä»·": "sum(ä»·æ ¼,*quantity,*discount)",  // discountå˜é‡ â† ProductSelectReq.Discountå­—æ®µ
        },
        Values: items,
    }, nil
}

// 4. ç”¨æˆ·æ“ä½œç¤ºä¾‹
// ç”¨æˆ·é€‰æ‹©ï¼šè‹¹æœ(Â¥8.5)ã€é¦™è•‰(Â¥6.8)
// ç”¨æˆ·è¾“å…¥ï¼šæ•°é‡=3, æŠ˜æ‰£=0.9
// 
// èšåˆè®¡ç®—ç»“æœï¼š
// æ€»ä»· = sum(8.5, 6.8) * 3 = 15.3 * 3 = 45.9
// æŠ˜æ‰£ä»· = sum(8.5, 6.8) * 3 * 0.9 = 45.9 * 0.9 = 41.31
```

### Listç»„ä»¶ä¸­çš„å˜é‡ä½¿ç”¨

```go
// 1. Listç»„ä»¶çš„è¯·æ±‚ç»“æ„ä½“ï¼ˆå˜é‡æ¥æºï¼‰
type ListProductReq struct {
    Items []ProductQuantity `json:"items" widget:"type:list"`
}

type ProductQuantity struct {
    ProductID int     `json:"product_id" widget:"type:select"`     // å•†å“é€‰æ‹©
    Quantity  int     `json:"quantity" widget:"type:number"`       // å˜é‡quantity â† å­—æ®µåå†³å®šå˜é‡å
    Weight    float64 `json:"weight" widget:"type:number"`         // å˜é‡weight â† å­—æ®µåå†³å®šå˜é‡å
}

// 2. å›è°ƒå‡½æ•°
"product_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
    // ... DisplayInfoè®¾ç½® ...
    
    return &usercall.OnInputFuzzyResp{
        Statistics: map[string]interface{}{
            // 3. Listèšåˆï¼šæ¯ä¸ªitemä½¿ç”¨å„è‡ªçš„åŒçº§å­—æ®µä½œä¸ºå˜é‡
            "æ€»ä»·": "sum(ä»·æ ¼,*quantity)",      // quantityå˜é‡ â† ProductQuantity.Quantityå­—æ®µ
            "æ€»è¿è´¹": "sum(è¿è´¹,*weight)",      // weightå˜é‡ â† ProductQuantity.Weightå­—æ®µ
            "æ€»é‡é‡": "sum(å•é‡,*quantity)",    // quantityå˜é‡ â† ProductQuantity.Quantityå­—æ®µ
        },
        Values: items,
    }, nil
}

// 4. ç”¨æˆ·æ“ä½œç¤ºä¾‹
// ç”¨æˆ·æ·»åŠ ï¼š
// Item1: è‹¹æœ(Â¥8.5) Ã— 2ä¸ª, é‡é‡1.5kg
// Item2: é¦™è•‰(Â¥6.8) Ã— 3ä¸ª, é‡é‡2.0kg
//
// èšåˆè®¡ç®—ç»“æœï¼š
// æ€»ä»· = (8.5 * 2) + (6.8 * 3) = 17 + 20.4 = 37.4
// æ€»è¿è´¹ = (è¿è´¹å•ä»· * 1.5) + (è¿è´¹å•ä»· * 2.0)
```

---

## å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹1ï¼šå•†å“é€‰æ‹©èšåˆè®¡ç®—

```go
"product_ids": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
    // æŸ¥è¯¢å•†å“æ•°æ®
    var products []Product
    db.Where("status = ?", "ä¸Šæ¶").Where("stock > ?", 0).Find(&products)
    
    // æ„å»ºé€‰é¡¹
    items := make([]*usercall.InputFuzzyItem, 0)
    for _, p := range products {
        items = append(items, &usercall.InputFuzzyItem{
            Value: p.ID,
            Label: fmt.Sprintf("%s - Â¥%.2f", p.Name, p.Price),
            DisplayInfo: map[string]interface{}{
                "å•†å“åç§°": p.Name,
                "ä»·æ ¼":   p.Price,
                "é‡é‡":   p.Weight,
                "åº“å­˜":   p.Stock,
            },
        })
    }
    
    return &usercall.OnInputFuzzyResp{
        Statistics: map[string]interface{}{
            // æ ¸å¿ƒä»·æ ¼ä¿¡æ¯ - ç”¨æˆ·æœ€å…³å¿ƒ
            "å•†å“åŸä»·": "sum(ä»·æ ¼,*quantity)",
            "ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)", 
            "èŠ‚çœé‡‘é¢": "sum(ä»·æ ¼,*quantity,*0.1)",
            
            // é‡é‡ä¿¡æ¯ - å½±å“é…é€
            "æ€»é‡é‡": "sum(é‡é‡,*quantity)",
            
            // é‡è¦æç¤º - ä¸šåŠ¡è§„åˆ™
            "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
            "é…é€è¯´æ˜": "æ»¡99å…ƒåŒ…é‚®",
        },
        Values: items,
    }, nil
}
```

### ç¤ºä¾‹2ï¼šä¼šå‘˜å¡é€‰æ‹©èšåˆè®¡ç®—

```go
"member_id": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) {
    // æŸ¥è¯¢ä¼šå‘˜æ•°æ®
    var members []MemberCard
    db.Where("status = ?", "æ­£å¸¸").Find(&members)
    
    // æ„å»ºé€‰é¡¹
    items := make([]*usercall.InputFuzzyItem, 0)
    for _, m := range members {
        items = append(items, &usercall.InputFuzzyItem{
            Value: m.ID,
            Label: fmt.Sprintf("%s - ä½™é¢:Â¥%.2f", m.CustomerName, m.Balance),
            DisplayInfo: map[string]interface{}{
                "å®¢æˆ·å§“å": m.CustomerName,
                "ä½™é¢":   m.Balance,
                "å¡å·":   m.CardNumber,
            },
        })
    }
    
    return &usercall.OnInputFuzzyResp{
        Statistics: map[string]interface{}{
            // æ ¸å¿ƒä¿¡æ¯
            "ä¼šå‘˜æ€»æ•°": "count(ä½™é¢)",
            "æ€»ä½™é¢": "sum(ä½™é¢)",
            
            // é‡è¦æç¤º
            "æ”¯ä»˜æ–¹å¼": "ä½™é¢æ‰£æ¬¾", 
            "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
        },
        Values: items,
    }, nil
}
```

---

## æœ€ä½³å®è·µ

### 1. ä¿¡æ¯ç²¾ç®€åŸåˆ™

âŒ **é”™è¯¯ç¤ºä¾‹**ï¼šä¿¡æ¯è¿‡å¤šï¼Œç”¨æˆ·å›°æƒ‘
```go
Statistics: map[string]interface{}{
    "ä¼šå‘˜æ€»æ•°": "count(ä½™é¢)",
    "æ€»ä½™é¢(å…ƒ)": "sum(ä½™é¢)", 
    "å¹³å‡ä½™é¢(å…ƒ)": "avg(ä½™é¢)",
    "æœ€é«˜ä½™é¢(å…ƒ)": "max(ä½™é¢)",
    "æœ€ä½ä½™é¢(å…ƒ)": "min(ä½™é¢)",
    "ä¼šå‘˜æƒç›Š": "ä¸“äº«9æŠ˜ä¼˜æƒ ",
    "æ”¯ä»˜æ–¹å¼": "ä½™é¢æ‰£æ¬¾",
    "æŸ¥è¯¢æ–¹å¼": "æ”¯æŒå¡å·/æ‰‹æœºå·/å§“åæœç´¢", 
    "ä¼šå‘˜çŠ¶æ€": "ä»…æ˜¾ç¤ºæ­£å¸¸çŠ¶æ€ä¼šå‘˜",
    "æœåŠ¡çƒ­çº¿": "400-888-8888",
    "è¥ä¸šæ—¶é—´": "9:00-22:00",
    "ç§¯åˆ†æ”¿ç­–": "æ¶ˆè´¹1å…ƒå¾—1ç§¯åˆ†",
    "å……å€¼ä¼˜æƒ ": "å……å€¼æ»¡100é€10",
}
```

âœ… **æ­£ç¡®ç¤ºä¾‹**ï¼šä¿¡æ¯ç²¾ç®€ï¼Œé‡ç‚¹çªå‡º
```go
Statistics: map[string]interface{}{
    // æ ¸å¿ƒä¿¡æ¯
    "ä¼šå‘˜æ€»æ•°": "count(ä½™é¢)",
    "æ€»ä½™é¢": "sum(ä½™é¢)",
    
    // é‡è¦æç¤º
    "æ”¯ä»˜æ–¹å¼": "ä½™é¢æ‰£æ¬¾",
    "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ", 
}
```

### 2. å±‚æ¬¡åˆ†æ˜åŸåˆ™

```go
Statistics: map[string]interface{}{
    // ç¬¬ä¸€å±‚ï¼šæ ¸å¿ƒæ•°æ® - ç”¨æˆ·æœ€å…³å¿ƒçš„
    "å•†å“åŸä»·": "sum(ä»·æ ¼,*quantity)",
    "ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)",
    "èŠ‚çœé‡‘é¢": "sum(ä»·æ ¼,*quantity,*0.1)",
    
    // ç¬¬äºŒå±‚ï¼šé‡è¦æç¤º - å…³é”®ä¸šåŠ¡è§„åˆ™
    "ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
}
```

### 3. å­—æ®µåç§°è§„èŒƒ

```go
// âœ… å¥½çš„å‘½åï¼šç®€æ´æ˜äº†
"å•†å“åŸä»·": "sum(ä»·æ ¼,*quantity)",
"ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)", 
"èŠ‚çœé‡‘é¢": "sum(ä»·æ ¼,*quantity,*0.1)",

// âŒ ä¸å¥½çš„å‘½åï¼šè¿‡äºè¯¦ç»†
"å•†å“åŸä»·(å…ƒ)": "sum(ä»·æ ¼,*quantity)",
"ä¼šå‘˜ä»·æ ¼(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.9)",
"ä¼˜æƒ é‡‘é¢(å…ƒ)": "sum(ä»·æ ¼,*quantity,*0.1)",
```

### 4. ä¸šåŠ¡åœºæ™¯é€‚é…

ä¸åŒåœºæ™¯å…³æ³¨ç‚¹ä¸åŒï¼Œèšåˆä¿¡æ¯åº”è¯¥åŒ¹é…ï¼š

**æ”¶é“¶åœºæ™¯**ï¼šå…³æ³¨ä»·æ ¼å’Œä¼˜æƒ 
```go
"å•†å“åŸä»·": "sum(ä»·æ ¼,*quantity)",
"ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)",
"èŠ‚çœé‡‘é¢": "sum(ä»·æ ¼,*quantity,*0.1)",
```

**å……å€¼åœºæ™¯**ï¼šå…³æ³¨ä½™é¢å’Œä¼˜æƒ æ”¿ç­–
```go
"ä¼šå‘˜æ€»æ•°": "count(ä½™é¢)", 
"æ€»ä½™é¢": "sum(ä½™é¢)",
"å……å€¼ä¼˜æƒ ": "æ»¡100é€10",
```

**åº“å­˜åœºæ™¯**ï¼šå…³æ³¨æ•°é‡å’Œåº“å­˜
```go
"å•†å“ç§ç±»": "count(åº“å­˜)",
"æ€»åº“å­˜": "sum(åº“å­˜)",
"åº“å­˜é¢„è­¦": "ä½äº10ä»¶éœ€è¡¥è´§",
```

---

## å¸¸è§é—®é¢˜

### Q1: èšåˆè®¡ç®—ä¸ç”Ÿæ•ˆï¼Ÿ

**åŸå› **ï¼šDisplayInfoä¸­çš„å­—æ®µåä¸èšåˆå…¬å¼ä¸åŒ¹é…

```go
// âŒ é”™è¯¯ï¼šå­—æ®µåä¸åŒ¹é…
DisplayInfo: map[string]interface{}{
    "price": p.Price,  // å­—æ®µåæ˜¯ price
}
Statistics: map[string]interface{}{
    "æ€»ä»·": "sum(ä»·æ ¼)",  // ä½†èšåˆç”¨çš„æ˜¯ ä»·æ ¼
}

// âœ… æ­£ç¡®ï¼šå­—æ®µååŒ¹é…
DisplayInfo: map[string]interface{}{
    "ä»·æ ¼": p.Price,
}
Statistics: map[string]interface{}{
    "æ€»ä»·": "sum(ä»·æ ¼)",
}
```

### Q2: ä¹˜æ³•è¿ç®—ç»“æœä¸å¯¹ï¼Ÿ

**åŸå› **ï¼šå˜é‡æ¥æºä¸æ­£ç¡®æˆ–å˜é‡åä¸å­—æ®µåä¸åŒ¹é…

**é‡è¦**ï¼šä¹˜æ³•å˜é‡æ¥è‡ª**å½“å‰è¯·æ±‚ç»“æ„ä½“çš„åŒçº§å­—æ®µ**ï¼Œä¸æ˜¯DisplayInfoï¼å˜é‡åå¿…é¡»ä¸å­—æ®µåå®Œå…¨ä¸€è‡´ã€‚

```go
// âŒ é”™è¯¯ç†è§£ï¼šä»¥ä¸ºå˜é‡åœ¨DisplayInfoä¸­
DisplayInfo: map[string]interface{}{
    "ä»·æ ¼": p.Price,
    "quantity": 1,  // é”™è¯¯ï¼å˜é‡ä¸åœ¨DisplayInfoä¸­
}

// âœ… æ­£ç¡®ç†è§£ï¼šå˜é‡æ¥è‡ªè¯·æ±‚ç»“æ„ä½“å­—æ®µ
type ProductSelectReq struct {
    ProductIDs []int `json:"product_ids"`
    Quantity   int   `json:"quantity"`     // å˜é‡quantity â† å­—æ®µåå†³å®šå˜é‡å
    Count      int   `json:"count"`        // å˜é‡count â† å­—æ®µåå†³å®šå˜é‡å
}

// æˆ–è€…Listç»„ä»¶ä¸­çš„å˜é‡
type ProductQuantity struct {
    ProductID int `json:"product_id"`
    Quantity  int `json:"quantity"`       // å˜é‡quantity â† å­—æ®µåå†³å®šå˜é‡å
    Weight    int `json:"weight"`         // å˜é‡weight â† å­—æ®µåå†³å®šå˜é‡å
}

// èšåˆå…¬å¼ï¼šå˜é‡åå¿…é¡»ä¸å­—æ®µåä¸€è‡´
"æ€»ä»·": "sum(ä»·æ ¼,*quantity)",  // quantityå˜é‡ â† å¯¹åº”Quantityå­—æ®µ
"æ€»æ•°": "sum(ä»·æ ¼,*count)",     // countå˜é‡ â† å¯¹åº”Countå­—æ®µ
"æ€»é‡": "sum(ä»·æ ¼,*weight)",    // weightå˜é‡ â† å¯¹åº”Weightå­—æ®µ
```

**è°ƒè¯•æ­¥éª¤**ï¼š
1. æ£€æŸ¥è¯·æ±‚ç»“æ„ä½“ä¸­æ˜¯å¦æœ‰å¯¹åº”çš„å­—æ®µï¼ˆå¦‚quantityå¯¹åº”Quantityå­—æ®µï¼‰
2. ç¡®è®¤å˜é‡åä¸å­—æ®µåå®Œå…¨ä¸€è‡´ï¼ˆåŒºåˆ†å¤§å°å†™ï¼‰
3. Listç»„ä»¶ç¡®ä¿æ¯ä¸ªiteméƒ½æœ‰å¯¹åº”å­—æ®µ
4. ç¡®è®¤å­—æ®µç±»å‹ä¸ºintæˆ–float64
5. å˜é‡åå‰å¿…é¡»åŠ `*`ç¬¦å·

### Q3: é™æ€ä¿¡æ¯ä¸æ˜¾ç¤ºï¼Ÿ

**åŸå› **ï¼šé™æ€ä¿¡æ¯ç›´æ¥ä½¿ç”¨å­—ç¬¦ä¸²å€¼ï¼Œä¸éœ€è¦èšåˆå‡½æ•°

```go
// âœ… æ­£ç¡®ï¼šé™æ€ä¿¡æ¯
"ä¼šå‘˜æŠ˜æ‰£": "9æŠ˜ä¼˜æƒ ",
"é…é€è¯´æ˜": "å…¨å›½åŒ…é‚®",

// âŒ é”™è¯¯ï¼šå¯¹é™æ€ä¿¡æ¯ä½¿ç”¨èšåˆå‡½æ•°  
"ä¼šå‘˜æŠ˜æ‰£": "sum(9æŠ˜ä¼˜æƒ )",  // é”™è¯¯ï¼
```

### Q4: å¦‚ä½•è°ƒè¯•èšåˆè®¡ç®—ï¼Ÿ

1. **æ£€æŸ¥å­—æ®µå**ï¼šç¡®ä¿DisplayInfoä¸­çš„å­—æ®µåä¸èšåˆå…¬å¼ä¸­çš„ä¸€è‡´
2. **æ£€æŸ¥æ•°æ®ç±»å‹**ï¼šæ•°å€¼å­—æ®µç¡®ä¿æ˜¯numberç±»å‹
3. **æ£€æŸ¥è¯­æ³•**ï¼šèšåˆå…¬å¼è¯­æ³•æ˜¯å¦æ­£ç¡®
4. **é€æ­¥æµ‹è¯•**ï¼šå…ˆæµ‹è¯•ç®€å•çš„countï¼Œå†æµ‹è¯•å¤æ‚çš„sum

```go
// è°ƒè¯•æ­¥éª¤ç¤ºä¾‹
Statistics: map[string]interface{}{
    // ç¬¬1æ­¥ï¼šæµ‹è¯•åŸºç¡€è®¡æ•°
    "æ•°æ®æ€»æ•°": "count(ä»·æ ¼)",
    
    // ç¬¬2æ­¥ï¼šæµ‹è¯•ç®€å•æ±‚å’Œ  
    "ä»·æ ¼æ€»å’Œ": "sum(ä»·æ ¼)",
    
    // ç¬¬3æ­¥ï¼šæµ‹è¯•ä¹˜æ³•è¿ç®—
    "æ€»ä»·æ ¼": "sum(ä»·æ ¼,*quantity)",
    
    // ç¬¬4æ­¥ï¼šæµ‹è¯•å¤æ‚è®¡ç®—
    "ä¼šå‘˜ä»·æ ¼": "sum(ä»·æ ¼,*quantity,*0.9)",
}
```

---

## ç‰ˆæœ¬æ›´æ–°è®°å½•

- **v1.0** (2024-01): åˆå§‹ç‰ˆæœ¬ï¼Œæ”¯æŒåŸºç¡€èšåˆå‡½æ•°
- **v1.1** (2024-02): æ–°å¢ä¹˜æ³•è¿ç®—æ”¯æŒ  
- **v1.2** (2024-03): æ–°å¢é™æ€ä¿¡æ¯å±•ç¤º
- **v1.3** (2024-04): ä¼˜åŒ–ç”¨æˆ·ä½“éªŒï¼Œç²¾ç®€ä¿¡æ¯å±•ç¤º

---

## ç›¸å…³æ–‡æ¡£

- [Formå‡½æ•°å¼€å‘æŒ‡å—](./form-functions.md)
- [OnInputFuzzyå›è°ƒæœºåˆ¶](./callback-mechanism.md)  
- [Widgetæ ‡ç­¾ä½¿ç”¨æ‰‹å†Œ](./widget-tags.md)
- [èšåˆè®¡ç®—æ¼”ç¤ºç¤ºä¾‹](../soft/beiluo/demo4/code/api/formexample/aggregation_demo.go)

---

*æœ€åæ›´æ–°ï¼š2024å¹´12æœˆ*
