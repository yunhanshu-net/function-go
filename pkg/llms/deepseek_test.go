package llms

import (
	"context"
	"testing"
	"time"
)

// TestDeepSeekClientCreation æµ‹è¯•DeepSeekå®¢æˆ·ç«¯åˆ›å»º
func TestDeepSeekClientCreation(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	if client == nil {
		t.Fatal("å®¢æˆ·ç«¯åˆ›å»ºå¤±è´¥")
	}

	// éªŒè¯API Keyä¸ä¸ºç©ºå³å¯ï¼Œä¸æ£€æŸ¥å…·ä½“å€¼
	deepSeekClient, ok := client.(*DeepSeekClient)
	if !ok {
		t.Fatal("å®¢æˆ·ç«¯ç±»å‹é”™è¯¯")
	}
	if deepSeekClient.APIKey == "" {
		t.Error("API Keyä¸ºç©º")
	}

	if deepSeekClient.BaseURL != "https://api.deepseek.com/v1/chat/completions" {
		t.Errorf("BaseURLè®¾ç½®é”™è¯¯ï¼ŒæœŸæœ›: %s, å®é™…: %s",
			"https://api.deepseek.com/v1/chat/completions", deepSeekClient.BaseURL)
	}

}

// TestDeepSeekClientInterface æµ‹è¯•å®¢æˆ·ç«¯æ¥å£å®ç°
func TestDeepSeekClientInterface(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	// æ£€æŸ¥æ˜¯å¦å®ç°äº†LLMClientæ¥å£
	var _ LLMClient = client

	// æµ‹è¯•æ¨¡å‹åç§°
	modelName := client.GetModelName()
	if modelName != "deepseek-chat" {
		t.Errorf("æ¨¡å‹åç§°é”™è¯¯ï¼ŒæœŸæœ›: deepseek-chat, å®é™…: %s", modelName)
	}

	// æµ‹è¯•æä¾›å•†åç§°
	provider := client.GetProvider()
	if provider != "DeepSeek" {
		t.Errorf("æä¾›å•†åç§°é”™è¯¯ï¼ŒæœŸæœ›: DeepSeek, å®é™…: %s", provider)
	}
}

// TestDeepSeekChatBasic æµ‹è¯•åŸºæœ¬çš„èŠå¤©åŠŸèƒ½
func TestDeepSeekChatBasic(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	req := &ChatRequest{
		Messages: []Message{
			{Role: "user", Content: "ä½ å¥½ï¼Œè¯·ç®€å•ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±"},
		},
		MaxTokens:   100,
		Temperature: 0.7,
	}

	ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
	defer cancel()

	resp, err := client.Chat(ctx, req)
	if err != nil {
		t.Fatalf("èŠå¤©è¯·æ±‚å¤±è´¥: %v", err)
	}

	if resp == nil {
		t.Fatal("å“åº”ä¸ºç©º")
	}

	// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
	if resp.Error != "" {
		t.Logf("APIè¿”å›é”™è¯¯: %s", resp.Error)
		// å¦‚æœæ˜¯API keyç›¸å…³é”™è¯¯ï¼Œè®°å½•ä½†ä¸å¤±è´¥
		if resp.Error != "" {
			t.Logf("æ³¨æ„ï¼šè¿™å¯èƒ½æ˜¯API keyæ— æ•ˆæˆ–ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®")
		}
		return
	}

	// æ£€æŸ¥å“åº”å†…å®¹
	if resp.Content == "" {
		t.Error("å“åº”å†…å®¹ä¸ºç©º")
	} else {
		t.Logf("AIå›ç­”: %s", resp.Content)
	}

	// æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
	if resp.Usage != nil {
		t.Logf("Tokenä½¿ç”¨: è¾“å…¥%d, è¾“å‡º%d, æ€»è®¡%d",
			resp.Usage.PromptTokens, resp.Usage.CompletionTokens, resp.Usage.TotalTokens)
	}
}

// TestDeepSeekChatWithSystemPrompt æµ‹è¯•å¸¦ç³»ç»Ÿæç¤ºçš„èŠå¤©
func TestDeepSeekChatWithSystemPrompt(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	req := &ChatRequest{
		Messages: []Message{
			{
				Role:    "system",
				Content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Goè¯­è¨€å¼€å‘åŠ©æ‰‹ï¼Œè¯·ç”¨ç®€æ´çš„è¯­è¨€å›ç­”é—®é¢˜",
			},
			{
				Role:    "user",
				Content: "Goè¯­è¨€ä¸­å¦‚ä½•åˆ›å»ºä¸€ä¸ªHTTPæœåŠ¡å™¨ï¼Ÿ",
			},
		},
		MaxTokens:   200,
		Temperature: 0.3,
	}

	ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)
	defer cancel()

	resp, err := client.Chat(ctx, req)
	if err != nil {
		t.Fatalf("å¸¦ç³»ç»Ÿæç¤ºçš„èŠå¤©è¯·æ±‚å¤±è´¥: %v", err)
	}

	if resp == nil {
		t.Fatal("å“åº”ä¸ºç©º")
	}

	// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
	if resp.Error != "" {
		t.Logf("APIè¿”å›é”™è¯¯: %s", resp.Error)
		t.Logf("æ³¨æ„ï¼šè¿™å¯èƒ½æ˜¯API keyæ— æ•ˆæˆ–ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®")
		return
	}

	// æ£€æŸ¥å“åº”å†…å®¹
	if resp.Content == "" {
		t.Error("å“åº”å†…å®¹ä¸ºç©º")
	} else {
		t.Logf("AIå›ç­”: %s", resp.Content)
	}

	// æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
	if resp.Usage != nil {
		t.Logf("Tokenä½¿ç”¨: è¾“å…¥%d, è¾“å‡º%d, æ€»è®¡%d",
			resp.Usage.PromptTokens, resp.Usage.CompletionTokens, resp.Usage.TotalTokens)
	}
}

// TestDeepSeekCodeGeneration æµ‹è¯•ä»£ç ç”ŸæˆåŠŸèƒ½
func TestDeepSeekCodeGeneration(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	timeout := time.Second * 700
	req := &ChatRequest{
		Messages: []Message{
			{
				Role:    "system",
				Content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Goè¯­è¨€å¼€å‘åŠ©æ‰‹ï¼Œè¯·ç”Ÿæˆå¯è¿è¡Œçš„ä»£ç ",
			},
			{
				Role:    "user",
				Content: "# function-go - AIåŸç”Ÿå…¨æ ˆå¼€å‘æ¡†æ¶ > **ä¸“ä¸ºå¤§æ¨¡å‹è®¾è®¡çš„Goå…¨æ ˆå¼€å‘æ¡†æ¶** > AIåŸç”Ÿç»“æ„ä½“æ ‡ç­¾ç³»ç»Ÿ | ä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªå®Œæ•´Webåº”ç”¨ | å¤§æ¨¡å‹ç”Ÿæˆä»£ç ç›´æ¥ç¼–è¯‘éƒ¨ç½² | æ¡†æ¶å†…éƒ¨æœ‰è¿è¡Œå…¥å£ï¼Œä¸“æ³¨ä¸šåŠ¡å‡½æ•° ## ğŸ·ï¸ æ ‡ç­¾ç³»ç»Ÿ - å¤§æ¨¡å‹ä»£ç ç”Ÿæˆæ ¸å¿ƒ ### è®¾è®¡ç†å¿µ function-goé€šè¿‡ç»“æ„ä½“æ ‡ç­¾å®ç°**å£°æ˜å¼é…ç½®**ï¼Œè®©å¤§æ¨¡å‹èƒ½å¤Ÿï¼š - **é›¶æ ·æ¿ä»£ç **ï¼šä¸€ä¸ªç»“æ„ä½“ = å®Œæ•´Webåº”ç”¨ - **AIå‹å¥½**ï¼šæ ‡ç­¾å³é…ç½®ï¼Œå¤§æ¨¡å‹ç›´æ¥ç†è§£ - **ä¸šåŠ¡å¯¼å‘**ï¼šä¸“æ³¨ä¸šåŠ¡é€»è¾‘ï¼Œæ¡†æ¶å¤„ç†æŠ€æœ¯ç»†èŠ‚ ### ğŸ’¡ å¤§æ¨¡å‹ä½¿ç”¨æŒ‡å— **è®°ä½ï¼šæ ‡ç­¾å°±æ˜¯é…ç½®ï¼Œé…ç½®å°±æ˜¯åŠŸèƒ½ï¼** | æ ‡ç­¾ | ä½œç”¨ | å¤§æ¨¡å‹ä½¿ç”¨åœºæ™¯ | |------|------|----------------| | `runner:\"name:å­—æ®µå\"` | å‰ç«¯æ˜¾ç¤ºåç§° | æ‰€æœ‰å­—æ®µéƒ½éœ€è¦ | | `widget:\"type:ç»„ä»¶ç±»å‹\"` | UIç»„ä»¶é€‰æ‹© | æ ¹æ®æ•°æ®ç±»å‹é€‰æ‹© | | `validate:\"required\"` | æ•°æ®éªŒè¯ | å¿…å¡«å­—æ®µå¿…é¡»åŠ  | | `search:\"like\"` | æœç´¢åŠŸèƒ½ | éœ€è¦æœç´¢çš„å­—æ®µ | ### å¿«é€Ÿä¸Šæ‰‹æ¨¡æ¿ ```go // å¤§æ¨¡å‹ä»£ç ç”Ÿæˆæ¨¡æ¿ type YourModel struct { ID int `json:\"id\" gorm:\"primaryKey\" runner:\"name:ID\" permission:\"read\"` //è¿™ä¸ªå­—æ®µåªè¯» Name string `json:\"name\" runner:\"name:åç§°\" widget:\"type:input\" search:\"like\" validate:\"required\"` Status string `json:\"status\" runner:\"name:çŠ¶æ€\" widget:\"type:select;options:å¯ç”¨,ç¦ç”¨\" search:\"in\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" permission:\"read\"` } ``` #### 2. **UIæ¸²æŸ“** - **widgetæ ‡ç­¾**ï¼šé€‰æ‹©æœ€åˆé€‚çš„UIç»„ä»¶è¿›è¡Œæ¸²æŸ“ - **dataæ ‡ç­¾**ï¼šè‡ªåŠ¨è®¾ç½®é»˜è®¤å€¼ã€ç¤ºä¾‹å€¼ã€åŠ¨æ€å€¼ï¼Œæ ¼å¼åŒ–çš„å€¼ï¼Œ - **runneræ ‡ç­¾**ï¼šè‡ªåŠ¨ç”Ÿæˆä¸­æ–‡æ ‡ç­¾ã€å•ä½ã€æ˜¾ç¤ºåç§° #### 3. **æ•°æ®éªŒè¯å¼•æ“** - **validateæ ‡ç­¾**ï¼šè‡ªåŠ¨ç”Ÿæˆå‰ç«¯å’Œåç«¯éªŒè¯è§„åˆ™ - **searchæ ‡ç­¾**ï¼šè‡ªåŠ¨ç”Ÿæˆæœç´¢å’Œè¿‡æ»¤åŠŸèƒ½ - **permissionæ ‡ç­¾**ï¼šè‡ªåŠ¨æ§åˆ¶å­—æ®µåœ¨ä¸åŒåœºæ™¯çš„æ˜¾ç¤ºæƒé™ #### 4. **æ•°æ®åº“æ“ä½œè‡ªåŠ¨åŒ–** - **gormæ ‡ç­¾**ï¼šè‡ªåŠ¨ç”Ÿæˆæ•°æ®åº“è¡¨ç»“æ„ - **CreateTables**ï¼šæœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨å»ºè¡¨ - **AutoCrudTable**ï¼šè‡ªåŠ¨ç”Ÿæˆå¢åˆ æ”¹æŸ¥æ“ä½œ #### 5. **å›è°ƒå‡½æ•°é›†æˆ** - **OnInputFuzzy**ï¼šè‡ªåŠ¨é›†æˆæ¨¡ç³Šæœç´¢å’Œèšåˆè®¡ç®— - **OnInputValidate**ï¼šè‡ªåŠ¨é›†æˆå®æ—¶å­—æ®µéªŒè¯ - **OnTableAddRows**ï¼štableå‡½æ•°æ–°å¢è®°å½•å›è°ƒ - **OnTableUpdateRows** tableå‡½æ•°æ›´æ–°è®°å½•å›è°ƒ - **OnTableDeleteRows** tableå‡½æ•°åˆ é™¤è®°å½•å›è°ƒ ### ğŸ”„ æ ‡ç­¾ç³»ç»Ÿçš„å·¥ä½œæµç¨‹ ``` ç»“æ„ä½“å®šä¹‰ â†’ æ ‡ç­¾è§£æ â†’ ä»£ç ç”Ÿæˆ â†’ è¿è¡Œæ—¶æ‰§è¡Œ â†“ â†“ â†“ â†“ ä¸šåŠ¡æ¨¡å‹ é…ç½®ä¿¡æ¯ å‰ç«¯ç•Œé¢ å®Œæ•´åº”ç”¨ æ•°æ®åº“è¡¨ éªŒè¯è§„åˆ™ APIæ¥å£ ä¸šåŠ¡é€»è¾‘ ``` ### ğŸŒŸ æ ‡ç­¾ç³»ç»Ÿçš„ä¼˜åŠ¿ | ä¼ ç»Ÿå¼€å‘æ–¹å¼ | function-goæ ‡ç­¾æ–¹å¼ | |------------|-----------------| | æ‰‹åŠ¨ç¼–å†™CRUDä»£ç  | è‡ªåŠ¨ç”ŸæˆCRUDä»£ç  | | æ‰‹åŠ¨ç¼–å†™éªŒè¯é€»è¾‘ | æ ‡ç­¾å£°æ˜éªŒè¯è§„åˆ™ | | æ‰‹åŠ¨è®¾è®¡UIç•Œé¢ | è‡ªåŠ¨æ¸²æŸ“UIç•Œé¢ | | æ‰‹åŠ¨ç®¡ç†æ•°æ®åº“ | è‡ªåŠ¨ç®¡ç†æ•°æ®åº“ | | ä»£ç é‡å¤§ã€æ˜“å‡ºé”™ | ä»£ç ç®€æ´ã€é›¶é”™è¯¯ | é€šè¿‡æ ‡ç­¾ç³»ç»Ÿï¼Œå¼€å‘è€…åªéœ€è¦å…³æ³¨**ä¸šåŠ¡é€»è¾‘**ï¼Œæ¡†æ¶è‡ªåŠ¨å¤„ç†æ‰€æœ‰**æŠ€æœ¯ç»†èŠ‚**ï¼ŒçœŸæ­£å®ç°äº†\"ä¸€ä¸ªæ–‡ä»¶ = ä¸€ä¸ªå®Œæ•´Webåº”ç”¨\"çš„æ„¿æ™¯ã€‚ ### æ ‡ç­¾é¡ºåºå»ºè®® ``` json â†’ gorm â†’ runner â†’ widget â†’ data â†’ search â†’ permission â†’ validate ``` ### æ ¸å¿ƒæ ‡ç­¾è¯´æ˜ #### runneræ ‡ç­¾ - ä¸šåŠ¡é€»è¾‘é…ç½® | å±æ€§ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |------|-------------|---------------------------------|----------------| | å­—æ®µåç§° | `name:æ˜¾ç¤ºåç§°` | `runner:\"name:ç”¨æˆ·å\"` | è®¾ç½®å­—æ®µåœ¨å‰ç«¯çš„æ˜¾ç¤ºåç§° | | å­—æ®µå•ä½ | `desc:å­—æ®µä»‹ç»` | `runner:\"name:å¹´é¾„;desc:å¹´é¾„0-100\"` | è®¾ç½®å­—æ®µçš„è¯¦ç»†ä»‹ç»ï¼ˆéå¿…è¦ï¼‰ | #### widgetæ ‡ç­¾ - UIç»„ä»¶é…ç½® | å±æ€§ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |------|-------------|-----------------------|----------| | ç»„ä»¶ç±»å‹ | `type:ç»„ä»¶ç±»å‹` | `widget:\"type:input\"` | è®¾ç½®UIç»„ä»¶ç±»å‹ | #### dataæ ‡ç­¾ - æ•°æ®å’Œå€¼é…ç½® | åŠŸèƒ½ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |-------|---------------------|-----------------------------|-------------------------| | é»˜è®¤å€¼ | `default_value:å€¼` | `data:\"default_value:é»˜è®¤å€¼\"` | è®¾ç½®å­—æ®µé»˜è®¤å€¼ | | ç¤ºä¾‹å€¼ | `example:ç¤ºä¾‹å€¼` | `data:\"example:ç¤ºä¾‹æ–‡æœ¬\"` | è®¾ç½®ç¤ºä¾‹å€¼ | | åŠ¨æ€é»˜è®¤å€¼ | `default_value:$å˜é‡` | `data:\"default_value:$now\"` | ä½¿ç”¨å˜é‡ä½œä¸ºé»˜è®¤å€¼ | | æ ¼å¼åŒ– | `format:æ ¼å¼åŒ–ç±»å‹` | `format:markdown` | `è®¾ç½®æ ¼å¼åŒ–ç±»å‹ï¼Œcsvæˆ–è€…markdown` #### validateæ ‡ç­¾ - éªŒè¯è§„åˆ™ | è§„åˆ™ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |------|---------------|----------------------------|--------| | å¿…å¡«éªŒè¯ | `required` | `validate:\"required\"` | å­—æ®µå¿…å¡« | | é•¿åº¦éªŒè¯ | `min=å€¼,max=å€¼` | `validate:\"min=2,max=50\"` | é•¿åº¦èŒƒå›´éªŒè¯ | | æ•°å€¼éªŒè¯ | `min=å€¼,max=å€¼` | `validate:\"min=1,max=120\"` | æ•°å€¼èŒƒå›´éªŒè¯ | | æšä¸¾éªŒè¯ | `oneof=å€¼1 å€¼2` | `validate:\"oneof=ç”· å¥³\"` | æšä¸¾å€¼éªŒè¯ | #### searchæ ‡ç­¾ - æœç´¢é…ç½®ï¼ˆä»…tableå‡½æ•°ï¼‰ | æœç´¢ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |------|-----------|--------------------|---------------| | æ¨¡ç³Šæœç´¢ | `like` | `search:\"like\"` | å¯ç”¨æ¨¡ç³Šæœç´¢ | | ç²¾ç¡®æœç´¢ | `eq` | `search:\"eq\"` | å¯ç”¨ç²¾ç¡®æœç´¢ | | åŒºé—´æœç´¢ | `gte,lte` | `search:\"gte,lte\"` | å¯ç”¨å¤§äºç­‰äºã€å°äºç­‰äºæœç´¢ | | å¤šé€‰æœç´¢ | `in` | `search:\"in\"` | å¯ç”¨å¤šé€‰æœç´¢ | #### permissionæ ‡ç­¾ - æƒé™æ§åˆ¶ï¼ˆä»…tableå‡½æ•°ï¼‰ | æƒé™ç±»å‹ | æ ¼å¼ | ç¤ºä¾‹ | è¯´æ˜ | |------|----------|-----------------------|-------------| | ä»…å¯è¯» | `read` | `permission:\"read\"` | ä»…åˆ—è¡¨æ˜¾ç¤ºï¼Œä¸èƒ½ç¼–è¾‘ | | ä»…å¯åˆ›å»º | `create` | `permission:\"create\"` | ä»…æ–°å¢æ˜¾ç¤ºï¼Œåˆ—è¡¨ä¸æ˜¾ç¤º | | ä»…å¯æ›´æ–° | `update` | `permission:\"update\"` | ä»…ç¼–è¾‘æ˜¾ç¤ºï¼Œåˆ—è¡¨ä¸æ˜¾ç¤º | | å…¨æƒé™ | ä¸å†™ | æ— æ ‡ç­¾ | åˆ—è¡¨ã€æ–°å¢ã€ç¼–è¾‘éƒ½æ˜¾ç¤º | ## ğŸ§© ç»„ä»¶ç³»ç»Ÿ ### åŸºç¡€è¾“å…¥ç»„ä»¶ #### inputç»„ä»¶ - æ–‡æœ¬è¾“å…¥ | ç±»å‹ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |------|------------------|--------------------------------------|---------| | å•è¡Œæ–‡æœ¬ | `type:input` | `widget:\"type:input\"` | åŸºç¡€æ–‡æœ¬è¾“å…¥æ¡† | | å¤šè¡Œæ–‡æœ¬ | `mode:text_area` | `widget:\"type:input;mode:text_area\"` | å¤šè¡Œæ–‡æœ¬åŒºåŸŸ | | å¯†ç è¾“å…¥ | `mode:password` | `widget:\"type:input;mode:password\"` | å¯†ç è¾“å…¥æ¡† | #### numberç»„ä»¶ - æ•°å­—è¾“å…¥ | ç±»å‹ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |------|-----------------|-----------------------------------------------------------|--------| | æ•´æ•°è¾“å…¥ | `type:number` | `widget:\"type:number;min:1;max:120;unit:å²\"` | æ•´æ•°è¾“å…¥æ¡† | | å°æ•°è¾“å…¥ | `precision:å°æ•°ä½` | `widget:\"type:number;min:0;precision:2;prefix:ï¿¥\"` | å°æ•°è¾“å…¥æ¡† | | ç™¾åˆ†æ¯” | `suffix:%` | `widget:\"type:number;min:0;max:100;precision:1;suffix:%\"` | ç™¾åˆ†æ¯”è¾“å…¥æ¡† | #### selectç»„ä»¶ - ä¸‹æ‹‰é€‰æ‹© | ç±»å‹ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |------|-----------------|-------------------------------------------------------|-------| | å•é€‰ä¸‹æ‹‰ | `type:select` | `widget:\"type:select;options:ç”·,å¥³\"` | å•é€‰ä¸‹æ‹‰æ¡† | | å¤šé€‰ä¸‹æ‹‰ | `multiple:true` | `widget:\"type:select;options:æŠ€æœ¯,äº§å“,è®¾è®¡;multiple:true\"` | å¤šé€‰ä¸‹æ‹‰æ¡† | #### datetimeç»„ä»¶ - æ—¥æœŸæ—¶é—´ | ç±»å‹ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |------|------------------|-----------------------------------------------------------|---------| | æ—¥æœŸé€‰æ‹© | `kind:date` | `widget:\"type:datetime;kind:date;format:yyyy-MM-dd\"` | æ—¥æœŸé€‰æ‹©å™¨ | | æ—¶é—´é€‰æ‹© | `kind:time` | `widget:\"type:datetime;kind:time;format:HH:mm\"` | æ—¶é—´é€‰æ‹©å™¨ | | æ—¥æœŸæ—¶é—´ | `kind:datetime` | `widget:\"type:datetime;kind:datetime\"` | æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ | | æ—¥æœŸèŒƒå›´ | `kind:daterange` | `widget:\"type:datetime;kind:daterange;format:yyyy-MM-dd\"` | æ—¥æœŸèŒƒå›´é€‰æ‹©å™¨ | ### é«˜çº§ç»„ä»¶ #### multiselectç»„ä»¶ - å¤šé€‰ç»„ä»¶ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |--------|----------------------------------------------------------------------|-----------| | é™æ€å¤šé€‰ | `widget:\"type:multiselect;options:ç´§æ€¥,é‡è¦,API,UI\"` | å›ºå®šé€‰é¡¹å¤šé€‰ | | å¯åˆ›å»ºæ–°é€‰é¡¹ | `widget:\"type:multiselect;options:Java,Python,Go;allow_create:true\"` | æ”¯æŒè‡ªå®šä¹‰åˆ›å»ºé€‰é¡¹ | #### colorç»„ä»¶ - é¢œè‰²é€‰æ‹©å™¨ | æ ¼å¼ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |--------|---------------|---------------------------------------------------|----------| | Hexæ ¼å¼ | `format:hex` | `widget:\"type:color;format:hex;show_alpha:false\"` | 6ä½hexé¢œè‰² | | RGBAæ ¼å¼ | `format:rgba` | `widget:\"type:color;format:rgba;show_alpha:true\"` | RGBAé¢œè‰²æ ¼å¼ | | HSLæ ¼å¼ | `format:hsl` | `widget:\"type:color;format:hsl;show_alpha:false\"` | HSLé¢œè‰²æ ¼å¼ | #### file_uploadç»„ä»¶ - æ–‡ä»¶ä¸Šä¼  | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |-------|--------------------------------------------------------------------------|-------| | å•æ–‡ä»¶ä¸Šä¼  | `widget:\"type:file_upload;accept:.jpg,.png;max_size:5MB\"` | å•æ–‡ä»¶ä¸Šä¼  | | å¤šæ–‡ä»¶ä¸Šä¼  | `widget:\"type:file_upload;accept:.pdf,.doc;multiple:true;max_size:10MB\"` | å¤šæ–‡ä»¶ä¸Šä¼  | #### listç»„ä»¶ - åˆ—è¡¨è¾“å…¥ | ç±»å‹ | ç¤ºä¾‹ | è¯´æ˜ | |------|----------------------|----------| | ç®€å•åˆ—è¡¨ | `widget:\"type:list\"` | å­—ç¬¦ä¸²æˆ–æ•°å­—åˆ—è¡¨ | | å¤æ‚åˆ—è¡¨ | `widget:\"type:list\"` | ç»“æ„ä½“åˆ—è¡¨ | #### formç»„ä»¶ - åµŒå¥—è¡¨å• | ç¤ºä¾‹ | è¯´æ˜ | |----------------------|-------------------| | `widget:\"type:form\"` | åµŒå¥—è¡¨å•ç»“æ„ï¼Œå¯¹åº”æ•°æ®ç»“æ„æ˜¯ç»“æ„ä½“ | ### å…¶ä»–ç»„ä»¶ #### switchç»„ä»¶ - å¼€å…³ | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |-------|-----------------------------------------------------|---------| | åŸºç¡€å¼€å…³ | `widget:\"type:switch\"` | å¸ƒå°”å€¼å¼€å…³ | | è‡ªå®šä¹‰æ ‡ç­¾ | `widget:\"type:switch;true_label:å¯ç”¨;false_label:ç¦ç”¨\"` | è‡ªå®šä¹‰å¼€å…³æ ‡ç­¾ | #### radioç»„ä»¶ - å•é€‰æ¡† | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |-------|--------------------------------------------------------|-----------| | åŸºç¡€å•é€‰æ¡† | `widget:\"type:radio;options:ç”·,å¥³\"` | å•é€‰æŒ‰é’®ç»„ | | æ°´å¹³æ’åˆ— | `widget:\"type:radio;options:ç”·,å¥³;direction:horizontal\"` | æ°´å¹³æ’åˆ—çš„å•é€‰æŒ‰é’® | #### checkboxç»„ä»¶ - å¤é€‰æ¡† | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |-------|-------------------------------------------|--------| | åŸºç¡€å¤é€‰æ¡† | `widget:\"type:checkbox;options:é˜…è¯»,éŸ³ä¹,è¿åŠ¨\"` | å¤šé€‰å¤é€‰æ¡†ç»„ | #### sliderç»„ä»¶ - æ»‘å— | é…ç½® | ç¤ºä¾‹ | è¯´æ˜ | |------|----------------------------------------------------|----------| | æ•°å€¼æ»‘å— | `widget:\"type:slider;min:0;max:100;unit:%\"` | æ•°å€¼èŒƒå›´æ»‘å— | | è¯„åˆ†æ»‘å— | `widget:\"type:slider;min:1;max:5;step:0.5;unit:åˆ†\"` | å¸¦æ­¥è¿›çš„è¯„åˆ†æ»‘å— | ## ğŸ“ ä½¿ç”¨ç¤ºä¾‹ ### åŸºç¡€å­—æ®µé…ç½® ## ï¿½ï¿½ Formå‡½æ•°æ¨¡å‹ç¤ºä¾‹ - å¤§æ¨¡å‹ä»£ç ç”Ÿæˆæ¨¡æ¿ #### ç”¨æˆ·æ³¨å†Œæ¨¡å‹ ```go // è¯·æ±‚ç»“æ„ä½“ - ç”¨æˆ·è¾“å…¥ type UserRegisterReq struct { // åŸºç¡€ä¿¡æ¯ Username string `json:\"username\" runner:\"name:ç”¨æˆ·å\" widget:\"type:input\" data:\"example:john_doe\" validate:\"required,min=3,max=20\"` Password string `json:\"password\" runner:\"name:å¯†ç \" widget:\"type:input;mode:password\" data:\"example:123456\" validate:\"required,min=6,max=20\"` Email string `json:\"email\" runner:\"name:é‚®ç®±\" widget:\"type:input\" data:\"example:john@example.com\" validate:\"required,email\"` // ä¸ªäººä¿¡æ¯ RealName string `json:\"real_name\" runner:\"name:çœŸå®å§“å\" widget:\"type:input\" data:\"example:å¼ ä¸‰\" validate:\"required,min=2,max=20\"` Age int `json:\"age\" runner:\"name:å¹´é¾„\" widget:\"type:number;min:18;max:65;unit:å²\" data:\"example:25\" validate:\"required,min=18,max=65\"` Gender string `json:\"gender\" runner:\"name:æ€§åˆ«\" widget:\"type:radio;options:ç”·,å¥³;direction:horizontal\" data:\"example:ç”·\" validate:\"required,oneof=ç”· å¥³\"` // å·¥ä½œä¿¡æ¯ Department string `json:\"department\" runner:\"name:éƒ¨é—¨\" widget:\"type:select;options:æŠ€æœ¯éƒ¨,äº§å“éƒ¨,è®¾è®¡éƒ¨,è¿è¥éƒ¨\" data:\"default_value:æŠ€æœ¯éƒ¨\" validate:\"required\"` Position string `json:\"position\" runner:\"name:èŒä½\" widget:\"type:input\" data:\"example:è½¯ä»¶å·¥ç¨‹å¸ˆ\" validate:\"required\"` Salary int `json:\"salary\" runner:\"name:æœŸæœ›è–ªèµ„\" widget:\"type:number;min:3000;max:50000;unit:å…ƒ\" data:\"example:15000\" validate:\"required,min=3000,max=50000\"` // æŠ€èƒ½æ ‡ç­¾ Skills []string `json:\"skills\" runner:\"name:æŠ€èƒ½æ ‡ç­¾\" widget:\"type:multiselect;options:Java,Python,Go,JavaScript,React,Vue\" data:\"example:Java,Go\" validate:\"required,min=1\"` // é™„ä»¶ä¸Šä¼  Resume *files.Files `json:\"resume\" runner:\"name:ç®€å†\" widget:\"type:file_upload;accept:.pdf,.doc,.docx;max_size:10MB\" validate:\"required\"` Avatar *files.Files `json:\"avatar\" runner:\"name:å¤´åƒ\" widget:\"type:file_upload;accept:.jpg,.png,.gif;max_size:5MB\"` // å…¶ä»–ä¿¡æ¯ Bio string `json:\"bio\" runner:\"name:ä¸ªäººç®€ä»‹\" widget:\"type:input;mode:text_area\" data:\"example:çƒ­çˆ±ç¼–ç¨‹ï¼Œæœ‰3å¹´å¼€å‘ç»éªŒ\"` AgreeTerms bool `json:\"agree_terms\" runner:\"name:åŒæ„æ¡æ¬¾\" widget:\"type:switch;true_label:åŒæ„;false_label:ä¸åŒæ„\" data:\"example:true\" validate:\"required\"` } // å“åº”ç»“æ„ä½“ - å¤„ç†ç»“æœ type UserRegisterResp struct { // å¤„ç†ç»“æœ Success bool `json:\"success\" runner:\"name:æ˜¯å¦æˆåŠŸ\" widget:\"type:switch;true_label:æˆåŠŸ;false_label:å¤±è´¥\"` Message string `json:\"message\" runner:\"name:å¤„ç†ç»“æœ\" widget:\"type:input;mode:text_area\"` // ç”¨æˆ·ä¿¡æ¯ UserID int `json:\"user_id\" runner:\"name:ç”¨æˆ·ID\" widget:\"type:number\"` Username string `json:\"username\" runner:\"name:ç”¨æˆ·å\" widget:\"type:input\"` // ç³»ç»Ÿä¿¡æ¯ CreatedAt int64 `json:\"created_at\" runner:\"name:æ³¨å†Œæ—¶é—´\" widget:\"type:datetime;kind:datetime\"` Token string `json:\"token\" runner:\"name:è®¿é—®ä»¤ç‰Œ\" widget:\"type:input;mode:password\"` } ``` #### é‡‡è´­ç”³è¯·æ¨¡å‹ ```go // è¯·æ±‚ç»“æ„ä½“ - é‡‡è´­ç”³è¯· type PurchaseReq struct { // åŸºç¡€ä¿¡æ¯ Title string `json:\"title\" runner:\"name:é‡‡è´­æ ‡é¢˜\" widget:\"type:input\" data:\"example:åŠå…¬ç”¨å“é‡‡è´­\" validate:\"required,min=5,max=100\"` Department string `json:\"department\" runner:\"name:ç”³è¯·éƒ¨é—¨\" widget:\"type:select;options:æŠ€æœ¯éƒ¨,äº§å“éƒ¨,è®¾è®¡éƒ¨,è¿è¥éƒ¨\" validate:\"required\"` Priority string `json:\"priority\" runner:\"name:ä¼˜å…ˆçº§\" widget:\"type:select;options:ä½,ä¸­,é«˜,ç´§æ€¥\" data:\"default_value:ä¸­\" validate:\"required\"` // ä¾›åº”å•†ä¿¡æ¯ SupplierID int `json:\"supplier_id\" runner:\"name:ä¾›åº”å•†\" widget:\"type:select\" validate:\"required\"` // é‡‡è´­å•†å“åˆ—è¡¨ Items []PurchaseItem `json:\"items\" runner:\"name:é‡‡è´­å•†å“\" widget:\"type:list\" validate:\"required,min=1\"` // å…¶ä»–ä¿¡æ¯ ExpectedDate int64 `json:\"expected_date\" runner:\"name:æœŸæœ›åˆ°è´§æ—¥æœŸ\" widget:\"type:datetime;kind:date;format:yyyy-MM-dd\" validate:\"required\"` Remarks string `json:\"remarks\" runner:\"name:å¤‡æ³¨è¯´æ˜\" widget:\"type:input;mode:text_area\"` } // é‡‡è´­å•†å“é¡¹ type PurchaseItem struct { ProductID int `json:\"product_id\" runner:\"name:å•†å“\" widget:\"type:select\" validate:\"required\"` Quantity int `json:\"quantity\" runner:\"name:æ•°é‡\" widget:\"type:number;min:1\" data:\"default_value:1\" validate:\"required,min=1\"` UnitPrice float64 `json:\"unit_price\" runner:\"name:å•ä»·\" widget:\"type:number;min:0;precision:2;prefix:ï¿¥\" validate:\"required,min=0\"` Remarks string `json:\"remarks\" runner:\"name:å¤‡æ³¨\" widget:\"type:input\"` } // å“åº”ç»“æ„ä½“ - é‡‡è´­ç»“æœ type PurchaseResp struct { // å¤„ç†ç»“æœ Success bool `json:\"success\" runner:\"name:æ˜¯å¦æˆåŠŸ\" widget:\"type:switch;true_label:æˆåŠŸ;false_label:å¤±è´¥\"` Message string `json:\"message\" runner:\"name:å¤„ç†ç»“æœ\" widget:\"type:input;mode:text_area\"` // é‡‡è´­ä¿¡æ¯ PurchaseID int `json:\"purchase_id\" runner:\"name:é‡‡è´­å•å·\" widget:\"type:number\"` TotalAmount float64 `json:\"total_amount\" runner:\"name:æ€»é‡‘é¢\" widget:\"type:number;precision:2;prefix:ï¿¥\"` TotalItems int `json:\"total_items\" runner:\"name:å•†å“ç§ç±»\" widget:\"type:number\"` // çŠ¶æ€ä¿¡æ¯ Status string `json:\"status\" runner:\"name:é‡‡è´­çŠ¶æ€\" widget:\"type:input\"` CreatedAt int64 `json:\"created_at\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\"` } ``` ### **2. Tableå‡½æ•°æ¨¡å‹ç¤ºä¾‹** #### ç”¨æˆ·ç®¡ç†æ¨¡å‹ ```go // ç”¨æˆ·æ•°æ®æ¨¡å‹ - è‡ªåŠ¨å»ºè¡¨ type CRMUser struct { // ç³»ç»Ÿå­—æ®µ ID int `json:\"id\" gorm:\"primaryKey;autoIncrement\" runner:\"name:ç”¨æˆ·ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index\" runner:\"-\"` // åŸºç¡€ä¿¡æ¯ Username string `json:\"username\" gorm:\"column:username;uniqueIndex\" runner:\"name:ç”¨æˆ·å\" widget:\"type:input\" search:\"like\" validate:\"required,min=3,max=20\"` Email string `json:\"email\" gorm:\"column:email;uniqueIndex\" runner:\"name:é‚®ç®±\" widget:\"type:input\" search:\"like\" validate:\"required,email\"` Phone string `json:\"phone\" gorm:\"column:phone\" runner:\"name:æ‰‹æœºå·\" widget:\"type:input\" search:\"like\" validate:\"required,min=11,max=11\"` // ä¸ªäººä¿¡æ¯ RealName string `json:\"real_name\" gorm:\"column:real_name\" runner:\"name:çœŸå®å§“å\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=20\"` Age int `json:\"age\" gorm:\"column:age\" runner:\"name:å¹´é¾„\" widget:\"type:number;min:18;max:65;unit:å²\" search:\"gte,lte\" validate:\"required,min=18,max=65\"` Gender string `json:\"gender\" gorm:\"column:gender\" runner:\"name:æ€§åˆ«\" widget:\"type:select;options:ç”·,å¥³\" search:\"in\" validate:\"required,oneof=ç”· å¥³\"` Avatar string `json:\"avatar\" gorm:\"column:avatar\" runner:\"name:å¤´åƒ\" widget:\"type:input\"` // å·¥ä½œä¿¡æ¯ Department string `json:\"department\" gorm:\"column:department\" runner:\"name:éƒ¨é—¨\" widget:\"type:select;options:æŠ€æœ¯éƒ¨,äº§å“éƒ¨,è®¾è®¡éƒ¨,è¿è¥éƒ¨\" search:\"in\" validate:\"required\"` Position string `json:\"position\" gorm:\"column:position\" runner:\"name:èŒä½\" widget:\"type:input\" search:\"like\" validate:\"required\"` Salary int `json:\"salary\" gorm:\"column:salary\" runner:\"name:è–ªèµ„\" widget:\"type:number;min:3000;max:50000;unit:å…ƒ\" search:\"gte,lte\" validate:\"required,min=3000,max=50000\"` // çŠ¶æ€ä¿¡æ¯ Status string `json:\"status\" gorm:\"column:status\" runner:\"name:çŠ¶æ€\" widget:\"type:select;options:åœ¨èŒ,ç¦»èŒ,è¯•ç”¨æœŸ\" data:\"default_value:åœ¨èŒ\" search:\"in\" validate:\"required\"` IsActive bool `json:\"is_active\" gorm:\"column:is_active\" runner:\"name:æ˜¯å¦å¯ç”¨\" widget:\"type:switch;true_label:å¯ç”¨;false_label:ç¦ç”¨\" data:\"default_value:true\" search:\"eq\" validate:\"required\"` // æ•æ„Ÿä¿¡æ¯ - ä»…æ–°å¢å’Œç¼–è¾‘æ—¶æ˜¾ç¤º Password string `json:\"password\" gorm:\"column:password\" runner:\"name:å¯†ç \" widget:\"type:input;mode:password\" permission:\"create,update\"` } func (User) TableName() string { return \"crm_user\" } // è¯·æ±‚ç»“æ„ä½“ - åˆ†é¡µæœç´¢ type CRMUserListReq struct { query.PageInfoReq `runner:\"-\"` // è‡ªå®šä¹‰æœç´¢å­—æ®µï¼Œè¿™é‡Œçš„å­—æ®µæ˜¯ä¸å­˜åœ¨äºä¸Šé¢è¡¨ä¸­çš„å­—æ®µï¼Œå­˜åœ¨è¡¨ä¸­çš„å­—æ®µå¯ä»¥ç›´æ¥æ‰“æ ‡ç­¾æ”¯æŒå„ç§æœç´¢ï¼Œ //ä¸‹é¢çš„æœç´¢å­—æ®µä¸€èˆ¬æ˜¯joinå­—æ®µï¼Œä¾‹å¦‚ ç”¨æˆ·å…³è”ç»„ç»‡è¡¨ï¼Œç„¶åä¸‹é¢å¯ä»¥ç”¨ç»„ç»‡è¡¨çš„å­—æ®µï¼Œç„¶ååœ¨å¤„ç†å‡½æ•°ç”¨è¯¥å­—æ®µè¿›è¡Œè¿è¡¨æŸ¥è¯¢ OrgName string `json:\"org_name\" runner:\"name:ç»„ç»‡åç§°\" widget:\"type:input\" search:\"like\"` } ``` #### äº§å“ç®¡ç†æ¨¡å‹ ```go // äº§å“æ•°æ®æ¨¡å‹ - è‡ªåŠ¨å»ºè¡¨ type Product struct { // ç³»ç»Ÿå­—æ®µ ID int `json:\"id\" gorm:\"primaryKey;autoIncrement\" runner:\"name:äº§å“ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index\" runner:\"-\"` // åŸºç¡€ä¿¡æ¯ Name string `json:\"name\" gorm:\"column:name\" runner:\"name:äº§å“åç§°\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=100\"` Code string `json:\"code\" gorm:\"column:code;uniqueIndex\" runner:\"name:äº§å“ç¼–ç \" widget:\"type:input\" search:\"like\" validate:\"required,min=3,max=20\"` Category string `json:\"category\" gorm:\"column:category\" runner:\"name:äº§å“åˆ†ç±»\" widget:\"type:select;options:ç”µå­äº§å“,æœè£…,é£Ÿå“,å®¶å±…,å…¶ä»–\" search:\"in\" validate:\"required\"` // è§„æ ¼ä¿¡æ¯ Brand string `json:\"brand\" gorm:\"column:brand\" runner:\"name:å“ç‰Œ\" widget:\"type:input\" search:\"like\" validate:\"required\"` Model string `json:\"model\" gorm:\"column:model\" runner:\"name:å‹å·\" widget:\"type:input\" search:\"like\"` Spec string `json:\"spec\" gorm:\"column:spec\" runner:\"name:è§„æ ¼\" widget:\"type:input\" search:\"like\"` Unit string `json:\"unit\" gorm:\"column:unit\" runner:\"name:å•ä½\" widget:\"type:input\" search:\"like\" validate:\"required\"` // ä»·æ ¼ä¿¡æ¯ CostPrice float64 `json:\"cost_price\" gorm:\"column:cost_price\" runner:\"name:æˆæœ¬ä»·\" widget:\"type:number;min:0;precision:2;prefix:ï¿¥\" search:\"gte,lte\" validate:\"required,min=0\"` SalePrice float64 `json:\"sale_price\" gorm:\"column:sale_price\" runner:\"name:é”€å”®ä»·\" widget:\"type:number;min:0;precision:2;prefix:ï¿¥\" search:\"gte,lte\" validate:\"required,min=0\"` MarketPrice float64 `json:\"market_price\" gorm:\"column:market_price\" runner:\"name:å¸‚åœºä»·\" widget:\"type:number;min:0;precision:2;prefix:ï¿¥\" search:\"gte,lte\"` // åº“å­˜ä¿¡æ¯ Stock int `json:\"stock\" gorm:\"column:stock\" runner:\"name:åº“å­˜\" widget:\"type:number;min:0;unit:ä»¶\" search:\"gte,lte\" validate:\"required,min=0\"` MinStock int `json:\"min_stock\" gorm:\"column:min_stock\" runner:\"name:æœ€ä½åº“å­˜\" widget:\"type:number;min:0;unit:ä»¶\" data:\"default_value:10\" validate:\"required,min=0\"` // çŠ¶æ€ä¿¡æ¯ Status string `json:\"status\" gorm:\"column:status\" runner:\"name:çŠ¶æ€\" widget:\"type:select;options:ä¸Šæ¶,ä¸‹æ¶,ç¼ºè´§,åœå”®\" data:\"default_value:ä¸Šæ¶\" search:\"in\" validate:\"required\"` IsHot bool `json:\"is_hot\" gorm:\"column:is_hot\" runner:\"name:æ˜¯å¦çƒ­é”€\" widget:\"type:switch;true_label:æ˜¯;false_label:å¦\" data:\"default_value:false\" search:\"eq\"` // æè¿°ä¿¡æ¯ Description string `json:\"description\" gorm:\"column:description\" runner:\"name:äº§å“æè¿°\" widget:\"type:input;mode:text_area\" search:\"like\"` Images string `json:\"images\" gorm:\"column:images\" runner:\"name:äº§å“å›¾ç‰‡\" widget:\"type:input\"` } func (Product) TableName() string { return \"product\" } // è¯·æ±‚ç»“æ„ä½“ - åˆ†é¡µæœç´¢ type ProductListReq struct { query.PageInfoReq `runner:\"-\"` // è‡ªå®šä¹‰æœç´¢å­—æ®µ Category string `json:\"category\" runner:\"name:åˆ†ç±»ç­›é€‰\" widget:\"type:select;options:ç”µå­äº§å“,æœè£…,é£Ÿå“,å®¶å±…,å…¶ä»–\" search:\"in\"` Brand string `json:\"brand\" runner:\"name:å“ç‰Œç­›é€‰\" widget:\"type:input\" search:\"like\"` PriceRange []float64 `json:\"price_range\" runner:\"name:ä»·æ ¼èŒƒå›´\" widget:\"type:number;min:0;precision:2\" search:\"gte,lte\"` StockStatus string `json:\"stock_status\" runner:\"name:åº“å­˜çŠ¶æ€\" widget:\"type:select;options:å……è¶³,ä¸è¶³,ç¼ºè´§\" search:\"in\"` } ``` ### ï¿½ï¿½ï¸ Formå‡½æ•°é…ç½®æ¨¡æ¿ ```go var YourFormOption = &runner.FormFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"åŠŸèƒ½åç§°\", ApiDesc: \"åŠŸèƒ½æè¿°\", Tags: []string{\"æ ‡ç­¾1\", \"æ ‡ç­¾2\"}, Request: &YourReq{}, Response: &YourResp{}, CreateTables: []interface{}{&YourModel{}}, // å¦‚æœéœ€è¦å»ºè¡¨ Group: YourGroup, // å¦‚æœä½¿ç”¨å‡½æ•°ç»„ }, // å¦‚æœéœ€è¦æ¨¡ç³Šæœç´¢ OnInputFuzzyMap: map[string]runner.OnInputFuzzy{ \"field_name\": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) { // å®ç°æ¨¡ç³Šæœç´¢é€»è¾‘ return &usercall.OnInputFuzzyResp{ Statistics: map[string]interface{}{ \"ç»Ÿè®¡ä¿¡æ¯\": \"èšåˆè®¡ç®—è¡¨è¾¾å¼\", }, Values: items, }, nil }, }, } ``` ### ï¿½ï¿½ï¸ Tableå‡½æ•°é…ç½®æ¨¡æ¿ ```go var YourTableOption = &runner.TableFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"åŠŸèƒ½åç§°\", ApiDesc: \"åŠŸèƒ½æè¿°\", Tags: []string{\"æ ‡ç­¾1\", \"æ ‡ç­¾2\"}, Request: &YourListReq{}, Response: query.PaginatedTable[[]YourModel]{}, CreateTables: []interface{}{&YourModel{}}, Group: YourGroup, // å¦‚æœä½¿ç”¨å‡½æ•°ç»„ }, // è‡ªåŠ¨CRUD AutoCrudTable: &YourModel{}, // å¦‚æœéœ€è¦å›è°ƒ OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) { // å®ç°æ–°å¢é€»è¾‘ return &usercall.OnTableAddRowsResp{}, nil }, OnTableUpdateRows: func(ctx *runner.Context, req *usercall.OnTableUpdateRowsReq) (*usercall.OnTableUpdateRowsResp, error) { // å®ç°æ›´æ–°é€»è¾‘ return &usercall.OnTableUpdateRowsResp{}, nil }, OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) { // å®ç°åˆ é™¤é€»è¾‘ return &usercall.OnTableDeleteRowsResp{}, nil }, } ``` ### æƒé™æ§åˆ¶ç¤ºä¾‹ ```go type Product struct { // åªè¯»å­—æ®µ ID int `json:\"id\" gorm:\"primaryKey\" runner:\"name:ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" permission:\"read\"` // ä¸šåŠ¡å­—æ®µï¼šå…¨æƒé™ Name string `json:\"name\" runner:\"name:äº§å“åç§°\" widget:\"type:input\" search:\"like\" validate:\"required\"` Status string `json:\"status\" runner:\"name:çŠ¶æ€\" widget:\"type:select;options:å¯ç”¨,ç¦ç”¨\" search:\"in\"` // å¯†é’¥å­—æ®µï¼šä»…ç¼–è¾‘æ—¶æ˜¾ç¤ºï¼ˆç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œç”¨æˆ·ä¸èƒ½ä¿®æ”¹ï¼‰ SecretKey string `json:\"secret_key\" runner:\"name:å¯†é’¥\" widget:\"type:input;mode:password\" permission:\"update\"` // å¤‡æ³¨å­—æ®µï¼šä»…åˆ›å»ºæ—¶æ˜¾ç¤ºï¼ˆåˆ›å»ºåä¸èƒ½ç¼–è¾‘ï¼‰ Remark string `json:\"remark\" runner:\"name:åˆ›å»ºå¤‡æ³¨\" widget:\"type:input;mode:text_area\" permission:\"create\"` } ``` ## ğŸ¯ æœ€ä½³å®è·µ ### 1. æ ‡ç­¾é…ç½®åŸåˆ™ - **å¿…å¡«å­—æ®µ**ï¼šæ·»åŠ  `validate:\"required\"` - **æœç´¢å­—æ®µ**ï¼šæ ¹æ®ç±»å‹é€‰æ‹©åˆé€‚çš„ `search` æ ‡ç­¾ - **æƒé™æ§åˆ¶**ï¼šä½¿ç”¨ `permission` æ ‡ç­¾æ§åˆ¶å­—æ®µæ˜¾ç¤º - **é»˜è®¤å€¼**ï¼šä½¿ç”¨ `data:\"default_value:å€¼\"` è®¾ç½®é»˜è®¤å€¼ ### 2. ç»„ä»¶é€‰æ‹©åŸåˆ™ - **æ–‡æœ¬è¾“å…¥**ï¼šä½¿ç”¨ `input` ç»„ä»¶ - **æ•°å­—è¾“å…¥**ï¼šä½¿ç”¨ `number` ç»„ä»¶ - **é€‰æ‹©è¾“å…¥**ï¼šä½¿ç”¨ `select`ã€`radio`ã€`checkbox` ç»„ä»¶ - **æ—¥æœŸæ—¶é—´**ï¼šä½¿ç”¨ `datetime` ç»„ä»¶ - **æ–‡ä»¶å¤„ç†**ï¼šä½¿ç”¨ `file_upload` ç»„ä»¶ - **å¤šé€‰åœºæ™¯**ï¼šä½¿ç”¨ `multiselect` ç»„ä»¶ ### 3. æœç´¢é…ç½®åŸåˆ™ - **æ–‡æœ¬å­—æ®µ**ï¼šä½¿ç”¨ `like` æ¨¡ç³Šæœç´¢ - **çŠ¶æ€å­—æ®µ**ï¼šä½¿ç”¨ `in` å¤šé€‰æœç´¢ - **æ•°å€¼å­—æ®µ**ï¼šä½¿ç”¨ `gte,lte` åŒºé—´æœç´¢ - **æ—¶é—´å­—æ®µ**ï¼šä½¿ç”¨ `gte,lte` æ—¶é—´èŒƒå›´æœç´¢ ### 4. éªŒè¯è§„åˆ™åŸåˆ™ - **å¿…å¡«éªŒè¯**ï¼šå¿…å¡«å­—æ®µå¿…é¡»æ·»åŠ  `required` - **é•¿åº¦é™åˆ¶**ï¼šé˜²æ­¢è¿‡é•¿è¾“å…¥ï¼Œä½¿ç”¨ `min`ã€`max` - **æ ¼å¼éªŒè¯**ï¼šé‚®ç®±ã€URLç­‰ç‰¹æ®Šæ ¼å¼ä½¿ç”¨ç›¸åº”éªŒè¯è§„åˆ™ - **ä¸šåŠ¡è§„åˆ™**ï¼šç¬¦åˆå®é™…ä¸šåŠ¡éœ€æ±‚çš„éªŒè¯è§„åˆ™ ## tableå‡½æ•°æœ€ä½³å®è·µçš„ç¤ºä¾‹ ```go // Package crm // æ–‡ä»¶ï¼šcrm_ticket.go package crm import ( \"github.com/yunhanshu-net/function-go/pkg/dto/response\" \"github.com/yunhanshu-net/function-go/pkg/dto/usercall\" \"github.com/yunhanshu-net/function-go/runner\" \"github.com/yunhanshu-net/pkg/query\" \"github.com/yunhanshu-net/pkg/typex/files\" \"gorm.io/gorm\" ) // å·¥å•æ•°æ®æ¨¡å‹ type CrmTicket struct { // æ¡†æ¶æ ‡ç­¾ï¼šrunner:\"name:å·¥å•ID\" - è®¾ç½®å­—æ®µåœ¨å‰ç«¯çš„æ˜¾ç¤ºåç§° // æ¡†æ¶æ ‡ç­¾ï¼špermission:\"read\" - å­—æ®µåªè¯»æƒé™ï¼ˆä¸èƒ½ç¼–è¾‘ï¼‰ // æ³¨æ„ï¼šgorm:\"column:id\" æ˜ç¡®æŒ‡å®šæ•°æ®åº“åˆ—åï¼Œç¡®ä¿æ˜ å°„æ­£ç¡® ID int `json:\"id\" gorm:\"primaryKey;autoIncrement;column:id\" runner:\"name:å·¥å•ID\" permission:\"read\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:datetime;kind:datetime\" - æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ç»„ä»¶ // æ³¨æ„ï¼šgorm:\"autoCreateTime:milli\" è‡ªåŠ¨å¡«å……åˆ›å»ºæ—¶é—´ï¼ˆæ¯«ç§’çº§æ—¶é—´æˆ³ï¼Œå¿…é¡»æ˜¯æ¯«ç§’çº§åˆ«ï¼‰ CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli;column:created_at\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:datetime;kind:datetime\" - æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨ç»„ä»¶ï¼Œï¼ˆæ¯«ç§’çº§æ—¶é—´æˆ³ï¼Œå¿…é¡»æ˜¯æ¯«ç§’çº§åˆ«ï¼‰ UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli;column:updated_at\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` // æ¡†æ¶æ ‡ç­¾ï¼šrunner:\"-\" - éšè—å­—æ®µï¼ˆä¸åœ¨å‰ç«¯æ˜¾ç¤ºï¼‰ DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index;column:deleted_at\" runner:\"-\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:input\" - æ–‡æœ¬è¾“å…¥æ¡†ç»„ä»¶ // æ¡†æ¶æ ‡ç­¾ï¼šsearch:\"like\" - å¯ç”¨æ¨¡ç³Šæœç´¢åŠŸèƒ½ // æ¡†æ¶æ ‡ç­¾ï¼švalidate:\"required,min=2,max=200\" - å¿…å¡«å­—æ®µï¼Œé•¿åº¦2-200å­—ç¬¦ Title string `json:\"title\" gorm:\"column:title\" runner:\"name:å·¥å•æ ‡é¢˜\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=200\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:input;mode:text_area\" - å¤šè¡Œæ–‡æœ¬åŒºåŸŸç»„ä»¶ // æ¡†æ¶æ ‡ç­¾ï¼švalidate:\"required,min=10\" - å¿…å¡«å­—æ®µï¼Œè‡³å°‘10å­—ç¬¦ Description string `json:\"description\" gorm:\"column:description\" runner:\"name:é—®é¢˜æè¿°\" widget:\"type:input;mode:text_area\" validate:\"required,min=10\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:select;options:ä½,ä¸­,é«˜\" - ä¸‹æ‹‰é€‰æ‹©ç»„ä»¶ï¼ˆé€‰é¡¹ï¼šä½/ä¸­/é«˜ï¼‰ // æ¡†æ¶æ ‡ç­¾ï¼šdata:\"default_value:ä¸­\" - è®¾ç½®é»˜è®¤å€¼ä¸º\"ä¸­\" // æ¡†æ¶æ ‡ç­¾ï¼švalidate:\"required,oneof=ä½,ä¸­,é«˜\" - å¿…å¡«å­—æ®µï¼Œå€¼å¿…é¡»æ˜¯é€‰é¡¹ä¹‹ä¸€ Priority string `json:\"priority\" gorm:\"column:priority\" runner:\"name:ä¼˜å…ˆçº§\" widget:\"type:select;options:ä½,ä¸­,é«˜\" data:\"default_value:ä¸­\" validate:\"required,oneof=ä½,ä¸­,é«˜\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:select;options:å¾…å¤„ç†,å¤„ç†ä¸­,å·²å®Œæˆ,å·²å…³é—­\" - ä¸‹æ‹‰é€‰æ‹©ç»„ä»¶ // æ¡†æ¶æ ‡ç­¾ï¼šdata:\"default_value:å¾…å¤„ç†\" - è®¾ç½®é»˜è®¤çŠ¶æ€ä¸º\"å¾…å¤„ç†\" // æ¡†æ¶æ ‡ç­¾ï¼švalidate:\"required,oneof=å¾…å¤„ç†,å¤„ç†ä¸­,å·²å®Œæˆ,å·²å…³é—­\" - å€¼å¿…é¡»æ˜¯æœ‰æ•ˆçŠ¶æ€ Status string `json:\"status\" gorm:\"column:status\" runner:\"name:å·¥å•çŠ¶æ€\" widget:\"type:select;options:å¾…å¤„ç†,å¤„ç†ä¸­,å·²å®Œæˆ,å·²å…³é—­\" data:\"default_value:å¾…å¤„ç†\" validate:\"required,oneof=å¾…å¤„ç†,å¤„ç†ä¸­,å·²å®Œæˆ,å·²å…³é—­\"` // æ¡†æ¶æ ‡ç­¾ï¼švalidate:\"required,min=11,max=20\" - å¿…å¡«å­—æ®µï¼Œé•¿åº¦11-20å­—ç¬¦ Phone string `json:\"phone\" gorm:\"column:phone\" runner:\"name:è”ç³»ç”µè¯\" widget:\"type:input\" validate:\"required,min=11,max=20\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:input;mode:text_area\" - å¤šè¡Œæ–‡æœ¬åŒºåŸŸç»„ä»¶ Remark string `json:\"remark\" gorm:\"column:remark\" runner:\"name:å¤‡æ³¨\" widget:\"type:input;mode:text_area\"` // æ¡†æ¶æ ‡ç­¾ï¼šwidget:\"type:file_upload;multiple:true;...\" - å¤šæ–‡ä»¶ä¸Šä¼ ç»„ä»¶ // æ¡†æ¶æ ‡ç­¾ï¼šaccept:.pdf,.doc,... - å…è®¸ä¸Šä¼ çš„æ–‡ä»¶ç±»å‹ // æ³¨æ„ï¼šgorm:\"type:json\" æŒ‡å®šæ•°æ®åº“å­˜å‚¨ä¸ºJSONç±»å‹ Attachment *files.Files `json:\"attachment\" gorm:\"type:json;column:attachment\" runner:\"name:é™„ä»¶\" widget:\"type:file_upload;multiple:true;max_size:10MB;accept:.pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.txt,.jpg,.png,.gif,.zip,.rar\"` } // æ¡†æ¶åŠŸèƒ½ï¼šTableName() æŒ‡å®šæ•°æ®åº“è¡¨å func (CrmTicket) TableName() string { return \"crm_ticket\" } // åˆ†é¡µè¯·æ±‚ç»“æ„ type CrmTicketListReq struct { // æ¡†æ¶æ ‡ç­¾ï¼šrunner:\"-\" - éšè—æœç´¢ï¼Œåˆ†é¡µï¼Œç­‰è¯·æ±‚å‚æ•°ï¼ˆæ— éœ€åœ¨å‰ç«¯æ˜¾ç¤ºï¼‰ query.PageInfoReq `runner:\"-\"` } // è¡¨æ ¼å¤„ç†å‡½æ•°ï¼Œè¿™é‡Œæ˜¯å‰ç«¯å±•ç¤ºåˆ—è¡¨æ•°æ®çš„æ¥å£ func CrmTicketList(ctx *runner.Context, req *CrmTicketListReq, resp response.Response) error { // æ¡†æ¶åŠŸèƒ½ï¼šctx.MustGetOrInitDB() - è·å–æ•°æ®åº“è¿æ¥ db := ctx.MustGetOrInitDB() var rows []CrmTicket //ã€æ¡†æ¶è§„èŒƒã€‘è¿™é‡Œæ¡†æ¶ä¼šè‡ªåŠ¨æ‹¿ç€è¯·æ±‚å‚æ•°å’Œdbå»æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼Œè‡ªåŠ¨åˆ†é¡µç­‰ç­‰ queryBuilder := resp.Table(&rows).AutoPaginated(db, &CrmTicket{}, &req.PageInfoReq) //æ­¤æ—¶rowsï¼Œå·²ç»æ˜¯æ ¹æ®è¯·æ±‚æ¡ä»¶å’Œåˆ†é¡µæ¡ä»¶æŸ¥è¯¢åˆ°çš„æ•°æ®äº†ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢åˆ°æ•°æ®åå¯¹æ•°æ®è¿›è¡Œå¤„ç†ç­‰ç­‰ // æ¡†æ¶åŠŸèƒ½ï¼šAutoPaginated() - è‡ªåŠ¨å¤„ç†åˆ†é¡µ/æœç´¢/æ’åº return queryBuilder.Build() } // è‡ªåŠ¨CRUDé…ç½® var CrmTicketListOption = &runner.TableFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"CRMå·¥å•ç®¡ç†\", // APIä¸­æ–‡åç§° ApiDesc: \"å·¥å•ç®¡ç†ç³»ç»Ÿ\", // APIæè¿° Tags: []string{\"å·¥å•ç³»ç»Ÿ\", \"æ”¿åŠ¡ç³»ç»Ÿ\", \"å·¥å•ç®¡ç†\",\"CRM\"}, // æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾åˆ†ç±» // æ¡†æ¶åŠŸèƒ½ï¼šCreateTables - æœåŠ¡å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»ºæ•°æ®è¡¨ CreateTables: []interface{}{&CrmTicket{}}, //å¯¹åº”æŸ¥è¯¢çš„è¯·æ±‚å‚æ•° Request: &CrmTicketListReq{}, //å›ºå®šquery.PaginatedTable[[]table]{} çš„æ ¼å¼ Response: query.PaginatedTable[[]CrmTicket]{}, }, // æ¡†æ¶åŠŸèƒ½ï¼šAutoCrudTable - è‡ªåŠ¨ç”Ÿæˆå¢åˆ æ”¹æŸ¥çš„ç•Œé¢ AutoCrudTable: &CrmTicket{}, //ã€æ¡†æ¶è§„èŒƒã€‘æ–°å¢è®°å½•å›è°ƒ OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) { //ã€æ¡†æ¶è§„èŒƒã€‘è¿™é‡Œå¯ä»¥ç›´æ¥è·å–åˆ°gormçš„db gormDb := ctx.MustGetOrInitDB() var addRows []*CrmTicket //ã€æ¡†æ¶è§„èŒƒã€‘è¿™é‡Œè§£æç”¨æˆ·æ–°å¢çš„è®°å½• if err := req.DecodeBy(&addRows); err != nil { return nil, err } //æŠŠè®°å½•å†™å…¥dbï¼Œå†™å…¥å‰åéƒ½å¯ä»¥åšä¸€äº›æ“ä½œ err := gormDb.Create(&addRows).Error if err != nil { return nil, err } return &usercall.OnTableAddRowsResp{}, nil }, //ã€æ¡†æ¶è§„èŒƒã€‘æ›´æ–°è®°å½•å›è°ƒ OnTableUpdateRows: func(ctx *runner.Context, req *usercall.OnTableUpdateRowsReq) (*usercall.OnTableUpdateRowsResp, error) { //ã€æ¡†æ¶è§„èŒƒã€‘è¿™é‡Œå¯ä»¥ç›´æ¥è·å–åˆ°gormçš„db gormDb := ctx.MustGetOrInitDB() var updateRow CrmTicket if err := req.DecodeBy(&updateRow); err != nil { //è¿™é‡Œåªèƒ½è§£æåˆ°æ›´æ–°çš„å­—æ®µçš„æ•°æ®ï¼Œä¾‹å¦‚æ›´æ–°äº†phoneå­—æ®µçš„è¯ï¼Œé‚£ä¹ˆå…¶ä»–å­—æ®µéƒ½æ˜¯ç©ºå€¼ï¼Œåªæœ‰phoneå­˜åœ¨å€¼ return nil, err } err := gormDb.Where(\"id in (?)\", req.Ids).Updates(&updateRow).Error if err != nil { return nil, err } return &usercall.OnTableUpdateRowsResp{}, nil }, //ã€æ¡†æ¶è§„èŒƒã€‘åˆ é™¤è®°å½•å›è°ƒ OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) { gormDb := ctx.MustGetOrInitDB() err := gormDb.Delete(&CrmTicket{}, req.Ids).Error if err != nil { return nil, err } return &usercall.OnTableDeleteRowsResp{}, nil }, } // æ¡†æ¶åŠŸèƒ½ï¼šinit() å‡½æ•°è‡ªåŠ¨æ³¨å†Œè·¯ç”± func init() { // æ¡†æ¶åŠŸèƒ½ï¼šrunner.Get() - æ³¨å†ŒTableè¯·æ±‚è·¯ç”± runner.Get(RouterGroup+\"/crm_ticket_list\", CrmTicketList, CrmTicketListOption) } ``` formå‡½æ•°æœ€ä½³å®è·µç¤ºä¾‹ ```go // æ–‡ä»¶åï¼štext_convert.go package text import ( \"strings\" \"github.com/yunhanshu-net/function-go/pkg/dto/response\" \"github.com/yunhanshu-net/function-go/runner\" ) // ã€æ¡†æ¶åŠŸèƒ½ã€‘Formå‡½æ•°è¯·æ±‚ç»“æ„ä½“ï¼šå®šä¹‰ç”¨æˆ·è¾“å…¥å­—æ®µï¼Œæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå‰ç«¯è¡¨å• type TextConvertReq struct { // ã€æ¡†æ¶æ ‡ç­¾ã€‘widget:\"type:input;mode:text_area\" - è‡ªåŠ¨æ¸²æŸ“ä¸ºå¤šè¡Œæ–‡æœ¬è¾“å…¥æ¡† InputText string `json:\"input_text\" runner:\"name:è¾“å…¥æ–‡æœ¬\" widget:\"type:input;mode:text_area\" validate:\"required\"` // ã€æ¡†æ¶æ ‡ç­¾ã€‘widget:\"type:select;options:...\" - è‡ªåŠ¨æ¸²æŸ“ä¸ºä¸‹æ‹‰é€‰æ‹©æ¡†ï¼Œdata:\"default_value\"è®¾ç½®é»˜è®¤å€¼ ConvertType string `json:\"convert_type\" runner:\"name:è½¬æ¢ç±»å‹\" widget:\"type:select;options:è½¬å¤§å†™,è½¬å°å†™,é¦–å­—æ¯å¤§å†™\" data:\"default_value:è½¬å¤§å†™\"` } // ã€æ¡†æ¶åŠŸèƒ½ã€‘Formå‡½æ•°å“åº”ç»“æ„ä½“ï¼šå®šä¹‰è¿”å›ç»“æœï¼Œæ¡†æ¶è‡ªåŠ¨æ¸²æŸ“å‰ç«¯å±•ç¤º type TextConvertResp struct { // ã€æ¡†æ¶æ ‡ç­¾ã€‘widget:\"type:input;mode:text_area\" - è‡ªåŠ¨æ¸²æŸ“ä¸ºå¤šè¡Œæ–‡æœ¬å±•ç¤ºåŒºåŸŸ Result string `json:\"result\" runner:\"name:è½¬æ¢ç»“æœ\" widget:\"type:input;mode:text_area\"` // ã€æ¡†æ¶æ ‡ç­¾ã€‘widget:\"type:input\" - è‡ªåŠ¨æ¸²æŸ“ä¸ºå•è¡Œæ–‡æœ¬å±•ç¤º Message string `json:\"message\" runner:\"name:çŠ¶æ€\" widget:\"type:input\"` } // ã€æ¡†æ¶åŠŸèƒ½ã€‘Formå‡½æ•°å¤„ç†å‡½æ•°ï¼šæ¡†æ¶è‡ªåŠ¨è°ƒç”¨æ­¤å‡½æ•°å¤„ç†ç”¨æˆ·è¯·æ±‚ func TextConvert(ctx *runner.Context, req *TextConvertReq, resp response.Response) error { var result string // ä¸šåŠ¡é€»è¾‘ï¼šæ ¹æ®è½¬æ¢ç±»å‹æ‰§è¡Œæ–‡æœ¬è½¬æ¢ switch req.ConvertType { case \"è½¬å¤§å†™\": result = strings.ToUpper(req.InputText) case \"è½¬å°å†™\": result = strings.ToLower(req.InputText) case \"é¦–å­—æ¯å¤§å†™\": result = strings.Title(strings.ToLower(req.InputText)) default: result = req.InputText } // ã€æ¡†æ¶åŠŸèƒ½ã€‘resp.Form() - è‡ªåŠ¨å°†ç»“æœæ¸²æŸ“ä¸ºå‰ç«¯è¡¨å•å±•ç¤º return resp.Form(&TextConvertResp{ Result: result, Message: \"è½¬æ¢å®Œæˆ\", }).Build() } // ã€æ¡†æ¶åŠŸèƒ½ã€‘Formå‡½æ•°é…ç½®ï¼šå®šä¹‰APIå…ƒæ•°æ®ï¼Œæ¡†æ¶è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£å’Œè·¯ç”± var TextConvertOption = &runner.FormFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"æ–‡æœ¬å¤§å°å†™è½¬æ¢\", // æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆä¸­æ–‡æ¥å£åç§° ApiDesc: \"æ”¯æŒæ–‡æœ¬å¤§å°å†™è½¬æ¢çš„å·¥å…·ï¼ŒåŒ…æ‹¬è½¬å¤§å†™ã€è½¬å°å†™ã€é¦–å­—æ¯å¤§å†™ç­‰åŠŸèƒ½\", // æ¡†æ¶è‡ªåŠ¨ç”ŸæˆAPIæè¿° Tags: []string{\"æ–‡æœ¬å¤„ç†\", \"æ ¼å¼è½¬æ¢\", \"å·¥å…·å‡½æ•°\"}, // æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆæ ‡ç­¾åˆ†ç±» Request: &TextConvertReq{}, // æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆè¯·æ±‚å‚æ•°è¯´æ˜ Response: &TextConvertResp{}, // æ¡†æ¶è‡ªåŠ¨ç”Ÿæˆå“åº”ç»“æœè¯´æ˜ }, } // ã€æ¡†æ¶åŠŸèƒ½ã€‘è·¯ç”±æ³¨å†Œï¼šæ¡†æ¶è‡ªåŠ¨åˆ›å»ºRouterGroup å˜é‡ï¼Œæ— éœ€è‡ªå·±åˆ›å»ºRouterGroupå˜é‡ï¼Œå¯ä»¥ç›´æ¥ç”¨ func init() { // ã€æ¡†æ¶åŠŸèƒ½ã€‘runner.Post() - è‡ªåŠ¨åˆ›å»ºPOSTè·¯ç”±ï¼Œæ”¯æŒè¡¨å•æäº¤ runner.Post(RouterGroup+\"/text_convert\", TextConvert, TextConvertOption) } ``` ### ç¤ºä¾‹3ï¼šå¤æ‚Table+Formç³»ç»Ÿ - é‡‡è´­ç®¡ç†ç³»ç»Ÿ **åŠŸèƒ½**ï¼šå®Œæ•´çš„é‡‡è´­ä¸šåŠ¡æµç¨‹ï¼ŒåŒ…å«ä¾›åº”å•†ç®¡ç†ã€å•†å“ç®¡ç†ã€é‡‡è´­è®°å½• ```go //retail_purchase.go /* <metadata> <ç”¨æˆ·éœ€æ±‚> æˆ‘éœ€è¦ä¸€ä¸ªé‡‡è´­ç®¡ç†ç³»ç»Ÿï¼Œå¸®åŠ©é‡‡è´­å‘˜ç®¡ç†ä¾›åº”å•†ã€å•†å“å’Œé‡‡è´­è®°å½•ã€‚ åŠŸèƒ½éœ€æ±‚ï¼š ä¾›åº”å•†ç®¡ç†ï¼š - ä¾›åº”å•†ä¿¡æ¯ï¼šåç§°ã€è”ç³»æ–¹å¼ã€åœ°å€ã€çŠ¶æ€ - ä¾›åº”å•†çŠ¶æ€ï¼šæ­£å¸¸åˆä½œã€æš‚åœåˆä½œã€ç»ˆæ­¢åˆä½œ å•†å“ç®¡ç†ï¼š - å•†å“ä¿¡æ¯ï¼šåç§°ã€åˆ†ç±»ã€è§„æ ¼ã€å•ä½ã€æ ‡å‡†å•ä»· - å•†å“åˆ†ç±»ï¼šåŸææ–™ã€åŠæˆå“ã€æˆå“ã€åŒ…è£…ç‰© - å•†å“çŠ¶æ€ï¼šæ­£å¸¸é‡‡è´­ã€æš‚åœé‡‡è´­ã€æ·˜æ±° - å•†å“å½’å±ï¼šæ¯ä¸ªå•†å“å±äºç‰¹å®šä¾›åº”å•† é‡‡è´­ç®¡ç†ï¼š - é‡‡è´­ç”³è¯·ï¼šé€‰æ‹©ä¾›åº”å•†ã€å¤šé€‰è¯¥ä¾›åº”å•†çš„å•†å“ã€å¡«å†™æ•°é‡ - é‡‡è´­è®°å½•ï¼šè®°å½•é‡‡è´­å†å²ã€çŠ¶æ€è·Ÿè¸ª - ç»Ÿè®¡åˆ†æï¼šé‡‡è´­é‡‘é¢ã€å•†å“ç§ç±»ã€ä¾›åº”å•†åˆ†æ ä¸šåŠ¡è§„åˆ™ï¼š - é‡‡è´­æ•°é‡å¿…é¡»å¤§äº0 - ç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ€»ä»·ï¼ˆæ•°é‡ Ã— æ ‡å‡†å•ä»·ï¼‰ - é‡‡è´­çŠ¶æ€ï¼šå¾…å®¡æ ¸ã€å·²å®¡æ ¸ã€å·²å®Œæˆã€å·²å–æ¶ˆ </ç”¨æˆ·éœ€æ±‚> <æ–‡ä»¶>retail_purchase.go</æ–‡ä»¶> </metadata> */ package retail import ( \"errors\" \"fmt\" \"github.com/yunhanshu-net/function-go/pkg/dto/response\" \"github.com/yunhanshu-net/function-go/pkg/dto/usercall\" \"github.com/yunhanshu-net/function-go/runner\" \"github.com/yunhanshu-net/pkg/query\" \"gorm.io/gorm\" ) // ================ å‡½æ•°ç»„é…ç½® ================ var RetailPurchaseGroup = &runner.FunctionGroup{ CnName: \"é‡‡è´­ç®¡ç†\", EnName: \"retail_purchase\", } // ================ æ•°æ®æ¨¡å‹ï¼ˆæŒ‰ä¾èµ–å…³ç³»æ’åºï¼‰ ================ // 1. ä¾›åº”å•†ä¿¡æ¯ï¼ˆåŸºç¡€æ•°æ®ï¼Œè¢«å…¶ä»–è¡¨ä¾èµ–ï¼‰ type RetailPurchaseSupplier struct { ID int `json:\"id\" gorm:\"primaryKey;autoIncrement\" runner:\"name:ä¾›åº”å•†ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index\" runner:\"-\"` Name string `json:\"name\" gorm:\"column:name;comment:ä¾›åº”å•†åç§°\" runner:\"name:ä¾›åº”å•†åç§°\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=100\" msg:\"ä¾›åº”å•†åç§°å¿…å¡«ï¼Œé•¿åº¦2-100å­—ç¬¦\"` Contact string `json:\"contact\" gorm:\"column:contact;comment:è”ç³»äºº\" runner:\"name:è”ç³»äºº\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=50\" msg:\"è”ç³»äººå¿…å¡«ï¼Œé•¿åº¦2-50å­—ç¬¦\"` Phone string `json:\"phone\" gorm:\"column:phone;comment:è”ç³»ç”µè¯\" runner:\"name:è”ç³»ç”µè¯\" widget:\"type:input\" search:\"like\" validate:\"required,min=11,max=20\" msg:\"è”ç³»ç”µè¯å¿…å¡«ï¼Œé•¿åº¦11-20å­—ç¬¦\"` Address string `json:\"address\" gorm:\"column:address;comment:åœ°å€\" runner:\"name:åœ°å€\" widget:\"type:input;mode:text_area\" search:\"like\" validate:\"required,min=5,max=200\" msg:\"åœ°å€å¿…å¡«ï¼Œé•¿åº¦5-200å­—ç¬¦\"` } func (RetailPurchaseSupplier) TableName() string { return \"retail_purchase_supplier\" } // 2. å•†å“ä¿¡æ¯ï¼ˆä¾èµ–ä¾›åº”å•†ï¼Œè¢«é‡‡è´­è®°å½•ä¾èµ–ï¼‰ type RetailPurchaseProduct struct { ID int `json:\"id\" gorm:\"primaryKey;autoIncrement\" runner:\"name:å•†å“ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index\" runner:\"-\"` // ã€æ¡†æ¶è¯´æ˜ã€‘SupplierIDå¿…é¡»ä½¿ç”¨selectç»„ä»¶æ‰èƒ½æ”¯æŒOnInputFuzzyæ¨¡ç³Šæœç´¢åŠŸèƒ½ // åªæœ‰selectï¼ˆå•é€‰ï¼‰å’Œmultiselectï¼ˆå¤šé€‰ï¼‰ç»„ä»¶æ‰æ”¯æŒåŠ¨æ€æ•°æ®æºæ¨¡ç³Šæœç´¢ // numberç»„ä»¶ä¸æ”¯æŒæ¨¡ç³Šæœç´¢ï¼Œç”¨æˆ·æ— æ³•é€šè¿‡åç§°æœç´¢ä¾›åº”å•† SupplierID int `json:\"supplier_id\" gorm:\"column:supplier_id;comment:ä¾›åº”å•†ID\" runner:\"name:ä¾›åº”å•†\" widget:\"type:select\" search:\"in\" validate:\"required\" msg:\"è¯·é€‰æ‹©ä¾›åº”å•†\"` SupplierName string `json:\"supplier_name\" gorm:\"column:supplier_name;comment:ä¾›åº”å•†åç§°\" runner:\"name:ä¾›åº”å•†åç§°\" widget:\"type:input\" search:\"like\" validate:\"required\" msg:\"ä¾›åº”å•†åç§°å¿…å¡«\"` Name string `json:\"name\" gorm:\"column:name;comment:å•†å“åç§°\" runner:\"name:å•†å“åç§°\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=100\" msg:\"å•†å“åç§°å¿…å¡«ï¼Œé•¿åº¦2-100å­—ç¬¦\"` Category string `json:\"category\" gorm:\"column:category;comment:å•†å“åˆ†ç±»\" runner:\"name:å•†å“åˆ†ç±»\" widget:\"type:select;options:åŸææ–™,åŠæˆå“,æˆå“,åŒ…è£…ç‰©\" data:\"default_value:åŸææ–™\" search:\"in\" validate:\"required,oneof=åŸææ–™ åŠæˆå“ æˆå“ åŒ…è£…ç‰©\" msg:\"è¯·é€‰æ‹©å•†å“åˆ†ç±»\"` Spec string `json:\"spec\" gorm:\"column:spec;comment:è§„æ ¼\" runner:\"name:è§„æ ¼\" widget:\"type:input\" search:\"like\" validate:\"required,min=2,max=100\" msg:\"è§„æ ¼å¿…å¡«ï¼Œé•¿åº¦2-100å­—ç¬¦\" data:\"example:500g;100ml;A4å°ºå¯¸;Mç ;çº¢è‰²\"` Unit string `json:\"unit\" gorm:\"column:unit;comment:å•ä½\" runner:\"name:å•ä½\" widget:\"type:input\" search:\"like\" validate:\"required,min=1,max=20\" msg:\"å•ä½å¿…å¡«ï¼Œé•¿åº¦1-20å­—ç¬¦\" data:\"example:ä¸ª;ä»¶;åŒ…;ç›’;ç±³;åƒå…‹;å‡\"` UnitPrice float64 `json:\"unit_price\" gorm:\"column:unit_price;comment:æ ‡å‡†å•ä»·\" runner:\"name:æ ‡å‡†å•ä»·\" widget:\"type:number;min:0;precision:2\" search:\"gte,lte\" validate:\"required,min=0\" msg:\"æ ‡å‡†å•ä»·å¿…é¡»å¤§äº0\"` } func (RetailPurchaseProduct) TableName() string { return \"retail_purchase_product\" } // 3. é‡‡è´­å•†å“é¡¹ï¼ˆä¸šåŠ¡æ•°æ®ï¼Œä¾èµ–å•†å“ä¿¡æ¯ï¼‰ type RetailPurchaseItem struct { ProductID int `json:\"product_id\" runner:\"name:å•†å“\" widget:\"type:select\" validate:\"required\" msg:\"è¯·é€‰æ‹©å•†å“\"` Quantity int `json:\"quantity\" runner:\"name:æ•°é‡\" widget:\"type:number;min:1\" data:\"default_value:1\" validate:\"required,min=1\" msg:\"æ•°é‡å¿…é¡»å¤§äº0\"` } // 5. é‡‡è´­è¯·æ±‚ï¼ˆä¸šåŠ¡æ“ä½œï¼Œä¾èµ–ä¸Šè¿°æ‰€æœ‰æ¨¡å‹ï¼‰ type RetailPurchaseReq struct { SupplierID int `json:\"supplier_id\" runner:\"name:ä¾›åº”å•†\" widget:\"type:select\" validate:\"required\" msg:\"è¯·é€‰æ‹©ä¾›åº”å•†\"` Items []RetailPurchaseItem `json:\"items\" runner:\"name:é‡‡è´­å•†å“\" widget:\"type:list\" validate:\"required,min=1\" msg:\"è¯·è‡³å°‘é€‰æ‹©ä¸€ä»¶å•†å“\"` Remarks string `json:\"remarks\" runner:\"name:å¤‡æ³¨\" widget:\"type:input;mode:text_area\"` } // 4. é‡‡è´­è®°å½•ï¼ˆä¸šåŠ¡æ•°æ®ï¼Œä¾èµ–ä¾›åº”å•†å’Œå•†å“ï¼‰ type RetailPurchaseRecord struct { ID int `json:\"id\" gorm:\"primaryKey;autoIncrement\" runner:\"name:é‡‡è´­ID\" permission:\"read\"` CreatedAt int64 `json:\"created_at\" gorm:\"autoCreateTime:milli\" runner:\"name:åˆ›å»ºæ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` UpdatedAt int64 `json:\"updated_at\" gorm:\"autoUpdateTime:milli\" runner:\"name:æ›´æ–°æ—¶é—´\" widget:\"type:datetime;kind:datetime\" permission:\"read\"` DeletedAt gorm.DeletedAt `json:\"deleted_at\" gorm:\"index\" runner:\"-\"` // ã€æ¡†æ¶è¯´æ˜ã€‘SupplierIDåœ¨è®°å½•è¡¨ä¸­ä½¿ç”¨numberç»„ä»¶ï¼Œå› ä¸ºè¿™æ˜¯å†å²æ•°æ®å±•ç¤ºï¼Œä¸éœ€è¦è”æƒ³åŠŸèƒ½ // è”æƒ³åŠŸèƒ½åªåœ¨æ–°å¢/ç¼–è¾‘æ—¶ä½¿ç”¨ï¼Œè®°å½•è¡¨ä¸»è¦ç”¨äºæŸ¥è¯¢å’Œå±•ç¤º // ã€æ¡†æ¶è¯´æ˜ã€‘SupplierIDåœ¨è®°å½•è¡¨ä¸­ä½¿ç”¨selectç»„ä»¶ï¼Œæ”¯æŒè”æƒ³åŠŸèƒ½ // æ–°å¢å’Œç¼–è¾‘æ—¶å¯ä»¥é€‰æ‹©ä¾›åº”å•†ï¼Œåˆ—è¡¨å±•ç¤ºæ—¶éšè—IDå­—æ®µ SupplierID int `json:\"supplier_id\" gorm:\"column:supplier_id;comment:ä¾›åº”å•†ID\" runner:\"name:ä¾›åº”å•†\" widget:\"type:select\" search:\"in\" validate:\"required\" msg:\"è¯·é€‰æ‹©ä¾›åº”å•†\" permission:\"create,update\"` // ã€æ¡†æ¶è¯´æ˜ã€‘SupplierNameåœ¨åˆ—è¡¨å±•ç¤ºæ—¶è‡ªåŠ¨å¡«å……ï¼Œå±äºjoinå…¶ä»–è¡¨çš„å­—æ®µäº†ï¼Œå› æ­¤è¿™ä¸ªå­—æ®µä¸èƒ½åŠ searchæ ‡ç­¾ï¼Œæ³¨æ„ï¼Œæ³¨æ„ï¼Œæ³¨æ„ï¼šgorm:\"-\"çš„å­—æ®µä¸èƒ½åŠ searchæ ‡ç­¾ // æ‰€ä»¥æ­¤æ—¶å¦‚æœéœ€è¦æ”¯æŒéè¡¨å†…å­—æ®µçš„æœç´¢ï¼Œéœ€è¦åœ¨è¯·æ±‚å‚æ•°å†…æ·»åŠ è¿™ä¸ªå­—æ®µï¼Œå‚è€ƒï¼šRetailPurchaseRecordListReqï¼Œåœ¨é‡Œé¢æ‰©å±•å­—æ®µ // permission:\"read\"è¡¨ç¤ºä»…åœ¨åˆ—è¡¨æ˜¾ç¤ºï¼Œæ–°å¢å’Œç¼–è¾‘æ—¶ä¸æ˜¾ç¤º SupplierName string `json:\"supplier_name\" gorm:\"-\" runner:\"name:ä¾›åº”å•†åç§°\" widget:\"type:input\" search:\"like\" validate:\"required\" msg:\"ä¾›åº”å•†åç§°å¿…å¡«\" permission:\"read\"` TotalAmount float64 `json:\"total_amount\" gorm:\"column:total_amount;comment:æ€»é‡‘é¢\" runner:\"name:æ€»é‡‘é¢\" widget:\"type:number;precision:2\" search:\"gte,lte\" validate:\"required,min=0\" msg:\"æ€»é‡‘é¢å¿…é¡»å¤§äº0\"` TotalItems int `json:\"total_items\" gorm:\"column:total_items;comment:å•†å“ç§ç±»\" runner:\"name:å•†å“ç§ç±»\" widget:\"type:number\" search:\"gte,lte\" validate:\"required,min=1\" msg:\"å•†å“ç§ç±»å¿…é¡»å¤§äº0\"` Status string `json:\"status\" gorm:\"column:status;comment:çŠ¶æ€\" runner:\"name:çŠ¶æ€\" widget:\"type:select;options:å¾…å®¡æ ¸,å·²å®¡æ ¸,å·²å®Œæˆ,å·²å–æ¶ˆ\" data:\"default_value:å¾…å®¡æ ¸\" search:\"in\" validate:\"required,oneof=å¾…å®¡æ ¸ å·²å®¡æ ¸ å·²å®Œæˆ å·²å–æ¶ˆ\" msg:\"è¯·é€‰æ‹©é‡‡è´­çŠ¶æ€\"` Remarks string `json:\"remarks\" gorm:\"column:remarks;comment:å¤‡æ³¨\" runner:\"name:å¤‡æ³¨\" widget:\"type:input;mode:text_area\" search:\"like\"` Supplier RetailPurchaseSupplier `json:\"-\" runner:\"-\" gorm:\"foreignKey:SupplierID\"` // ã€éšè—ã€‘å…³è”å…³ç³»ï¼Œä»…ç”¨äºgormé¢„åŠ è½½ } func (RetailPurchaseRecord) TableName() string { return \"retail_purchase_record\" } // 6. é‡‡è´­å“åº”ï¼ˆä¸šåŠ¡ç»“æœï¼‰ type RetailPurchaseResp struct { PurchaseID int `json:\"purchase_id\" runner:\"name:é‡‡è´­ID\" widget:\"type:number\"` TotalAmount float64 `json:\"total_amount\" runner:\"name:æ€»é‡‘é¢\" widget:\"type:number;precision:2\"` TotalItems int `json:\"total_items\" runner:\"name:å•†å“ç§ç±»\" widget:\"type:number\"` Message string `json:\"message\" runner:\"name:å¤„ç†ç»“æœ\" widget:\"type:input;mode:text_area\"` } // ================ ä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼ˆæŒ‰è°ƒç”¨é¡ºåºæ’åºï¼‰ ================ // 1. è¾…åŠ©å‡½æ•°ï¼šéªŒè¯å•†å“å¹¶è®¡ç®—æ€»é‡‘é¢ func retailPurchaseValidateAndCalculate(db *gorm.DB, supplierID int, items []RetailPurchaseItem) (float64, int, error) { if len(items) == 0 { return 0, 0, fmt.Errorf(\"é‡‡è´­å•†å“ä¸èƒ½ä¸ºç©º\") } var totalAmount float64 productIDs := make([]int, 0, len(items)) for _, item := range items { if item.Quantity <= 0 { return 0, 0, fmt.Errorf(\"å•†å“æ•°é‡å¿…é¡»å¤§äº0\") } productIDs = append(productIDs, item.ProductID) } // éªŒè¯å•†å“æ˜¯å¦å­˜åœ¨ä¸”å±äºæŒ‡å®šä¾›åº”å•† var products []RetailPurchaseProduct if err := db.Where(\"id IN ? AND supplier_id = ?\", productIDs, supplierID).Find(&products).Error; err != nil { return 0, 0, fmt.Errorf(\"éªŒè¯å•†å“å¤±è´¥: %v\", err) } if len(products) != len(productIDs) { return 0, 0, fmt.Errorf(\"éƒ¨åˆ†å•†å“ä¸å­˜åœ¨æˆ–ä¸å±äºè¯¥ä¾›åº”å•†\") } // è®¡ç®—æ€»é‡‘é¢ï¼ˆæ•°é‡ Ã— æ ‡å‡†å•ä»·ï¼‰ for _, item := range items { for _, product := range products { if product.ID == item.ProductID { totalAmount += float64(item.Quantity) * product.UnitPrice break } } } return totalAmount, len(productIDs), nil } // 2. ä¸»è¦ä¸šåŠ¡å‡½æ•°ï¼šåˆ›å»ºé‡‡è´­ç”³è¯· func RetailPurchaseCreate(ctx *runner.Context, req *RetailPurchaseReq, resp response.Response) error { db := ctx.MustGetOrInitDB() // 1. éªŒè¯ä¾›åº”å•† var supplier RetailPurchaseSupplier if err := db.Where(\"id = ?\", req.SupplierID).First(&supplier).Error; err != nil { if errors.Is(err, gorm.ErrRecordNotFound) { return resp.Form(&RetailPurchaseResp{ Message: \"ä¾›åº”å•†ä¸å­˜åœ¨\", }).Build() } return resp.Form(&RetailPurchaseResp{ Message: fmt.Sprintf(\"æŸ¥è¯¢ä¾›åº”å•†å¤±è´¥: %v\", err), }).Build() } // 2. éªŒè¯å•†å“å¹¶è®¡ç®— totalAmount, totalItems, err := retailPurchaseValidateAndCalculate(db, req.SupplierID, req.Items) if err != nil { return resp.Form(&RetailPurchaseResp{ Message: fmt.Sprintf(\"å•†å“éªŒè¯å¤±è´¥: %v\", err), }).Build() } // 3. åˆ›å»ºé‡‡è´­è®°å½• purchaseRecord := &RetailPurchaseRecord{ SupplierID: req.SupplierID, SupplierName: supplier.Name, TotalAmount: totalAmount, TotalItems: totalItems, Status: \"å¾…å®¡æ ¸\", Remarks: req.Remarks, } if err := db.Create(purchaseRecord).Error; err != nil { ctx.Logger.Errorf(\"åˆ›å»ºé‡‡è´­è®°å½•å¤±è´¥: %v\", err) return resp.Form(&RetailPurchaseResp{ Message: \"åˆ›å»ºé‡‡è´­è®°å½•å¤±è´¥ï¼Œè¯·é‡è¯•\", }).Build() } return resp.Form(&RetailPurchaseResp{ PurchaseID: purchaseRecord.ID, TotalAmount: totalAmount, TotalItems: totalItems, Message: \"é‡‡è´­ç”³è¯·åˆ›å»ºæˆåŠŸ\", }).Build() } // ================ Tableå‡½æ•°ï¼ˆæŒ‰æ•°æ®ä¾èµ–å…³ç³»æ’åºï¼‰ ================ // 1. ä¾›åº”å•†åˆ—è¡¨ç®¡ç†ï¼ˆåŸºç¡€æ•°æ®ç®¡ç†ï¼‰ func RetailPurchaseSupplierList(ctx *runner.Context, req *query.PageInfoReq, resp response.Response) error { db := ctx.MustGetOrInitDB() var rows []RetailPurchaseSupplier return resp.Table(&rows).AutoPaginated(db, &RetailPurchaseSupplier{}, req).Build() } // 2. å•†å“åˆ—è¡¨ç®¡ç†ï¼ˆä¾èµ–ä¾›åº”å•†æ•°æ®ï¼‰ func RetailPurchaseProductList(ctx *runner.Context, req *query.PageInfoReq, resp response.Response) error { db := ctx.MustGetOrInitDB() var rows []RetailPurchaseProduct return resp.Table(&rows).AutoPaginated(db, &RetailPurchaseProduct{}, req).Build() } // 3. é‡‡è´­è®°å½•åˆ—è¡¨ç®¡ç†ï¼ˆä¾èµ–ä¾›åº”å•†å’Œå•†å“æ•°æ®ï¼‰ type RetailPurchaseRecordListReq struct { query.PageInfoReq `runner:\"-\"` // ã€æ¡†æ¶è¯´æ˜ã€‘joinå­—æ®µæœç´¢å‚æ•° // query.PageInfoReq é»˜è®¤åªæ”¯æŒå½“å‰è¡¨å­—æ®µçš„æœç´¢ï¼ˆå¦‚ TotalAmountã€TotalItemsã€Statusï¼‰ // ä½†æ— æ³•å¤„ç†å…³è”è¡¨çš„å­—æ®µæœç´¢ï¼ˆå¦‚ä¾›åº”å•†åç§°ï¼‰ï¼Œéœ€è¦æ‰‹åŠ¨å®ç°å…³è”æŸ¥è¯¢ SupplierName string `json:\"supplier_name\" runner:\"name:ä¾›åº”å•†åç§°\" widget:\"type:input\" search:\"like\"` // æŒ‰ä¾›åº”å•†åç§°æ¨¡ç³Šæœç´¢ } func RetailPurchaseRecordList(ctx *runner.Context, req *RetailPurchaseRecordListReq, resp response.Response) error { db := ctx.MustGetOrInitDB() var rows []*RetailPurchaseRecord // ã€æ¡†æ¶è¯´æ˜ã€‘æ‰‹åŠ¨å®ç°joinå­—æ®µçš„æœç´¢é€»è¾‘ // å› ä¸ºæ¡†æ¶çš„ AutoPaginated æ— æ³•è‡ªåŠ¨å¤„ç†å…³è”è¡¨å­—æ®µçš„æœç´¢ // éœ€è¦æ‰‹åŠ¨æ„å»ºæŸ¥è¯¢æ¡ä»¶ï¼Œå®ç°ç±»ä¼¼ JOIN çš„æ•ˆæœ query := db.Model(&RetailPurchaseRecord{}) // æŒ‰ä¾›åº”å•†åç§°æ¨¡ç³Šæœç´¢ï¼ˆéœ€è¦å…³è”æŸ¥è¯¢ï¼‰ if req.SupplierName != \"\" { // å…ˆæŸ¥è¯¢åŒ¹é…çš„ä¾›åº”å•†ID var supplierIDs []int if err := db.Model(&RetailPurchaseSupplier{}). Where(\"name LIKE ?\", \"%\"+req.SupplierName+\"%\"). Pluck(\"id\", &supplierIDs).Error; err == nil && len(supplierIDs) > 0 { query = query.Where(\"supplier_id IN ?\", supplierIDs) } else { // å¦‚æœæ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ä¾›åº”å•†ï¼Œè¿”å›ç©ºç»“æœ return resp.Table(nil).Build() } } // ã€ä¼˜åŒ–ã€‘é¢„åŠ è½½ä¾›åº”å•†ä¿¡æ¯ï¼Œé¿å…N+1æŸ¥è¯¢é—®é¢˜ query = query.Preload(\"Supplier\") // è·å–åˆ†é¡µæ•°æ®ï¼ˆåº”ç”¨æ‰‹åŠ¨æ„å»ºçš„æŸ¥è¯¢æ¡ä»¶ï¼‰ td := resp.Table(&rows).AutoPaginated(query, &RetailPurchaseRecord{}, &req.PageInfoReq) // ã€æ¡†æ¶è¯´æ˜ã€‘å¡«å……joinå­—æ®µï¼Œæå‡ç”¨æˆ·ä½“éªŒ // åœ¨åˆ—è¡¨å±•ç¤ºæ—¶è‡ªåŠ¨å¡«å……ä¾›åº”å•†åç§°ï¼Œé¿å…æ˜¾ç¤ºæ— æ„ä¹‰çš„ID for _, row := range rows { row.SupplierName = row.Supplier.Name } return td.Build() } // ================ å‡½æ•°é…ç½®ï¼ˆæŒ‰åŠŸèƒ½å±‚æ¬¡æ’åºï¼‰ ================ // 1. ä¾›åº”å•†åˆ—è¡¨é…ç½®ï¼ˆåŸºç¡€æ•°æ®ç®¡ç†ï¼‰ var RetailPurchaseSupplierListOption = &runner.TableFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"é‡‡è´­ä¾›åº”å•†ç®¡ç†\", ApiDesc: \"ä¾›åº”å•†åŸºç¡€ä¿¡æ¯ç®¡ç†ï¼Œæ”¯æŒå¢åˆ æ”¹æŸ¥å’Œæœç´¢\", Tags: []string{\"é‡‡è´­ç®¡ç†\", \"ä¾›åº”å•†ç®¡ç†\"}, Request: &query.PageInfoReq{}, Response: query.PaginatedTable[[]RetailPurchaseSupplier]{}, CreateTables: []interface{}{&RetailPurchaseSupplier{}}, Group: RetailPurchaseGroup, }, AutoCrudTable: &RetailPurchaseSupplier{}, // ã€æ¡†æ¶è¯´æ˜ã€‘OnTableAddRows åœ¨æ–°å¢ä¾›åº”å•†åè§¦å‘ï¼Œç”¨äºé¢å¤–çš„ä¸šåŠ¡é€»è¾‘å¤„ç† // è§¦å‘æ—¶æœºï¼šç”¨æˆ·æ–°å¢ä¾›åº”å•†æˆåŠŸå ä½¿ç”¨åœºæ™¯ï¼šè®°å½•æ—¥å¿—ã€å‘é€é€šçŸ¥ã€æ›´æ–°ç¼“å­˜ç­‰ // âš ï¸ é‡è¦ï¼šæœ‰æ­¤å›è°ƒæ—¶æ¡†æ¶ä¸ä¼šè‡ªåŠ¨å†™å…¥æ•°æ®ï¼Œå¿…é¡»åœ¨å›è°ƒä¸­æ‰‹åŠ¨æ‰§è¡Œ db.Create() OnTableAddRows: func(ctx *runner.Context, req *usercall.OnTableAddRowsReq) (*usercall.OnTableAddRowsResp, error) { // ã€ä¸šåŠ¡åœºæ™¯ã€‘æ–°å¢ä¾›åº”å•†åï¼Œè®°å½•æ“ä½œæ—¥å¿— // è¿™é‡Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨åŸºç¡€CRUDä¹‹å¤–æ·»åŠ é¢å¤–çš„ä¸šåŠ¡æ“ä½œ // è§£ææ–°å¢çš„ä¾›åº”å•†æ•°æ® var suppliers []RetailPurchaseSupplier if err := req.DecodeBy(&suppliers); err != nil { return nil, fmt.Errorf(\"è§£æä¾›åº”å•†æ•°æ®å¤±è´¥: %v\", err) } //ç„¶åå¯ä»¥åœ¨å†™å…¥å‰ååšä»»ä½•æ“ä½œï¼Œä½†æ˜¯ä¸è¦å¤ªå¤æ‚ï¼Œè¦ä¸ç„¶ä¼šå½±å“ç”¨æˆ·ä½“éªŒ // ã€å…³é”®æ­¥éª¤ã€‘æ‰‹åŠ¨æ‰§è¡Œæ•°æ®åº“å†™å…¥æ“ä½œï¼ˆç”¨äº†OnTableAddRowsæ¡†æ¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œå†™å…¥ï¼‰ db := ctx.MustGetOrInitDB() err := db.Create(&suppliers).Error if err != nil { return nil, err } return &usercall.OnTableAddRowsResp{}, nil }, // ã€æ¡†æ¶è¯´æ˜ã€‘OnTableUpdateRows åœ¨æ›´æ–°ä¾›åº”å•†åè§¦å‘ï¼Œç”¨äºé¢å¤–çš„ä¸šåŠ¡é€»è¾‘å¤„ç† // è§¦å‘æ—¶æœºï¼šç”¨æˆ·æ›´æ–°ä¾›åº”å•†æˆåŠŸå ä½¿ç”¨åœºæ™¯ï¼šæ•°æ®åŒæ­¥ã€çŠ¶æ€æ£€æŸ¥ã€å…³è”æ›´æ–°ç­‰ // âš ï¸ é‡è¦ï¼šæœ‰æ­¤å›è°ƒæ—¶æ¡†æ¶ä¸ä¼šè‡ªåŠ¨æ›´æ–°æ•°æ®ï¼Œå¿…é¡»åœ¨å›è°ƒä¸­æ‰‹åŠ¨æ‰§è¡Œ db.Model().Updates() OnTableUpdateRows: func(ctx *runner.Context, req *usercall.OnTableUpdateRowsReq) (*usercall.OnTableUpdateRowsResp, error) { // ã€ä¸šåŠ¡åœºæ™¯ã€‘æ›´æ–°ä¾›åº”å•†åï¼Œè®°å½•å˜æ›´å†å² // è¿™é‡Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨æ•°æ®æ›´æ–°åå¤„ç†å…³è”ä¸šåŠ¡é€»è¾‘ // ã€å…³é”®æ­¥éª¤ã€‘æ‰‹åŠ¨æ‰§è¡Œæ•°æ®åº“æ›´æ–°æ“ä½œï¼ˆæ¡†æ¶ä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼‰ db := ctx.MustGetOrInitDB() var updateValue RetailPurchaseSupplier err := req.DecodeBy(&updateValue) //ã€æ¡†æ¶è§„èŒƒã€‘æ³¨æ„è¿™é‡Œåªä¼šè·å–åˆ°æ›´æ–°çš„å­—æ®µçš„å€¼ï¼Œä¾‹å¦‚æ›´æ–°phoneçš„è¯updateValueçš„Phoneå­—æ®µä¼šè¢«èµ‹å€¼ if err != nil { return nil, err } //GetStringï¼ŒGetIntï¼ŒGetBoolï¼ŒGetFloat64ï¼ŒGetFiles è¿™å‡ ä¸ªæ–¹æ³•ï¼Œå¯ä»¥å®‰å…¨çš„è·å–æ›´æ–°å­—æ®µçš„å€¼ï¼Œä¸‹é¢å‡ ä¸ªåªæ˜¯æ¼”ç¤ºä¸€ä¸‹ç”¨æ³•ï¼Œæ­£å¸¸æƒ…å†µä¸‹å­—æ®µæ ¡éªŒçš„é€»è¾‘ä¼šè¢«æ¡†æ¶å’Œå‰ç«¯å¤„ç†ï¼Œ //name, exist, err := req.GetString(\"name\") //if err != nil { // return nil, err //} //if exist { // if name == \"\" { // return nil, fmt.Errorf(\"åç§°ä¸èƒ½ä¸ºç©º\") // } //} //phone, exist, err := req.GetInt(\"phone\") //if err != nil { // return nil, err //} //fmt.Println(phone) //GetFieldsMap() è¿”å› map[string]interface æ˜¯éœ€è¦æ›´æ–°çš„å­—æ®µå’Œæ›´æ–°çš„å€¼ //fieldsMap := req.GetFieldsMap() err = db.Where(\"id in ?\", req.Ids).Updates(updateValue).Error if err != nil { return nil, err } return &usercall.OnTableUpdateRowsResp{}, nil }, // ã€æ¡†æ¶è¯´æ˜ã€‘OnTableDeleteRows åœ¨åˆ é™¤ä¾›åº”å•†å‰è§¦å‘ï¼Œç”¨äºä¸šåŠ¡è§„åˆ™éªŒè¯ // è§¦å‘æ—¶æœºï¼šç”¨æˆ·åˆ é™¤ä¾›åº”å•†å‰ ä½¿ç”¨åœºæ™¯ï¼šå…³è”æ£€æŸ¥ã€é˜²æ­¢è¯¯åˆ  // âš ï¸ é‡è¦ï¼šæœ‰æ­¤å›è°ƒæ—¶æ¡†æ¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤æ•°æ®ï¼Œå¿…é¡»åœ¨å›è°ƒä¸­æ‰‹åŠ¨æ‰§è¡Œ db.Delete() OnTableDeleteRows: func(ctx *runner.Context, req *usercall.OnTableDeleteRowsReq) (*usercall.OnTableDeleteRowsResp, error) { // ã€ä¸šåŠ¡åœºæ™¯ã€‘åˆ é™¤ä¾›åº”å•†å‰ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰å…³è”å•†å“ï¼Œé˜²æ­¢è¯¯åˆ  db := ctx.MustGetOrInitDB() // æ£€æŸ¥æ˜¯å¦æœ‰å…³è”å•†å“ for _, id := range req.Ids { var count int64 if err := db.Model(&RetailPurchaseProduct{}).Where(\"supplier_id = ?\", id).Count(&count).Error; err != nil { return nil, fmt.Errorf(\"æ£€æŸ¥ä¾›åº”å•†å…³è”å•†å“å¤±è´¥: %v\", err) } if count > 0 { var supplier RetailPurchaseSupplier if err := db.Where(\"id = ?\", id).First(&supplier).Error; err != nil { return nil, fmt.Errorf(\"æŸ¥è¯¢ä¾›åº”å•†ä¿¡æ¯å¤±è´¥: %v\", err) } return nil, fmt.Errorf(\"ä¾›åº”å•† %s ä¸‹è¿˜æœ‰ %d ä¸ªå•†å“ï¼Œæ— æ³•åˆ é™¤ï¼Œè¯·å…ˆæŠŠç›¸å…³å•†å“åˆ é™¤\", supplier.Name, count) } } // æ‰‹åŠ¨æ‰§è¡Œåˆ é™¤æ“ä½œ if err := db.Where(\"id IN ?\", req.Ids).Delete(&RetailPurchaseSupplier{}).Error; err != nil { return nil, fmt.Errorf(\"åˆ é™¤ä¾›åº”å•†è®°å½•å¤±è´¥: %v\", err) } return &usercall.OnTableDeleteRowsResp{}, nil }, } // 2. å•†å“åˆ—è¡¨é…ç½®ï¼ˆä¾èµ–ä¾›åº”å•†æ•°æ®ï¼‰ var RetailPurchaseProductListOption = &runner.TableFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"é‡‡è´­å•†å“ç®¡ç†\", ApiDesc: \"å•†å“åŸºç¡€ä¿¡æ¯ç®¡ç†ï¼Œæ”¯æŒå¢åˆ æ”¹æŸ¥å’Œæœç´¢\", Tags: []string{\"é‡‡è´­ç®¡ç†\", \"å•†å“ç®¡ç†\"}, Request: &query.PageInfoReq{}, Response: query.PaginatedTable[[]RetailPurchaseProduct]{}, CreateTables: []interface{}{&RetailPurchaseProduct{}}, Group: RetailPurchaseGroup, }, AutoCrudTable: &RetailPurchaseProduct{}, // ã€æ¡†æ¶è¯´æ˜ã€‘OnInputFuzzyMap ä¸ºè¡¨æ ¼å­—æ®µæä¾›æ¨¡ç³Šæœç´¢æ•°æ® // è§¦å‘æ—¶æœºï¼šç”¨æˆ·è¾“å…¥æ—¶ æ•°æ®å»å‘ï¼šæŒ‚è½½åˆ°å¯¹åº”çš„è¡¨æ ¼å­—æ®µ OnInputFuzzyMap: map[string]runner.OnInputFuzzy{ \"supplier_id\": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) { // ã€å½“å‰åœºæ™¯ã€‘supplier_idæ˜¯å•é€‰å­—æ®µï¼Œåªè¿”å›é™æ€ä¿¡æ¯ï¼Œä¸åšèšåˆè®¡ç®— // ã€ç›®æ ‡å­—æ®µã€‘ä¸º RetailPurchaseProduct.SupplierID æä¾›ä¾›åº”å•†é€‰æ‹©æ•°æ® keyword := fmt.Sprintf(\"%v\", req.Value) var suppliers []RetailPurchaseSupplier db := ctx.MustGetOrInitDB() db.Where(\"name LIKE ? OR contact LIKE ? OR phone LIKE ?\", \"%\"+keyword+\"%\", \"%\"+keyword+\"%\", \"%\"+keyword+\"%\"). Limit(20). Find(&suppliers) items := make([]*usercall.InputFuzzyItem, 0) for _, s := range suppliers { items = append(items, &usercall.InputFuzzyItem{ Value: s.ID, Label: s.Name, DisplayInfo: map[string]interface{}{ \"ä¾›åº”å•†åç§°\": s.Name, \"è”ç³»äºº\": s.Contact, \"è”ç³»ç”µè¯\": s.Phone, \"åœ°å€\": s.Address, }, }) } return &usercall.OnInputFuzzyResp{ Statistics: map[string]interface{}{ \"ä¾›åº”å•†åç§°\": \"text(ä¾›åº”å•†åç§°)\", //å‰ç«¯åŠ¨æ€å±•ç¤ºé€‰ä¸­çš„é‚£ä¸ªä¾›åº”å•†åç§° \"è”ç³»äºº\": \"text(è”ç³»äºº)\", //å‰ç«¯åŠ¨æ€å±•ç¤ºé€‰ä¸­çš„é‚£ä¸ªä¾›åº”å•†è”ç³»äºº \"è”ç³»ç”µè¯\": \"text(è”ç³»ç”µè¯)\", //å‰ç«¯åŠ¨æ€å±•ç¤ºé€‰ä¸­çš„é‚£ä¸ªä¾›åº”å•†è”ç³»ç”µè¯ \"åœ°å€\": \"text(åœ°å€)\", //å‰ç«¯åŠ¨æ€å±•ç¤ºé€‰ä¸­çš„é‚£ä¸ªä¾›åº”å•†åœ°å€ }, Values: items, }, nil }, }, } // 3. é‡‡è´­è®°å½•åˆ—è¡¨é…ç½®ï¼ˆä¾èµ–ä¾›åº”å•†å’Œå•†å“æ•°æ®ï¼‰ var RetailPurchaseRecordListOption = &runner.TableFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"é‡‡è´­è®°å½•ç®¡ç†\", ApiDesc: \"é‡‡è´­è®°å½•ç®¡ç†ï¼Œæ”¯æŒçŠ¶æ€è·Ÿè¸ªã€ä¾›åº”å•†ç­›é€‰å’Œç»Ÿè®¡åˆ†æ\", Tags: []string{\"é‡‡è´­ç®¡ç†\", \"è®°å½•ç®¡ç†\"}, Request: &RetailPurchaseRecordListReq{}, Response: query.PaginatedTable[[]RetailPurchaseRecord]{}, CreateTables: []interface{}{&RetailPurchaseRecord{}}, Group: RetailPurchaseGroup, }, AutoCrudTable: &RetailPurchaseRecord{}, // ã€æ¡†æ¶è¯´æ˜ã€‘å¤ç”¨é‡‡è´­åˆ›å»ºçš„OnInputFuzzyé…ç½®ï¼Œé¿å…é‡å¤é€ è½®å­ // ä¾›åº”å•†è”æƒ³åŠŸèƒ½åœ¨æ–°å¢å’Œç¼–è¾‘æ—¶éƒ½éœ€è¦ï¼Œç›´æ¥å¤ç”¨å·²æœ‰é…ç½® OnInputFuzzyMap: RetailPurchaseCreateOption.OnInputFuzzyMap, } // 4. é‡‡è´­åˆ›å»ºé…ç½®ï¼ˆæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼‰ var RetailPurchaseCreateOption = &runner.FormFunctionOptions{ BaseConfig: runner.BaseConfig{ ChineseName: \"é‡‡è´­ç”³è¯·åˆ›å»º\", ApiDesc: \"åˆ›å»ºé‡‡è´­ç”³è¯·ï¼Œæ”¯æŒå¤šå•†å“é€‰æ‹©å’Œå®æ—¶ç»Ÿè®¡\", Tags: []string{\"é‡‡è´­ç®¡ç†\", \"ç”³è¯·åˆ›å»º\"}, Request: &RetailPurchaseReq{}, Response: &RetailPurchaseResp{}, CreateTables: []interface{}{&RetailPurchaseRecord{}}, Group: RetailPurchaseGroup, }, // ã€æ¡†æ¶è¯´æ˜ã€‘OnInputFuzzyMap ä¸ºè¯·æ±‚ç»“æ„ä½“å­—æ®µæä¾›æ¨¡ç³Šæœç´¢æ•°æ® // è§¦å‘æ—¶æœºï¼šç”¨æˆ·è¾“å…¥æ—¶ æ•°æ®å»å‘ï¼šæŒ‚è½½åˆ°å¯¹åº”çš„è¯·æ±‚å­—æ®µ OnInputFuzzyMap: map[string]runner.OnInputFuzzy{ \"supplier_id\": RetailPurchaseProductListOption.OnInputFuzzyMap[\"supplier_id\"], //è¿™é‡Œä¸ºäº†é˜²æ­¢é‡å¤é€ è½®å­ï¼Œå¯ä»¥ç›´æ¥å¤ç”¨åŒä¸€ä¸ªæ–¹æ³• \"product_id\": func(ctx *runner.Context, req *usercall.OnInputFuzzyReq) (*usercall.OnInputFuzzyResp, error) { // ã€å½“å‰åœºæ™¯ã€‘product_idæ˜¯listå†…å•é€‰å­—æ®µï¼Œæ”¯æŒèšåˆç»Ÿè®¡è®¡ç®— // ã€ç›®æ ‡å­—æ®µã€‘ä¸º RetailPurchaseItem.ProductID æä¾›å•†å“é€‰æ‹©æ•°æ® // æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æ ¹æ®å·²é€‰æ‹©çš„ä¾›åº”å•†æ¥è¿‡æ»¤å•†å“ // ã€æ¡†æ¶è¯´æ˜ã€‘é€šè¿‡req.DecodeByè·å–è¡¨å•ä¸Šä¸‹æ–‡ä¸­çš„supplier_id // è¿™æ ·å¯ä»¥ç¡®ä¿å•†å“é€‰æ‹©ä¸ä¾›åº”å•†é€‰æ‹©ä¿æŒä¸€è‡´æ€§ var currentInputData RetailPurchaseReq if err := req.DecodeBy(&currentInputData); err != nil { return nil, fmt.Errorf(\"è¡¨å•è§£æå¤±è´¥ï¼Œè¯·åˆ·æ–°é€‰æ‹©ä¾›åº”å•†åå†é‡è¯•\") } if currentInputData.SupplierID == 0 { return nil, fmt.Errorf(\"è¯·å…ˆé€‰æ‹©ä¾›åº”å•†ï¼Œå†é€‰æ‹©å•†å“\") } keyword := fmt.Sprintf(\"%v\", req.Value) var products []RetailPurchaseProduct db := ctx.MustGetOrInitDB() // æ ¹æ®ä¾›åº”å•†IDè¿‡æ»¤å•†å“ï¼Œç¡®ä¿åªèƒ½é€‰æ‹©è¯¥ä¾›åº”å•†çš„å•†å“ db.Where(\"supplier_id = ?\", currentInputData.SupplierID). Where(\"name LIKE ? OR spec LIKE ? OR category LIKE ?\", \"%\"+keyword+\"%\", \"%\"+keyword+\"%\", \"%\"+keyword+\"%\"). Limit(20). Find(&products) items := make([]*usercall.InputFuzzyItem, 0) for _, p := range products { items = append(items, &usercall.InputFuzzyItem{ Value: p.ID, Label: fmt.Sprintf(\"%s - %s (Â¥%.2f/%s)\", p.Name, p.Spec, p.UnitPrice, p.Unit), DisplayInfo: map[string]interface{}{ \"å•†å“åç§°\": p.Name, \"è§„æ ¼\": p.Spec, \"åˆ†ç±»\": p.Category, \"å•ä½\": p.Unit, \"æ ‡å‡†å•ä»·\": p.UnitPrice, }, }) } return &usercall.OnInputFuzzyResp{ Statistics: map[string]interface{}{ // âœ… å‰ç«¯å®æ—¶èšåˆè®¡ç®— - ç”¨æˆ·æ¯æ·»åŠ ä¸€è¡Œå•†å“ï¼Œå‰ç«¯ç«‹å³è®¡ç®— \"é‡‡è´­æ€»é‡‘é¢\": \"sum(æ ‡å‡†å•ä»·,*quantity)\", // ç”¨æˆ·é€‰æ‹©çš„æ‰€æœ‰å•†å“æ€»ä»· \"ä¹æŠ˜é‡‘é¢\": \"sum(æ ‡å‡†å•ä»·,*0.9)\", // ç”¨æˆ·é€‰æ‹©çš„æ‰€æœ‰å•†å“æ€»ä»·*0.9 \"å•†å“ç§ç±»æ•°\": \"count(æ ‡å‡†å•ä»·)\", // é€‰äº†å‡ ç§å•†å“ \"é‡‡è´­æ€»æ•°é‡\": \"sum(quantity)\", // å•†å“æ€»æ•°é‡ \"å¹³å‡å•ä»·\": \"avg(æ ‡å‡†å•ä»·)\", // é€‰ä¸­å•†å“å¹³å‡ä»·æ ¼ // âœ… æœ‰ç”¨çš„é™æ€ä¿¡æ¯ \"é‡‡è´­è¯´æ˜\": \"æ‰¹é‡é‡‡è´­äº«ä¼˜æƒ \", \"ä»˜æ¬¾æ–¹å¼\": \"æœˆç»“30å¤©\", }, Values: items, }, nil }, }, } // ================ APIæ³¨å†Œï¼ˆæŒ‰åŠŸèƒ½å±‚æ¬¡æ’åºï¼‰ ================ func init() { // 1. Tableå‡½æ•° - åŸºç¡€æ•°æ®ç®¡ç†ï¼ˆæŒ‰ä¾èµ–å…³ç³»æ’åºï¼‰ //RouterGroup å˜é‡å¯ä»¥ç›´æ¥ç”¨ï¼Œå½“å‰packageä¸‹å·²ç»åˆ›å»ºå¥½è¯¥å˜é‡äº† runner.Get(RouterGroup+\"/retail_purchase_supplier_list\", RetailPurchaseSupplierList, RetailPurchaseSupplierListOption) runner.Get(RouterGroup+\"/retail_purchase_product_list\", RetailPurchaseProductList, RetailPurchaseProductListOption) runner.Get(RouterGroup+\"/retail_purchase_record_list\", RetailPurchaseRecordList, RetailPurchaseRecordListOption) // 2. Formå‡½æ•° - ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼ˆä¾èµ–åŸºç¡€æ•°æ®ï¼‰ runner.Post(RouterGroup+\"/retail_purchase_create\", RetailPurchaseCreate, RetailPurchaseCreateOption) } //<æ€»ç»“> //é‡‡è´­ç®¡ç†ç³»ç»Ÿï¼šä¾›åº”å•†ç®¡ç†ã€å•†å“ç®¡ç†ã€é‡‡è´­è®°å½•ç®¡ç† //æŠ€æœ¯æ ˆï¼šAutoCrudTableè‡ªåŠ¨ç”ŸæˆCRUDç•Œé¢ã€OnInputFuzzyæ¨¡ç³Šæœç´¢ã€Statisticså‰ç«¯é€‰ä¸­å®æ—¶èšåˆè®¡ç®—ã€OnTableè¡¨æ ¼å›è°ƒæœºåˆ¶ã€GORMé¢„åŠ è½½ä¼˜åŒ– //å¤æ‚åº¦ï¼šS2çº§åˆ«ï¼ŒåŒ…å«å›è°ƒæœºåˆ¶å’Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ— å¤æ‚ä¾èµ–å…³ç³» //ä¸šåŠ¡é€»è¾‘ï¼šå•†å“å±äºä¾›åº”å•†ï¼Œé‡‡è´­æ—¶æ”¯æŒå¤šå•†å“é€‰æ‹©ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—æ€»ä»·å’Œç»Ÿè®¡ä¿¡æ¯ //æ€§èƒ½ä¼˜åŒ–ï¼šGORMé¢„åŠ è½½é¿å…N+1æŸ¥è¯¢ï¼ŒJOINæŸ¥è¯¢ä¼˜åŒ–å…³è”æœç´¢ //</æ€»ç»“> ``` åŸºäºç”¨æˆ·éœ€æ±‚ç”Ÿæˆé«˜è´¨é‡ç”Ÿäº§å¯ç”¨å¯ç›´æ¥ç¼–è¯‘çš„function-goä»£ç  ç”¨æˆ·éœ€æ±‚ï¼š æˆ‘éœ€è¦ä¸€ä¸ªåŒ»é™¢ç®¡ç†ç³»ç»Ÿï¼Œæ–¹ä¾¿åŒ»é™¢ç®¡ç†è¯å“ã€åŒ»ç”Ÿã€ç§‘å®¤å’Œæ‚£è€…æŒ‚å·é—®è¯Šã€‚ åŒ…å«ä»¥ä¸‹åŠŸèƒ½ï¼š è¯å“ç®¡ç†ï¼š - è¯å“åç§°ï¼šè¯å“çš„é€šç”¨åç§° - è§„æ ¼ï¼šè¯å“çš„è§„æ ¼å‹å·ï¼ˆå¦‚ï¼š100mgÃ—30ç‰‡ï¼‰ - ç”Ÿäº§å‚å®¶ï¼šè¯å“çš„ç”Ÿäº§ä¼ä¸šåç§° - å•ä»·ï¼šè¯å“çš„é”€å”®ä»·æ ¼ï¼ˆå…ƒï¼‰ - è¯å“åˆ†ç±»ï¼šé€‰æ‹©åˆ†ç±»ï¼ˆè¥¿è¯ã€ä¸­è¯ã€ç”Ÿç‰©åˆ¶å“ã€åŒ»ç–—å™¨æ¢°ï¼‰ - çŠ¶æ€ï¼šé€‰æ‹©çŠ¶æ€ï¼ˆæ­£å¸¸ã€åœç”¨ï¼Œé»˜è®¤æ­£å¸¸ï¼‰ åŒ»ç”Ÿç®¡ç†ï¼š - åŒ»ç”Ÿå§“åï¼šåŒ»ç”Ÿçš„çœŸå®å§“å - èŒç§°ï¼šé€‰æ‹©èŒç§°ï¼ˆä¸»ä»»åŒ»å¸ˆã€å‰¯ä¸»ä»»åŒ»å¸ˆã€ä¸»æ²»åŒ»å¸ˆã€ä½é™¢åŒ»å¸ˆï¼‰ - æ‰€å±ç§‘å®¤ï¼šé€‰æ‹©ç§‘å®¤ï¼ˆå†…ç§‘ã€å¤–ç§‘ã€å„¿ç§‘ã€å¦‡äº§ç§‘ã€çœ¼ç§‘ã€éª¨ç§‘ã€çš®è‚¤ç§‘ã€å£è…”ç§‘ï¼‰ - è”ç³»ç”µè¯ï¼šåŒ»ç”Ÿçš„è”ç³»ç”µè¯ - å¤‡æ³¨ï¼šåŒ»ç”Ÿçš„å…¶ä»–ä¿¡æ¯ ç§‘å®¤ç®¡ç†ï¼š - ç§‘å®¤åç§°ï¼šç§‘å®¤çš„å®Œæ•´åç§° - ç§‘å®¤ä»£ç ï¼šç§‘å®¤çš„ç®€ç§°ä»£ç  - è¯¦ç»†æè¿°ï¼šç§‘å®¤çš„è¯¦ç»†è¯´æ˜ - çŠ¶æ€ï¼šé€‰æ‹©çŠ¶æ€ï¼ˆæ­£å¸¸ã€åœç”¨ï¼Œé»˜è®¤æ­£å¸¸ï¼‰ æ‚£è€…æŒ‚å·ç®¡ç†ï¼š - æ‚£è€…å§“åï¼šæ‚£è€…çš„çœŸå®å§“å - å¹´é¾„ï¼šæ‚£è€…çš„å¹´é¾„ï¼ˆå²ï¼‰ - æ€§åˆ«ï¼šé€‰æ‹©æ€§åˆ«ï¼ˆç”·ã€å¥³ï¼‰ - ç”µè¯ï¼šæ‚£è€…çš„è”ç³»ç”µè¯ - æŒ‚å·åŒ»ç”Ÿï¼šé€‰æ‹©è¦æŒ‚å·çš„åŒ»ç”Ÿ - æŒ‚å·è´¹ï¼šæŒ‚å·è´¹ç”¨ï¼ˆå…ƒï¼‰ - é—®è¯Šå·ï¼šç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œæ¯å¤©ä»1å¼€å§‹ç¼–å· - æŒ‚å·çŠ¶æ€ï¼šé€‰æ‹©çŠ¶æ€ï¼ˆå¾…é—®è¯Šã€å·²å®Œæˆï¼Œé»˜è®¤å¾…é—®è¯Šï¼‰ - å¤‡æ³¨ï¼šå…¶ä»–éœ€è¦è¯´æ˜çš„ä¿¡æ¯ åŒ»ç”Ÿé—®è¯Šç®¡ç†ï¼š - é—®è¯Šå·ï¼šé€‰æ‹©è¦é—®è¯Šçš„æ‚£è€…æŒ‚å·è®°å½• - åŒ»ç”Ÿï¼šé€‰æ‹©è¿›è¡Œé—®è¯Šçš„åŒ»ç”Ÿ - è¯å“é€‰æ‹©ï¼šé€‰æ‹©è¦å¼€å…·çš„è¯å“ï¼ˆæ”¯æŒå¤šé€‰ï¼‰ - ç”¨æ³•ç”¨é‡ï¼šè¯å“çš„ä½¿ç”¨æ–¹æ³•å’Œç”¨é‡è¯´æ˜ - æ€»é‡‘é¢ï¼šè‡ªåŠ¨è®¡ç®—æ‰€é€‰è¯å“çš„æ€»ä»·æ ¼ - é—®è¯ŠçŠ¶æ€ï¼šé€‰æ‹©çŠ¶æ€ï¼ˆè¿›è¡Œä¸­ã€å·²å®Œæˆï¼Œé»˜è®¤è¿›è¡Œä¸­ï¼‰ ä¸šåŠ¡è§„åˆ™ï¼š - é—®è¯Šå·æ¯å¤©ä»1å¼€å§‹ï¼Œæ–¹ä¾¿åŒ»ç”Ÿå’Œæ‚£è€…è®°å¿† - æ”¯æŒå¤šè¯å“åŒæ—¶å¼€æ–¹ï¼Œè‡ªåŠ¨è®¡ç®—æ€»ä»·æ ¼ - é—®è¯Šå®Œæˆåè‡ªåŠ¨æ›´æ–°æŒ‚å·çŠ¶æ€ - è¯å“çŠ¶æ€ä¸º\"åœç”¨\"æ—¶ä¸èƒ½é€‰æ‹©å¼€æ–¹ ä½¿ç”¨åœºæ™¯ï¼š - è¯æˆ¿ç®¡ç†å‘˜ç»´æŠ¤è¯å“ä¿¡æ¯ - æŠ¤å£«ä¸ºæ‚£è€…åŠç†æŒ‚å· - åŒ»ç”Ÿä¸ºæ‚£è€…è¿›è¡Œé—®è¯Šå¼€æ–¹ - ç®¡ç†å‘˜ç®¡ç†åŒ»ç”Ÿå’Œç§‘å®¤ä¿¡æ¯ ## ä»£ç è´¨é‡è¦æ±‚ - **æ¡†æ¶è§„èŒƒ**ï¼šä¸¥æ ¼æŒ‰ç…§function-goæ¡†æ¶ï¼Œä¸å¾—è‡ªé€ æ­¦åŠŸ - **å¯¼å…¥æ£€æŸ¥**ï¼šç¡®ä¿æ‰€æœ‰ä½¿ç”¨çš„å‡½æ•°éƒ½æœ‰å¯¹åº”çš„importè¯­å¥ - **å‘½åè§„èŒƒ**ï¼šæ–‡ä»¶åã€ç»“æ„ä½“ã€å‡½æ•°åä¿æŒä¸€è‡´æ€§ - **é”™è¯¯å¤„ç†**ï¼šæä¾›å‹å¥½çš„ç”¨æˆ·æç¤ºï¼Œä¸è¦æŠ€æœ¯æ€§é”™è¯¯ä¿¡æ¯ - **ä¸šåŠ¡é€»è¾‘**ï¼šç¡®ä¿åŠŸèƒ½è‡ªæ´½ï¼Œé€»è¾‘å®Œæ•´ ## è¾“å‡ºè¦æ±‚ - ç”Ÿæˆå®Œæ•´çš„Goä»£ç ï¼Œç¦æ­¢å‡ºç°â€œä¼ªä»£ç â€ï¼Œâ€œå ä½ç¬¦â€ï¼Œâ€œç®€åŒ–å®ç°â€ï¼Œâ€œmockæ•°æ®â€ - åŒ…å«æ‰€æœ‰å¿…è¦çš„importè¯­å¥ - ä¿è¯ç”Ÿæˆçš„ä»£ç å¯ä»¥ç›´æ¥ç¼–è¯‘é€šè¿‡ - æ·»åŠ è¯¦ç»†çš„ä»£ç æ³¨é‡Šè¯´æ˜ - åœ¨æ–‡ä»¶æœ«å°¾æ·»åŠ æŠ€æœ¯æ€»ç»“",
			},
		},
		Timeout:     &timeout,
		MaxTokens:   13000,
		Temperature: 0.1, // ä»£ç ç”Ÿæˆéœ€è¦ä½æ¸©åº¦
	}

	ctx, cancel := context.WithTimeout(context.Background(), 600*time.Second)
	defer cancel()

	resp, err := client.Chat(ctx, req)
	if err != nil {
		t.Fatalf("ä»£ç ç”Ÿæˆè¯·æ±‚å¤±è´¥: %v", err)
	}

	if resp == nil {
		t.Fatal("å“åº”ä¸ºç©º")
	}

	// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
	if resp.Error != "" {
		t.Logf("APIè¿”å›é”™è¯¯: %s", resp.Error)
		t.Logf("æ³¨æ„ï¼šè¿™å¯èƒ½æ˜¯API keyæ— æ•ˆæˆ–ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®")
		return
	}

	// æ£€æŸ¥å“åº”å†…å®¹
	if resp.Content == "" {
		t.Error("å“åº”å†…å®¹ä¸ºç©º")
	} else {
		t.Logf("ç”Ÿæˆçš„ä»£ç : %s", resp.Content)
	}

	// æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
	if resp.Usage != nil {
		t.Logf("Tokenä½¿ç”¨: è¾“å…¥%d, è¾“å‡º%d, æ€»è®¡%d",
			resp.Usage.PromptTokens, resp.Usage.CompletionTokens, resp.Usage.TotalTokens)
	}
}

// TestDeepSeekErrorHandling æµ‹è¯•é”™è¯¯å¤„ç†
func TestDeepSeekErrorHandling(t *testing.T) {
	// ä½¿ç”¨æ— æ•ˆçš„API Keyæµ‹è¯•é”™è¯¯å¤„ç†
	invalidClient := NewDeepSeekClient("invalid-api-key")

	req := &ChatRequest{
		Messages: []Message{
			{Role: "user", Content: "ä½ å¥½"},
		},
		MaxTokens: 10,
	}

	ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)
	defer cancel()

	resp, err := invalidClient.Chat(ctx, req)
	if err != nil {
		t.Logf("é¢„æœŸçš„é”™è¯¯: %v", err)
		return
	}

	// å¦‚æœAPIè¿”å›äº†é”™è¯¯ä¿¡æ¯
	if resp != nil && resp.Error != "" {
		t.Logf("APIè¿”å›é”™è¯¯: %s", resp.Error)
		return
	}

	t.Log("æ³¨æ„ï¼šAPIå¯èƒ½æ²¡æœ‰è¿”å›é¢„æœŸçš„é”™è¯¯ä¿¡æ¯")
}

// TestDeepSeekTimeout æµ‹è¯•è¶…æ—¶å¤„ç†
func TestDeepSeekTimeout(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	req := &ChatRequest{
		Messages: []Message{
			{Role: "user", Content: "è¯·ç”Ÿæˆä¸€ä¸ªéå¸¸å¤æ‚çš„ä»£ç ç¤ºä¾‹"},
		},
		MaxTokens: 5000,
	}

	// è®¾ç½®å¾ˆçŸ­çš„è¶…æ—¶æ—¶é—´
	ctx, cancel := context.WithTimeout(context.Background(), 1*time.Second)
	defer cancel()

	_, err = client.Chat(ctx, req)
	if err != nil {
		t.Logf("è¶…æ—¶é”™è¯¯ï¼ˆé¢„æœŸï¼‰: %v", err)
	} else {
		t.Log("æ³¨æ„ï¼šè¯·æ±‚æ²¡æœ‰è¶…æ—¶ï¼Œå¯èƒ½æ˜¯ç½‘ç»œå¾ˆå¿«æˆ–APIå“åº”å¾ˆå¿«")
	}
}

// TestDeepSeekIntegration æµ‹è¯•é›†æˆåŠŸèƒ½
func TestDeepSeekIntegration(t *testing.T) {
	client, err := NewDeepSeekClientFromEnv()
	if err != nil {
		t.Fatalf("ä»ç¯å¢ƒå˜é‡åˆ›å»ºå®¢æˆ·ç«¯å¤±è´¥: %v", err)
	}

	req := &ChatRequest{
		Messages: []Message{
			{
				Role:    "system",
				Content: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„Goè¯­è¨€å¼€å‘åŠ©æ‰‹ï¼Œè¯·ç”Ÿæˆé«˜è´¨é‡çš„ä»£ç ",
			},
			{
				Role:    "user",
				Content: "è¯·åˆ›å»ºä¸€ä¸ªç®€å•çš„Go HTTPæœåŠ¡å™¨",
			},
		},
		MaxTokens:   1500,
		Temperature: 0.1,
	}

	ctx, cancel := context.WithTimeout(context.Background(), 60*time.Second)
	defer cancel()

	resp, err := client.Chat(ctx, req)
	if err != nil {
		t.Fatalf("é›†æˆæµ‹è¯•è¯·æ±‚å¤±è´¥: %v", err)
	}

	if resp == nil {
		t.Fatal("å“åº”ä¸ºç©º")
	}

	// æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
	if resp.Error != "" {
		t.Logf("APIè¿”å›é”™è¯¯: %s", resp.Error)
		t.Logf("æ³¨æ„ï¼šè¿™å¯èƒ½æ˜¯API keyæ— æ•ˆæˆ–ç½‘ç»œé—®é¢˜ï¼Œè¯·æ£€æŸ¥é…ç½®")
		return
	}

	// æ£€æŸ¥å“åº”å†…å®¹
	if resp.Content == "" {
		t.Error("å“åº”å†…å®¹ä¸ºç©º")
	} else {
		t.Logf("é›†æˆæµ‹è¯•æˆåŠŸï¼Œç”Ÿæˆçš„ä»£ç : %s", resp.Content)
	}

	// æ£€æŸ¥ä½¿ç”¨ç»Ÿè®¡
	if resp.Usage != nil {
		t.Logf("Tokenä½¿ç”¨ç»Ÿè®¡: è¾“å…¥%d, è¾“å‡º%d, æ€»è®¡%d",
			resp.Usage.PromptTokens, resp.Usage.CompletionTokens, resp.Usage.TotalTokens)
	}
}

// TestDeepSeekAll è¿è¡Œæ‰€æœ‰æµ‹è¯•
func TestDeepSeekAll(t *testing.T) {
	t.Run("å®¢æˆ·ç«¯åˆ›å»º", TestDeepSeekClientCreation)
	t.Run("æ¥å£å®ç°", TestDeepSeekClientInterface)
	t.Run("åŸºç¡€èŠå¤©", TestDeepSeekChatBasic)
	t.Run("ç³»ç»Ÿæç¤º", TestDeepSeekChatWithSystemPrompt)
	t.Run("ä»£ç ç”Ÿæˆ", TestDeepSeekCodeGeneration)
	t.Run("é”™è¯¯å¤„ç†", TestDeepSeekErrorHandling)
	t.Run("è¶…æ—¶å¤„ç†", TestDeepSeekTimeout)
	t.Run("é›†æˆæµ‹è¯•", TestDeepSeekIntegration)
}
